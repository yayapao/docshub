---
id: handbook
title: ''
sidebar_label: Handbook
---

import { DocsHeader } from '/src/components/Layout/DocsHeader'
import { HighlightWithText } from '/src/components/Highlights'

<DocsHeader
  title="Android handbook"
  description=""
  tags={['Android']}
  links={[]}
/>

## 基础

### px vs dp vs sp

分辨率（Resolution）：比如分辨率为 1920 \* 1080 表示水平方向和竖直方向上分别有 1920 和 1080 个像素。

像素（Pixel，通常用 px 表示，图像元素），是构成图像的基本单元，理论上其他单位最终都会转换成像素，**像素的尺寸并不固定，与屏幕大小和分辨率相关。**

Dpi（像素密度），指屏幕上每英寸具有多少个像素点。

Density（密度），指每平方英寸上的像素点数量，即 Dpi \* Dpi。

dp/Dip（设备独立像素），长度单位，与设备的 Dpi 相关，计算公式为 `px = dp * (dpi / 160)`。

:::info
1 英寸 ≈ 2.54 厘米
:::

假设现在有一个 6.4 英寸，分辨率为 1080 \* 2400 的手机，则：

![phone.png](https://img.joyjoy.cc/android/phone.png)

`Dpi = √(1080\*1080 + 2400*2400) / 6.4 ≈ 420` 即 1 英寸上有 420 个像素点。

`Density = 420 * 420 ≈ 176400` 即 1 平方英寸上有 176400 个像素点。

`1dp = 420 / 160 ≈ 2.625px` 即 1dp 约等于 2.625px。

`1sp = 420 / 160 ≈ 2.625px` 即 1sp 约等于 2.625px。

**为什么需要 dp 和 sp 单位呢？因为 dp 和 sp 是与设备无关的单位，可以保证在不同设备上显示效果一致，类比 H5 中的响应式布局。**

:::info
特别的，sp 会根据系统字体大小设置进行缩放，因此 sp 适合用于文本大小，是 android 中默认的文本单位。
:::

举个例子，假设现在有 3.6 英寸，分辨率分别为 360x480 和 640x960 的手机，则：

| 分辨率  | Dpi | 像素    |
| ------- | --- | ------- |
| 320x480 | 160 | 1dp=1px |
| 640x960 | 320 | 1dp=2px |

如果在屏幕上绘制**20px**的宽度矩形，则屏幕占比分别为：1:16 和 1:32，但是如果绘制**20dp**的宽度矩形，则屏幕占比分别为：1:16 和 1:16。

因此可以得出结论：**相同尺寸，不同分辨率下，使用 dp 单位可以保证显示效果一致。**

## Quick Kotlin

研究下面这个例子：

```kt
fun addTwoNumbers(num1, num2) {
    // 声明一个整数类型的变量,kotlin 具备推断能力
    val headCount: Int = 100
    val machineCount = 20
    println("headCount is $headCount，total count is ${headCount+machineCount}")
    return num1 + num2
}
```

- 声明函数，使用 `fun` 关键字
- 声明变量，使用 `val` 关键字（类比 const）或者 `var` 关键字（类比 let）
- 字符串模版内使用变量，使用 `$` 关键字

## Android Studio

Gradle 是一个项目自动化构建工具，帮助我们进行依赖、打包、部署、发布、各种渠道的差异化管理。

### 项目结构

一个 android project（项目） 可以有多个 module（模块），比如通过 Android Studio 创建的模版项目内，会有 App 模块。一般说“编译运行 App” 通常指的是运行某个模块，因为模块对应实际的 App。

App 主要由 `app` 和 `gradle` 两部分组成。

/app

- **manifests**：包含  `AndroidManifest.xml`  文件，App 运行时配置，系统需要根据该配置来运行代码，展示页面
- **java**：包含 Kotlin 和 Java 源代码文件，包括 JUnit 测试代码
- **res**：包含所有非代码资源，例如界面字符串和位图图像
  - drawable 存放图形描述文件和图片文件
  - layout 存放 App 页面的布局文件
  - mipmap 存放 App 启动图标
  - values 存放一些常量定义文件，比如字符串常量 strings.xml，样式常量 style.xml 等

/gradle - Gradle Scripts 主要是工程的编译配置文件

- build.gradle 用来描述 App 工程的编译规则，分为项目级和模块级
- proguard-rules.pro 用来描述 java 代码的混淆规则
- gradle.properties 配置编译工程的命令行参数
- settings.gradle 配置需要编译哪些模块，模块依赖下载等
- local.properties 项目的本地配置文件，在工程编译时自动生成，用来描述开发者的电脑环境配置

:::info path=AndroidManifest.xml

Application
android:allowBackup="true" // 是否允许应用备份
android:dataExtractionRules="@xml/data_extraction_rules"
android:fullBackupContent="@xml/backup_rules"
android:icon="@mipmap/ic_launcher" // 指定在手机上展示的 app 图标
android:label="@string/app_name" // 指定在手机上展示的 app 名称
android:roundIcon="@mipmap/ic_launcher_round" // 指定在手机上展示的 app 圆角图标
android:supportsRtl="true" // 是否支持文字从右往左排列，比如阿拉伯语
android:theme="@style/Theme.JavaApplication" // app 应用风格
tools:targetApi="31"

Activity 指定 app 拥有的活动页面，具备 android.intent.action.MAIN 的 activity 为入口文件
android:name=".MainActivity"
android:exported="true"
:::

### 真机调试

小米连接真机调试，请确保以下步骤：

- 系统为 Android 11 版本以上，可以升级 miui 实现
- 开启**开发者模式**
- 插入 sim 卡，开发者选项需要 sim 才能开启
- USB 连接后选择**传输文件**

之后，进入**设置 - 开发者选项 - 无线调试**获取配对的 IP 以及当前机器的 IP，执行以下步骤：

```sh
# 点击使用配对码配对设备，获取配对 ip 和 code
➜  ~ adb pair 192.168.1.45:33219
Enter pairing code: 968235
Successfully paired to 192.168.1.45:33219 [guid=adb-banf5the7lofdyhu-ntWvHq]
➜  ~ adb kill-server
➜  ~ adb start-server

# 连接设备到手机 ip
➜  ~ adb connect 192.168.1.45:43927
connected to 192.168.1.45:43927
```

PC（安装 Android Studio 的电脑）和 AVD（或者真机）通过 `adb（android debug bridge）` 连接起来。

## android 开发

**android 开发使用 xml 来描绘应用界面，通过 java/kotlin 来编写逻辑。**

### Activity

Activity 是一个应用程序组件，提供一个屏幕，用户可以用来交互完成任务。
