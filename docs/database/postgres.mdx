---
id: postgres
title: ''
sidebar_label: postgres
---

import { DocsHeader } from '/src/components/Layout/DocsHeader'

<DocsHeader
  title="PostgreSQL"
  description="The World's Most Advanced Open Source Relational Database"
  tags={['RDBMS']}
  links={[]}
/>{' '}

## 查看数据状态

查看表大小，并对所有库内所有表按照大小进行排序

![tabel_size](https://i.stack.imgur.com/9zfeC.png)

```sql

-- 查看表大小：table size
select pg_size_pretty(pg_table_size('table_name'));

-- 查看表大小：table size + index size
select pg_size_pretty(pg_total_relation_size('table_name'));

-- 按照 tabel size 对全部表进行排序
-- pg_stat_user_tables 表示由用户创建的表，区别于系统表
select relname, pg_size_pretty(pg_table_size(relid))
from pg_stat_user_tables where schemaname='public' order by pg_table_size(relid) desc;

```

统计每张表的 row 数量

```sql

select relname as name, reltuples as cnt from pg_class where relkind = 'r' and
relnamespace = (
    select oid from pg_namespace where nspname = 'public'
    ) order by cnt desc ;

```

## 业务相关

查看每月新增用户/项目

- 注意 `date_trunc` 的使用

```sql
select date_trunc('month', date_joined) as dt, count(date_joined) as total
from [table name]
group by date_trunc('month', date_joined)
order by date_trunc('month', date_joined)

```
