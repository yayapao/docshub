---
id: qs
title: ''
sidebar_label: 'React Questions'
---

import { DocsHeader } from '/src/components/Layout/DocsHeader'

<DocsHeader
  title="Questions about React"
  description="å¯¹ React ç”Ÿäº§é—®é¢˜çš„æ·±åº¦æ€è€ƒğŸ¤”ã€‚"
  tags={['React']}
  links={[
    {
      label: 'React å®˜ç½‘',
      link: 'https://zh-hans.react.dev/learn',
    },
    {
      label: 'Why does useRef solve the problem of stale state?',
      link: 'https://stackoverflow.com/questions/66622967/why-does-useref-solve-the-problem-of-stale-state',
    },
    {
      label: 'Rename A File With JavaScript In The Browser',
      link: 'https://pqina.nl/blog/rename-a-file-with-javascript/',
    },
    {
      label: 'react-fiber-architecture',
      link: 'https://github.com/acdlite/react-fiber-architecture',
    },
  ]}
/>

## åœ¨ React å†…å¦‚ä½•å¤„ç†æ–‡ä»¶å¯¹è±¡ï¼Ÿ

:::warning Before we start

[File](https://developer.mozilla.org/en-US/docs/Web/API/File) å¯ä»¥çœ‹ä½œæ˜¯ Blob çš„ä¸€ç§ç‰¹æ®Šå®ç°ï¼Œå› æ­¤å®ƒå…·å¤‡ Blob çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œå®ƒè¿˜ `name`, `lastModified` ä»¥åŠ `webkitRelativePath` ç­‰å±æ€§

**æ­£æ˜¯ç”±äº File çš„å±æ€§ä¸º readonlyï¼Œä½¿æˆ‘ä»¬åœ¨è¯•å›¾æ”¹å˜å®ƒæ—¶é‡åˆ°éº»çƒ¦ã€‚**

:::

æœ¬ç« èŠ‚ï¼Œæˆ‘å°†åŸºäº React ç»“åˆ [filepond](https://pqina.nl/filepond/docs/) æ¥ä»‹ç»åœ¨ç°ä»£æ¡†æ¶å†…**å¤„ç†ä¸Šä¼ æ–‡ä»¶çš„éœ€æ±‚**ï¼ŒåŒæ—¶æä¾›è®¾è®¡ä¸Šä¼ ç»„ä»¶çš„æ€è·¯å’Œç»†èŠ‚ã€‚

è§‚å¯Ÿ filepond æˆ‘å‘ç°ï¼Œå®ƒåœ¨å¤„ç†æ–‡ä»¶ä¸Šä¼ æ—¶ï¼Œæ”¯æŒï¼š

- åœ¨æ–‡ä»¶å¯¹è±¡è¢«å‘é€åˆ°æœåŠ¡å™¨ä¹‹å‰ï¼Œé€šè¿‡å†…ç½®å’Œè‡ªå®šä¹‰æ’ä»¶ï¼Œæ›´æ”¹æ–‡ä»¶å¯¹è±¡ï¼Œæ¯”å¦‚é‡å‘½åã€é¢„è§ˆç­‰æ“ä½œ
- å¯¹äºå·²ä¸Šä¼ æ–‡ä»¶ï¼Œæ”¯æŒé»˜è®¤åˆ é™¤æ“ä½œï¼Œä¼šåŒæ—¶åˆ é™¤æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯æ–‡ä»¶å¯¹è±¡

filepond ä¸ºäº†è§„é¿ File å¯¹è±¡çš„åªè¯»å±æ€§ï¼Œé‡‡ç”¨äº†ä»¥ä¸‹æ–¹æ¡ˆï¼š

1. å½“ç”¨æˆ·ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªåªè¯»çš„ File å¯¹è±¡ï¼›
2. filepond æ’ä»¶åŸºäºåŸ File å¯¹è±¡ï¼Œåˆ›å»ºæ–°çš„ File å¯¹è±¡æ¥è§„é¿åªè¯»çš„é™åˆ¶ï¼›
3. åŸºäº File å¯¹è±¡ç”Ÿæˆæœ¬åœ° URL æ¥é¢„è§ˆå›¾ç‰‡ï¼›
4. æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯éœ€è¦è¾¾æˆæŸç§çº¦å®šï¼Œå³å½“ä¸Šä¼ æˆåŠŸåï¼Œå°†æ–‡ä»¶ ID ä»¥çº¦å®šå½¢å¼è¿”å›ï¼Œç»„ä»¶ä»ç»“æœå†…å–å‡ºåæ”¾å»å†…å­˜ï¼Œä»è€Œè¿›è¡Œåç»­åˆ é™¤ç­‰æ“ä½œï¼›
5. ä¸åŒæµè§ˆå™¨åœ¨å¤„ç† File å¯¹è±¡æ—¶ï¼Œå¯èƒ½ä¼šå°†å…¶è½¬æ¢ä¸º Blob å¯¹è±¡ï¼Œ**æœåŠ¡ç«¯æ¥æ”¶ Blob å¯¹è±¡åï¼Œä¼šå°†å…¶ filename è§£ææˆ blob**ã€‚å› æ­¤ï¼Œéœ€è¦ç¡®ä¿ä¸Šä¼ æ•°æ®ä¸º File å¯¹è±¡ï¼›

### å¦‚ä½•åœ¨å®¢æˆ·ç«¯å¯¹ File å¯¹è±¡è¿›è¡Œé‡å‘½åï¼Ÿ

ä»¥é‡å‘½åä¸ºä¾‹ï¼Œå½“æˆ‘ä»¬éœ€è¦æ›´æ”¹ File çš„å±æ€§æ—¶ï¼Œ**ç›®å‰æ ‡å‡†çš„è§£å†³æ–¹æ¡ˆæ—¶ï¼Œä»¥åŸ File å¯¹è±¡ä¸ºåŸºç¡€ï¼Œç”Ÿäº§ä¸€ä¸ªæ–°çš„ Blob å¯¹è±¡ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸º File å¯¹è±¡ã€‚**

_ä¸ºä»€ä¹ˆä¸æ˜¯ç›´æ¥ç”Ÿäº§ File å¯¹è±¡ï¼Ÿ_

- ä¸åŒæµè§ˆå™¨å¯¹äº File å¯¹è±¡çš„å¤„ç†å­˜åœ¨å·®å¼‚
- `Blob.slice` ä¼šè¿”å›ä¸€ä¸ª Blob å¯¹è±¡

```js
const renameFile = (file, name) => {
  // æ–°å»ºä¸€ä¸ª Blob å¯¹è±¡ï¼ŒæŒ‡å®šå¼€å§‹/ç»“æŸä½ç½®å’Œæ•°æ®ç±»å‹ï¼Œå¹¶ä¸ºå…¶é‡å‘½å
  const renamedFile = file.slice(0, file.size, file.type)
  renamedFile.lastModifiedDate = file.lastModifiedDate
  renamedFile.name = name
  // å°† Blob å¯¹è±¡è½¬æ¢ä¸º File
  const form = new FormData()
  form.set('file', renamedFile, name)
  return form.get('file')
}
```

### å¦‚ä½•å®ç°æœ¬åœ°é¢„è§ˆæ–‡ä»¶ï¼Ÿ

è¿™é‡Œç‰¹æŒ‡æµè§ˆå™¨å¯ä»¥æ‰“å¼€çš„æ–‡ä»¶ï¼Œæ¯”å¦‚ image/\*, SVG, ä»¥åŠ PDF ç­‰æ ¼å¼æ–‡ä»¶ã€‚

1. é€šè¿‡ `window.URL.createObjectURL(file)` æ–¹æ³•ï¼Œåˆ›å»ºä¸€ä¸ªé“¾æ¥ï¼Œå°†è¿”å›å€¼æ”¾å…¥ img.src å±æ€§å†…ï¼›
2. é€šè¿‡ `FileReader` å°†æ–‡ä»¶å†…å®¹è½¬ä¸º base64 æ ¼å¼ï¼Œè¿›è¡Œè¯»å–ï¼›

```js filereader
var fileReader = new FileReader()

reader.onload = function (e) {
  // base64 ç¼–ç 
  const res = e.target.result
}
reader.readAsDataURL(file)
```

## ä¸ºä»€ä¹ˆä¸å»ºè®®å‘åˆ—è¡¨ç»„ä»¶çš„å¤´éƒ¨æ’å…¥æ•°æ®ï¼Ÿ

åœ¨ React å†…ï¼Œå‘åˆ—è¡¨ç»„ä»¶çš„å¤´éƒ¨å’Œå°¾éƒ¨æ’å…¥æ•°æ®ï¼Œä¼šäº§ç”Ÿæ¯”è¾ƒæ˜æ˜¾çš„æ€§èƒ½å·®å¼‚ã€‚åŸå› åœ¨äº React æ˜¯ä¾æ® diff ç®—æ³•æ¥å¤„ç† DOM æ›´æ–°ã€‚

React ä¼šç»´æŠ¤ä¸€ä»½è™šæ‹Ÿ DOM æ ‘ï¼Œå½“æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒReact ä¼šæ ¹æ®æ–°æ•°æ®ç”Ÿæˆæ–°çš„è™šæ‹Ÿ DOM æ ‘ï¼Œå¹¶å°†å…¶ä¸æ—§çš„è™šæ‹Ÿ DOM æ ‘è¿›è¡Œæ¯”è¾ƒï¼Œæ‰¾å‡ºéœ€è¦æ›´æ–°çš„èŠ‚ç‚¹ï¼Œç„¶åæ›´æ–° DOMã€‚è¿™ä¸ªè¿‡ç¨‹å«åš **åè°ƒï¼ˆReconciliationï¼‰**ã€‚

å‘å°¾éƒ¨æ’å…¥å…ƒç´ ï¼ŒReact ä¼šåˆ¤å®šå·²å­˜åœ¨çš„å…ƒç´ æ²¡æœ‰å˜åŒ–ï¼Œåªéœ€è¦å°†æ–°å…ƒç´ æ’å…¥åˆ°å°¾éƒ¨å³å¯ã€‚

å‘å¤´éƒ¨æ’å…¥å…ƒç´ ï¼Œæ•´ä¸ªåˆ—è¡¨å…ƒç´ å‘åç§»åŠ¨ï¼Œå¦‚æœæ­¤æ—¶ key ä¸º index æˆ–è€…å…¶ä»–éå”¯ä¸€æ€§çš„å€¼ï¼Œé‚£ä¹ˆä¼šå¯¼è‡´æ•´ä¸ªåˆ—è¡¨é‡æ–°æ¸²æŸ“ã€‚

**å› ä¸ºï¼Œå¯¹äºåˆ—è¡¨ç»„ä»¶ï¼Œå¦‚æœæˆ‘ä»¬è€ƒè™‘æ’åºï¼Œæˆ–è€…è¡¨å•çš„å¢åˆ æ”¹ï¼Œé‚£ä¹ˆ key å¿…é¡»å”¯ä¸€ï¼Œä¸”ä¸å»ºè®®å‘å¤´éƒ¨æ’å…¥æ•°æ®ã€‚**

## ä¸ºä»€ä¹ˆä¸æ¨èåœ¨ useEffect å†…ä½¿ç”¨ fetch è¯·æ±‚æ•°æ®ï¼Ÿ

React å†…ï¼Œåœ¨ useEffect å†…ä½¿ç”¨ fetch æ‰‹åŠ¨è¯·æ±‚æ•°æ®ï¼Œä¼šå­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š

- [ç«æ€æ¡ä»¶](#å¦‚ä½•ç†è§£ç«æ€æ¡ä»¶)ï¼šå½“å­˜åœ¨å¤šä¸ª useEffect è¯·æ±‚åŒä¸€ä¸ªèµ„æºæ—¶ï¼Œæˆ–è€…åŒä¸€ä¸ªä¾èµ–é¡¹è¢«å¤šæ¬¡æ”¹å˜ï¼Œå¯èƒ½ä¼šå¼•èµ·ç«æ€æ¡ä»¶ï¼Œå¯¼è‡´æœ€ç»ˆæ•°æ®ä¸ä¸€è‡´ï¼›
- **å¢åŠ ä»£ç å¤æ‚æ€§**ï¼šéœ€è¦è‡ªå·±ç®¡ç† loading çŠ¶æ€ã€é”™è¯¯å¤„ç†ç­‰ï¼ŒåŒæ—¶éœ€è¦ä¿è¯ç»„ä»¶å¸è½½æ—¶ï¼Œè¯·æ±‚è¢«æ­£ç¡®æ¸…ç†ä»¥é¿å…å†…å­˜æ³„æ¼ï¼›
- **æ€§èƒ½é—®é¢˜**ï¼šæ²¡æœ‰åˆ©ç”¨ React æ›´åŠ ç°ä»£çš„å¹¶å‘ç‰¹æ€§ï¼Œæ¯”å¦‚ `useTransition` å’Œ `Suspense`ï¼Œè¿™äº›å·¥å…·èƒ½å¤Ÿæ›´ä¼˜é›…åœ°å¤„ç†åŠ è½½çŠ¶æ€ï¼›

:::warning
ä¸Šè¯‰é—®é¢˜ï¼Œæˆ‘ä»¬åœ¨ React å†…éƒ½å¯ä»¥é€šè¿‡ `@tanstack/react-query` æ¥è§£å†³ã€‚å› æ­¤ä¸å¿…è‡ªå·±æ·±ç©¶å…¶å¯¹åº”çš„è§£å†³æ–¹æ¡ˆï¼
:::

### å¦‚ä½•ç†è§£ç«æ€æ¡ä»¶ï¼Ÿ

**ç«æ€æ¡ä»¶ï¼ˆRace Conditionï¼‰**é€šå¸¸å‡ºç°åœ¨å¤šä¸ªå¼‚æ­¥æ“ä½œåŒæ—¶è¿›è¡Œï¼Œè¿™äº›æ“ä½œçš„å®Œæˆé¡ºåºä¸å¯é¢„æµ‹ï¼Œä»è€Œå¯¼è‡´ç»“æœä¸å¯ç¡®å®šã€‚

åœ¨ React å†…ï¼Œç«æ€æ¡ä»¶é€šå¸¸å‡ºç° useEffect + fetch çš„åœºæ™¯ï¼Œæˆ‘ä»¬åº”è¯¥å°½é‡é¿å…ã€‚ä¸¾ä¸ªä¾‹å­ï¼š

```tsx
export default function App() {
  const [id, setId] = useState(1)
  const [data, setData] = useState(null)

  useEffect(() => {
    fetch(`https://api.example.com/data?id=${id}`)
      .then((res) => res.json())
      .then((data) => setData(data))
  }, [id])

  return (
    <div>
      <Select onChange={setId} />
      {data}
    </div>
  )
}
```

å½“æˆ‘ä»¬åœ¨ Select å†… ID æ—¶ï¼Œä¼šè§¦å‘ useEffect å†…çš„ fetch è¯·æ±‚ï¼Œä»è€Œå¯¼è‡´æ•°æ®å‘ç”Ÿå˜åŒ–ã€‚å‡è®¾æˆ‘ä»¬ä» A åˆ‡æ¢åˆ° Bï¼Œä¾æ¬¡å‘èµ· requestA å’Œ requestB è¯·æ±‚ã€‚ä¸€ä¸ªå¯èƒ½çš„ç°è±¡ï¼š

- å¦‚æœ requestB å…ˆäº requestA è¿”å›ï¼ˆå¯èƒ½ç”±äºç½‘ç»œåŸå› ç­‰ç­‰ï¼‰
- requestB å®Œæˆï¼Œé¡µé¢å±•ç¤º B æ•°æ®
- requestA å®Œæˆï¼Œé¡µé¢æ•°æ®è¢«æ›¿æ¢ä¸º A æ•°æ®

æ­¤æ—¶ï¼Œé¡µé¢ä¼šå±•ç¤º A æ•°æ®ï¼Œè€Œä¸æ˜¯æˆ‘ä»¬æœŸæœ›çš„ B æ•°æ®ã€‚è¿™æ˜¯ä¸€ä¸ªæ˜æ˜¾çš„ç«æ€æ¡ä»¶ã€‚

**é€šå¸¸å¤„ç†ç«æ€æ¡ä»¶çš„è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨å–æ¶ˆä»¤ç‰Œï¼ˆCancel Tokenï¼‰æ¥å–æ¶ˆä¸Šä¸€æ¬¡çš„è¯·æ±‚ã€‚**
