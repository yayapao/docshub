---
id: npm
title: NPM
sidebar_label: NPM
slug: npm
---

import { HighlightWithText } from '/src/components/Highlights'

:::note what's npm?
[npm](https://www.npmjs.com/about) 是一个 Node.js 的包管理工具，也是 Node.js 开源项目的仓库
:::

## Troubleshooting


<HighlightWithText>Q: 安装 pm2 时，npm install 卡在 sill install loadIdealTree？</HighlightWithText>

<!-- -->

```
1. 更换 npm 源 `https://registry.npm.taobao.org/`
2. 删除 package-lock.json, node_modules 后，重新安装
```

<HighlightWithText>Q: NPM not installing package. Hostname/IP address doesn't match certificate's altnames?</HighlightWithText>

<!-- -->

参考 [NPM not installing package. Hostname/IP address doesn't match certificate's altnames?](https://stackoverflow.com/questions/52128212/npm-not-installing-package-hostname-ip-address-doesnt-match-certificates-altn)，问题在于当前拉取的 npm 源不对。

```shell
# 获取 www.npmjs.com ip
dig www.npmjs.com @1.1.1.1
# 配置 hosts 文件
vim /etc/hosts

104.16.92.83 registry.npmjs.org

# 或者更换源，注意 http/https 区别
npm config set registry http://registry.npmjs.org
```


## package.json

package.json 要点


![package](/img/server/package.json.png)

## npm 常用命令

**更换源库地址**

- 查看源地址 `npm config get registry`
- 临时换源 `npm --registry https://registry.npmjs.org/ install [package]`
- 永久更换  `npm config set registry https://registry.npmjs.org/`


**查看**

- `npm ls -g --depth 0` 查看全局安装包
- `npm ls [package name] [-g]` 检索本地/全局是否安装指定包

**执行指定路径的脚本**

npm 默认执行根目录下，package.json 内的命令，可以通过配置：

`npm --prefix /path/to/project run build`，其中 /path/to/project 表示指定目录，其目录下必须包含 `package.json`


### npm publish 指定文件（或者指定不发布的文件）

开始在使用 npm 进行发布时，会发现总是将一些不需要的文件打包进去，可以通过发布时的 `Tarball Contents` 来观察打包文件，或者在 [npm](https://www.npmjs.com/) 内通过 Total Files 进行查看

当然，打包进去的文件越精简越好，这样能够减少包的大小，更加轻量，那么我们应该怎么达到目的呢？

1. 通过设置 `.gitignore` 使其在 git 代码管理和 npm publish 内同时生效；
2. 通过设置 `.npmignore` ，其设置语法和 `.gitignore` 一致，但是**优先级更高！**
3. 通过设置 `package.json` 内的 [files](https://docs.npmjs.com/cli/v7/configuring-npm/package-json#files) 字段来选择发布的文件或者目录，其优先级在同级目录下时更高！

