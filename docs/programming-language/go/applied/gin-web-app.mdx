---
id: gin-web-app
title: ''
sidebar_label: Gin WebAPP
---

import { DocsHeader } from '/src/components/Layout/DocsHeader'
import { HighlightWithText } from '/src/components/Highlights'

<DocsHeader
  title="Gin WebAPP"
  description="Rules and resolutions for developing Go WebAPP."
  github="https://github.com/YaYaPao/goars"
  tags={['web']}
  links={[
    {
      label: 'How to cross-compile Go programs for Windows, Linux and MacOS.',
      link: 'https://freshman.tech/snippets/go/cross-compile-go-programs/',
    },
    {
      label: 'GORM æŒ‡å—',
      link: 'https://gorm.io/zh_CN/docs/index.html',
    },
    {
      label: 'Stemming vs Lemmatization',
      link: 'https://towardsdatascience.com/stemming-vs-lemmatization-2daddabcb221',
    },
  ]}
/>

**åœ¨æœ¬ç« èŠ‚å°†ä»‹ç»å¦‚ä½•å¼€å§‹ä½¿ç”¨ Go æ¥å¼€å‘ web-API æœåŠ¡ï¼Œå¹¶ä¸”ä½¿å…¶æ‹¥æœ‰è‰¯å¥½çš„å¼€å‘è§„èŒƒå’Œåº”ç”¨æ€§èƒ½ã€‚**

- åŸºäº yaml å®šä¹‰é¡¹ç›®é…ç½®
- åŸºäº zap ä½œä¸ºé¡¹ç›®æ—¥å¿—ç®¡ç†å·¥å…·
- ä½¿ç”¨ Gin ä½œä¸º webapp æ¡†æ¶
- ä½¿ç”¨ Gorm ä½œä¸ºè¿æ¥æ•°æ®åº“çš„å®¢æˆ·ç«¯
- åŸºäº Redis ä½¿ç”¨è¯·æ±‚ç¼“å­˜
- åŸºäº JWT ä½œä¸ºç”¨æˆ· token éªŒè¯
- åŸºäº COS å®ç°å›¾åºŠåŠŸèƒ½

## Preworks

### è®¾ç½®ç¯å¢ƒå˜é‡

ç±»ä¼¼ Node.jsï¼Œæˆ‘ä»¬éœ€è¦åœ¨é¡¹ç›®å†…é€šè¿‡ç¯å¢ƒå˜é‡æ¥å®šä¹‰ä¸åŒåœºæ™¯ä¸‹åº”ç”¨çš„è¡Œä¸ºï¼š

```bash
# å¼€å‘ç¯å¢ƒ
APP_ENV=development go run main.go

# ç”Ÿäº§ç¯å¢ƒ
APP_ENV=production ./main.go
```

åœ¨ä»£ç å†…è·å–å½“å‰ç¯å¢ƒå˜é‡ï¼š

```go
// å¦‚æœæ²¡æœ‰æ‰¾åˆ°ä¼šè¿”å›ç©ºå­—ç¬¦ä¸²
env := os.Getenv("APP_ENV")
```

### Compile and build

:::tip CROSS-COMPILE(äº¤å‰ç¼–è¯‘)

How do you build Go binaries that target operating systems and architectures other than your own? This is called cross-compiling.

:::

é€šè¿‡ `go env` æŸ¥çœ‹ç¼–è¯‘çš„ç¯å¢ƒå˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥è§‚å¯Ÿåˆ°æœ¬åœ°çš„ç³»ç»Ÿæ¶æ„å’Œç›®æ ‡ï¼ˆHostï¼‰çš„ç›®æ ‡æ¶æ„ã€‚Go æ”¯æŒé€šè¿‡æ›´æ”¹ `GOHOSTARCH` å’Œ `GOHOSTOS` æ¥ç¼–è¯‘æŒ‡å®šç¯å¢ƒçš„äºŒè¿›åˆ¶åŒ…ã€‚

```bash
$ go env

# output
GOARCH="amd64" # 64-bit architecture
GOHOSTARCH="amd64"
GOHOSTOS="darwin"
GOOS="darwin"
```

#### MacOS

ç¼–è¯‘ MacOS ä¸‹äºŒè¿›åˆ¶åº”ç”¨ï¼Œå¦‚æœæœ¬åœ°ä½¿ç”¨ MacOS å¼€å‘ï¼Œåˆ™ç›´æ¥ `go build` å³å¯ã€‚

```bash
# 64-bits
GOOS=darwin GOARCH=amd64 go build app.go

# 32-bits
GOOS=darwin GOARCH=386 go build app.go
```

#### Linux

ç¼–è¾‘ Lunix ä¸‹äºŒè¿›åˆ¶åº”ç”¨ã€‚

```bash
# 64-bit
GOOS=linux GOARCH=amd64 go build app.go

# 32-bit
GOOS=linux GOARCH=386 go build app.go
```

#### Windows

ç¼–è¯‘ `.exe` åº”ç”¨ï¼š

```bash
# 64-bits
GOOS=windows GOARCH=amd64 go build app.go

# 32-bits
GOOS=windows GOARCH=386 go build app.go
```

## é¡¹ç›®ç»„ç»‡ç»“æ„

ç›®å½•åŸºäº treeï¼ˆ`brew install tree`ï¼‰ ç”Ÿæˆã€‚

```
.
â”œâ”€â”€ conf # System config
â”œâ”€â”€ docs # related documents
â”‚Â Â  â””â”€â”€ processor # logic flow processor
â”œâ”€â”€ http_operation # http relatedï¼šfailedã€successedã€req/res structs
â”œâ”€â”€ middleware # Router middlewares
â”œâ”€â”€ models # Mapping orm and related methods(control data directly)
â”œâ”€â”€ pkg # Self-defined packages
â”‚Â Â  â”œâ”€â”€ cacheStore # Cache store for request
â”‚Â Â  â”œâ”€â”€ core # Core methods(like Init())
â”‚Â Â  â”œâ”€â”€ settings # Read from .yaml settings
â”‚Â Â  â”œâ”€â”€ tcos # COS client
â”‚Â Â  â”œâ”€â”€ utils # Toolkits
â”‚Â Â  â””â”€â”€ zaplog # Logger based on zap
â”œâ”€â”€ router # Register routes and return the router
â”‚Â Â  â”œâ”€â”€ api # Mapping routes handler
â”‚Â Â  â”œâ”€â”€ routes # Module's routes
â”‚Â Â  â””â”€â”€ router.go # Global router controller
â””â”€â”€ service # module's core handlers between model and api/routes


```

åœ¨ `main.go` å†…ï¼Œæˆ‘ä»¬ä¼šåœ¨ `init()` å†…è°ƒç”¨å„ä¸ªæ¨¡å—çš„åˆå§‹åŒ–æ–¹æ³•ï¼ŒåŒ…æ‹¬ settings, logger, database, cacheã€‚

ä¹‹åä¼šå°†åˆå§‹åŒ–çš„è·¯ç”±å¯¹è±¡å®ä¾‹åŒ–ï¼Œå¯åŠ¨æœåŠ¡ã€‚

## å¼€å‘

Highly Recommended using **Goland RUN Configurations** to start APP.

> CAUTION: add `APP_ENV=development`

### åˆ›å»º API æ¥å£

ä»¥ä¸‹å®šä¹‰å¼€å‘ä¸€ä¸ªæ¥å£çš„ä¸»è¦æµç¨‹ï¼š

1. åœ¨ `models/[module]` ä¸‹å®šä¹‰ ORM æ•°æ®æ¨¡å‹ï¼ŒåŒ…æ‹¬ç»“æ„ä½“å®šä¹‰å’Œæ•°æ®åº“æ“ä½œæ–¹æ³•ï¼›**è¡¨åä¸ºå•æ•°**ï¼Œå»ºè®®å®ç°æ–¹æ³•å¦‚ä¸‹ï¼š

```go
// å¿…é¡»å®šä¹‰å­—æ®µ IDã€CreatedAtã€UpdatedAt
type Plan struct {
	ID        uint      `gorm:"autoIncrement" json:"id"`
	Name      string    `json:"name"`
	CreatedAt time.Time `gorm:"autoCreateTime" json:"createdAt"`
	UpdatedAt time.Time `gorm:"autoUpdateTime" json:"updatedAt"`
}

func QueryPlanByID(id uint) (*Plan, error) {}
func QueryPlans() ([]Plan, error) {} // æŒ‰éœ€è¿›è¡Œè¯·æ±‚å‚æ•°å¤„ç†

// Save plan è¡¨ç¤ºä¸€ä¸ªæŒ‡å‘ FamilyPlan çš„æŒ‡é’ˆ
// æ³¨æ„ï¼šä½¿ç”¨ grom Save æ–¹æ³•æ—¶ï¼Œä¸è¦å’Œ Model ä¸€èµ·ä½¿ç”¨
func (plan *Plan) Save() error {
	return DBClient.Save(plan).Error
}

```

2. åœ¨ `http_operation/[module]` å®šä¹‰ http è¯·æ±‚/è¿”å›ç»“æ„ä½“ï¼Œè¯·æ±‚ç»Ÿä¸€ç”¨ `Req` ç»“å°¾ï¼Œè¿”å›ç»Ÿä¸€ç”¨ `Res` ç»“å°¾ï¼›å¼€å¤´æ ¹æ®è¯·æ±‚ç±»å‹ï¼Œæ”¯æŒ `Find`, `Save`, `Update ` é€‰æ‹©ï¼Œæ¯”å¦‚ï¼š

:::info

è¿™é‡Œä½¿ç”¨ Find è€Œä¸æ˜¯ GET/POST ç­‰ http æ–¹æ³•ï¼Œæ˜¯å› ä¸ºè¯·æ±‚æ¥å£ä¸å¿…ä¸ http æ–¹æ³•ä¸€ä¸€å¯¹åº”ï¼Œè€Œæ˜¯æ ¹æ®ä¸šåŠ¡é€»è¾‘æ¥å®šä¹‰ã€‚POST åŒæ ·å¯ä»¥ç”¨äºè¯·æ±‚ï¼

:::

```go
// get è¯·æ±‚å¯¹åº” form å‚æ•°
type FindPlanReq struct {
	ID uint `form:"id"`
}

// post/put/patch ä½¿ç”¨ json å‚æ•°
type SavePlanReq struct {
	Name string `json:"name"`
}

// ç›´æ¥ç»§æ‰¿ SavePlanReqï¼Œè¡¨ç¤º UpdatePlanReq ä¹ŸåŒ…å« SavePlanReq çš„å­—æ®µ
type UpdatePlanReq struct {
	ID   uint   `json:"id"`
	SavePlanReq
}

// è¿”å›ç»“æ„ä½“
type FindPlanRes struct {
	ID        uint      `json:"id"`
	Name      string    `json:"name"`
	CreatedAt time.Time `json:"createdAt"`
	UpdatedAt time.Time `json:"updatedAt"`
}

```

:::warning

å¯¹äº Update è¯·æ±‚ï¼Œå»ºè®®é€šè¿‡ ID è·å–å®ä¾‹åï¼ŒæŒ‰éœ€æ›´æ–°å­—æ®µï¼Œè€Œä¸æ˜¯ç›´æ¥ä¼ å…¥æ‰€æœ‰å­—æ®µã€‚

:::

3. åœ¨ `service/[module]` ä¸‹å®šä¹‰ä¸šåŠ¡é€»è¾‘å¤„ç†æ–¹æ³•ï¼ŒåŒ…æ‹¬æ•°æ®å¤„ç†ã€æ•°æ®æ ¡éªŒã€æ•°æ®è¿”å›ç­‰ï¼Œå‡½æ•°åä»¥ `Query`, `Save`, `Update` ç­‰å¼€å¤´ï¼Œæ ¹æ®éœ€æ±‚ï¼Œä»¥å•æ•°/å¤æ•°å½¢å¼å‘½åï¼›æ¯”å¦‚ï¼š

:::info

è¿™é‡Œä½¿ç”¨ `Query` è€Œä¸æ˜¯ `Find` é¿å…å…¨å±€æœç´¢æ—¶å‡ºç°å†²çªã€‚

:::

```go
func QueryPlans() ([]models.Plan, error) {}

func SavePlan(data *httpOperation.SavePlanReq) error {}

func UpdatePlan(data *httpOperation.UpdatePlanReq) error {}
```

4. åœ¨ `router/api/[module]` ä¸‹å®šä¹‰è·¯ç”±å¤„ç†æ–¹æ³•ï¼ŒåŒ…æ‹¬è¯·æ±‚å‚æ•°è§£æã€è°ƒç”¨ service æ–¹æ³•ã€è¿”å›æ•°æ®ç­‰ï¼Œ**ä½¿ç”¨ http æ–¹æ³•ä½œä¸ºå‡½æ•°åå‰ç¼€**ï¼›

```go
func GetPlans(c *gin.Context) {}

func PostPlan(c *gin.Context) {}

func UpdatePlan(c *gin.Context) {}
```

5. åœ¨ `router/routes/[module]` ä¸‹å®šä¹‰è·¯ç”±è§„åˆ™ï¼ŒåŒ…æ‹¬è¯·æ±‚æ–¹æ³•ã€è¯·æ±‚è·¯å¾„ã€è¯·æ±‚å¤„ç†æ–¹æ³•ç­‰ï¼Œè·¯å¾„ä½¿ç”¨ `-` è¿›è¡Œè¿æ¥ï¼›

```go
func InitPlanRoutes(r *gin.RouterGroup) {
	group := r.Group("plan")
	group.GET("my-list", api.GetPlans)
	group.POST("", api.PostPlan)
	group.PATCH("", api.UpdatePlan)
}
```

6. åœ¨ `router/router.go` ä¸‹æ³¨å†Œè·¯ç”±ï¼Œå°† `routes/[module]` ä¸‹çš„è·¯ç”±è§„åˆ™æ³¨å†Œåˆ°å…¨å±€è·¯ç”±å¯¹è±¡ä¸­ï¼›

```go
func InitRouter() *gin.Engine {
	router := gin.Default()
	// æ³¨å†Œä¸­é—´ä»¶
	router.Use(gin.Logger())
	router.Use(middleware.CorsMiddleware())
	// æ–°å»º router groupï¼Œæ·»åŠ å…¨å±€å‰ç¼€
	apiGroup := router.Group("/api")
	// æ³¨å†Œä¸šåŠ¡è·¯ç”±
	routes.InitPlanRoutes(apiGroup)
	return router
}
```

### å¤„ç† Stream æµ

å‡å¦‚æˆ‘ä»¬åœ¨æœåŠ¡ç«¯æ¥æ”¶äº†ä¸€ä¸ª Stream æµï¼Œç°åœ¨æˆ‘éœ€è¦å°†å…¶ä¼ è¾“ç»™å®¢æˆ·ç«¯ï¼ŒåŒæ ·ä»¥æµçš„å½¢å¼ä¼ è¾“ã€‚åŸºäº Gin æˆ‘ä»¬å¯ä»¥ï¼š

```go
// çœç•¥å…¶ä»–ä»£ç 
	c.Stream(func(w io.Writer) bool {
    // ä»æœåŠ¡ç«¯æ¥æ”¶æµï¼Œå¹¶è¯»å– chunk
		res, err := stream.Recv()
		if errors.Is(err, io.EOF) {
			fmt.Println("stream finished")
			return false
		}
		if err != nil {
			fmt.Println("stream error", err)
			return false
		}
		chunk := res.Choices[0].Delta.Content
    // å‘é€ â€œevent: message data: xxxâ€ å½¢å¼æ•°æ®ç»™å®¢æˆ·ç«¯
		c.SSEvent("message", chunk)
		return true
	})
```

**åœ¨ Gin æ¡†æ¶å†…ï¼Œc.SSEvent æ–¹æ³•ç”¨äºå‘å®¢æˆ·ç«¯å‘é€ Server-Sent Eventsï¼ˆSSEï¼‰äº‹ä»¶ã€‚**

ä½¿ç”¨åŸç”Ÿ Goï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ `fmt.FPrinf` å’Œ `w.Flush` æ¥å®ç°ï¼š

```Go
	w.Header().Set("Content-Type", "text/event-stream")
	w.Header().Set("Cache-Control", "no-cache")
	w.Header().Set("Connection", "keep-alive")
	for {
    // ä»æœåŠ¡ç«¯æ¥æ”¶æµï¼Œå¹¶è¯»å– chunk
		response, err := stream.Recv()
		if errors.Is(err, io.EOF) {
			fmt.Println("\nStream finished")
			return
		}
		if err != nil {
			fmt.Printf("\nStream error: %v\n", err)
			return
		}
    // å‘é€ â€œevent: message data: xxxâ€ å½¢å¼æ•°æ®å†™å…¥å“åº”ä½“
		fmt.Fprintf(w, "event: message\ndata: %s\n", response.Choices[0].Delta.Content)
    // è¿”å›æ•°æ®ç»™å®¢æˆ·ç«¯
		w.(http.Flusher).Flush()
	}
```

é™¤äº† SSEï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç›´æ¥ä¼ è¾“ Stream æµç»™å®¢æˆ·ç«¯ï¼Œéœ€è¦ä¿®æ”¹ Headers å’Œå†™å…¥ Response çš„æ–¹å¼ï¼š

```go
	w.Header().Set("Content-Type", "text/plain")
	for {
    // ä»æœåŠ¡ç«¯æ¥æ”¶æµï¼Œå¹¶è¯»å– chunk
		response, err := stream.Recv()
		if errors.Is(err, io.EOF) {
			fmt.Println("\nStream finished")
			return
		}
		if err != nil {
			fmt.Printf("\nStream error: %v\n", err)
			return
		}
    // é€šè¿‡ io åŒ…å†™å…¥å“åº”ä½“
		io.WriteString(w, response.Choices[0].Delta.Content)
    // è¿”å›æ•°æ®ç»™å®¢æˆ·ç«¯
		w.(http.Flusher).Flush()
	}
```

## ä½¿ç”¨ Redis ç¼“å­˜æ•°æ®

åœ¨é¡¹ç›®å†…åŸºäº[Redis client for Go](https://github.com/redis/go-redis?tab=readme-ov-file)å°è£…æ•°æ®ç¼“å­˜æ–¹æ³•ã€‚

:::warning

æˆ‘ä»¬ä½¿ç”¨ v9 ç‰ˆæœ¬ï¼Œå¯¹åº” redis-server v7ã€‚

:::

[å®ç°å‚è€ƒ](https://github.com/yayapao/goars/blob/main/pkg/redis/client.go)

## Features Design

### Sentence Module

Sentence æ¨¡å—ç”¨æ¥å¸®åŠ©æˆ‘å¿«é€Ÿç§¯ç´¯è‹±è¯­è¯æ±‡ã€‚åœ¨é˜…è¯»è®¡ç®—æœºç›¸å…³çš„æ–‡ç« ã€github ç­‰æ—¶ï¼Œå°†é‡ç‚¹å¥å­è¿›è¡Œè®°å½•ï¼Œç”± Sentence Processor è¿›è¡Œä¸€ç³»åˆ—çš„å¤„ç†åï¼Œå¯¹é‡ç‚¹è¯æ±‡è¿›è¡Œå‚¨å­˜ã€‚å¹¶ä¸”æ”¯æŒä»ä¸åŒç»´åº¦è¿›è¡ŒæŸ¥è¯¢ã€‚

![sentence-module](/img/langs/go/sentence-module.svg)

è¿™é‡Œå±•ç¤º sentence Model åœ¨æ’å…¥ã€æŸ¥è¯¢æ—¶çš„å¤„ç†è¿‡ç¨‹ã€‚

:::note packages

- tokenizer - https://github.com/jdkato/prose
- stemming - https://github.com/kljensen/snowball
- lemmatization - https://github.com/aaaton/golem/
- stopWords - https://en.wikipedia.org/wiki/Most_common_words_in_English

:::

1. æ’å…¥ä»¥ sentence ä¸ºä¸»ä½“ï¼Œåˆ†åˆ«è¿›è¡Œ sentence æ’å…¥ã€åˆ†è¯å¤„ç†ã€‚

- æˆ‘ä»¬å°†å¯¹ sentence çš„å¤„ç†æ”¾åœ¨ goroutine å†…ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¼‚æ­¥è¿‡ç¨‹ã€‚å½“æ¥æ”¶ç”¨æˆ·å­˜å‚¨ sentence è¯·æ±‚åï¼Œä¼šåˆ¤æ–­å…¶å­˜åœ¨æ€§ï¼Œè¿™é‡Œä½¿ç”¨ `LIKE` è¯­å¥ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™å°†å…¶æ’å…¥ _Sentence Table_ å¹¶è¿”å›æ’å…¥ç»“æœã€‚ä¸æ­¤åŒæ—¶ï¼Œä¼šå¦èµ·ä¸€ä¸ªçº¿ç¨‹å¯¹ sentence è¿›è¡Œå¤„ç†ã€‚

- å¯¹ sentence å¤„ç†åŒ…æ‹¬ tokenizerï¼ˆåˆ†è¯ï¼‰-> Filterï¼ˆå»é™¤æ ‡ç‚¹å’Œå•å­—æ¯ï¼‰-> case-insensitiveï¼ˆå¤§å°å†™å»æ•ï¼‰-> Filterï¼ˆé€šç”¨å•è¯è¿‡æ»¤ï¼‰-> lemmatizationï¼ˆè¯å½¢è¿˜åŸï¼‰-> Deduplicationï¼ˆå»é‡ï¼‰ã€‚

- åœ¨ç»å†ä¸Šè¿°å¤„ç†åï¼Œæˆ‘ä»¬ä¼šå¾—åˆ° word sliceï¼Œåœ¨æ’å…¥ _Word Table_ ä¹‹å‰ï¼Œåˆ¤æ–­å­˜åœ¨æ€§ï¼Œè¿™é‡Œä½¿ç”¨ `IN` è¯­å¥ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è¿›è¡Œæ’å…¥ï¼Œå¹¶è¿”å›æ¯ä¸ª wordIDã€‚åŒæ—¶æ‰‹åŠ¨ç»´æŠ¤ sentenceID å’Œ wordID çš„å¯¹åº”å…³ç³»ã€‚

2. æŸ¥è¯¢æ”¯æŒé€šè¿‡ sentence æŸ¥è¯¢å…¶å…³è”çš„ sentenceï¼Œæˆ–è€…é€šè¿‡ sentence æŸ¥è¯¢å…¶å…³è”çš„ wordã€‚

- å¯¹äºç¬¬ä¸€ç§æƒ…å†µï¼Œéœ€è¦å¯¹ sentence è¿›è¡ŒåŒæ­¥ tokenizer æµç¨‹å¤„ç†ï¼Œæ ¹æ®è¿”å› word slice è¿›è¡ŒåŒ¹é…
- å¯¹äºç¬¬äºŒç§æƒ…å†µï¼Œé€šè¿‡ sentenceID æ‰¾å¯»å…¶å…³è” word è¿›è¡Œè¿”å›

#### Why not stemming?

**åœ¨ Sentence Module å†…ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬é€‰æ‹©ç”¨ lemmatizationï¼ˆè¯å½¢è¿˜åŸï¼‰è€Œä¸æ˜¯ stemmingï¼ˆè¯å¹²æå–ï¼‰å‘¢ï¼Ÿ**

:::note

åœ¨ Sentence Module çš„ä½¿ç”¨åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå®Œæˆçš„å•è¯è€Œä¸æ˜¯è¯å¹²ï¼Œå¹¶ä¸”å°†æˆ‘ä»¬å¯ä»¥å¿½ç•¥æ‰§è¡Œæ•ˆç‡å¸¦æ¥çš„å½±å“ï¼ˆå°†å…¶æ”¾å…¥ goroutine å†…æ‰§è¡Œï¼‰ï¼Œå› æ­¤é€‰æ‹©æ›´ä¸ºåˆé€‚çš„ lemmatization æŠ€æœ¯ã€‚

:::

Stemming å’Œ lemmatization éƒ½æ˜¯å°†ç»™å®šå•è¯è¿˜åŸæˆåŸºç¡€å•è¯çš„æŠ€æœ¯ï¼Œstemming é€šè¿‡åŒ¹é…ä¸€ç³»åˆ—è§„åˆ™æ¥åˆ é™¤å‰ç¼€å’Œåç¼€ï¼Œè€Œ lemmatization åˆ™åŸºäºå¯¹è¯­è¨€çš„ç†è§£å¯¹å•è¯è¿›è¡Œæ´¾ç”Ÿï¼ˆéœ€è¦åŠ è½½è¯­æ–™åº“ï¼‰ã€‚å› æ­¤ä¸¤è€…ä¼šå­˜åœ¨å·®å¼‚ï¼š

- å¯¹äºä¸€é—¨æ–°è¯­è¨€ï¼Œsteming æ›´å…·ä¼˜åŠ¿ï¼Œå› ä¸º lemmatization éœ€è¦å»ºç«‹è¯­è¨€ç»“æ„çš„ç›¸å…³æ¨¡å‹
- ä¸¤è€…çš„å®ç°åŸç†å†³å®š stemming æ¯” lemmatization å…·å¤‡æ›´é«˜æ•ˆç‡
- **stemming å¹¶ä¸èƒ½ä¿è¯æœ€åè¾“å‡ºæ˜¯ä¸€ä¸ªçœŸå®å­˜åœ¨çš„å•è¯ï¼Œä½†æ˜¯ lemmatization å¯ä»¥ä¿è¯**

å…³äºç¬¬ä¸‰ç‚¹ï¼Œæˆ‘ä»¬æä¾›ä¸€ä¸ªç›´è§‚çš„ä¾‹å­ï¼š

```

easily --> easili
ponies --> poni
caresses --> caress

```

![stemming-vs-lemmatization.png](https://img.joyjoy.cc/go/stemming-vs-lemmatization.png)

#### å…¨æ–‡æœç´¢ä¸ LIKE è°“è¯æ¯”è¾ƒ

ä¸å…¨æ–‡æœç´¢ç›¸æ¯”ï¼ŒLIKE è°“è¯ä»…é€‚ç”¨äºå­—ç¬¦æ¨¡å¼ï¼Œæ¯”å¦‚ LIKE ä¸èƒ½æŸ¥è¯¢æ ¼å¼åŒ–çš„äºŒè¿›åˆ¶æ•°æ®ã€‚æ­¤å¤–ï¼Œå¯¹äºå¤§é‡éç»“æ„åŒ–çš„æ–‡æœ¬æ•°æ®ï¼Œæ‰§è¡Œ LIKE æŸ¥è¯¢è¦æ¯”å…¨æ–‡æŸ¥è¯¢æ…¢å¾ˆå¤šã€‚

### ImageBed

Imagebed æ¨¡å—ï¼ŒåŸºäº cos çš„å­˜å‚¨èƒ½åŠ›ï¼Œç»“åˆ CDN èƒ½å¤Ÿå¸®åŠ©æˆ‘é«˜æ•ˆåœ°ç®¡ç†ã€æŸ¥çœ‹å›¾ç‰‡ã€‚

:::warning

åœ¨å®¢æˆ·ç«¯æ–‡ä»¶å¤„ç†ç›¸å…³å†…å®¹å‚è€ƒï¼š[åœ¨ React å†…å¤„ç†æ–‡ä»¶](/docs/programming-language/react/react/solution#åœ¨-react-å†…å¤„ç†æ–‡ä»¶) ä»¥åŠ [æ–‡ä»¶ä¸‹è½½](/docs/programming-language/html5/browser/feature#æ–‡ä»¶ä¸‹è½½-)

:::

**ä½¿ç”¨å¸®åŠ©**

- åœ¨ COS ä¸Šä¼ ç›¸åŒè·¯å¾„çš„æ–‡ä»¶ï¼Œæ–°æ–‡ä»¶ä¼šè¦†ç›–æ—§æ–‡ä»¶

#### ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶å®ç°

è¯¥æ¨¡å—çš„éš¾ç‚¹åœ¨äºå¤„ç†å›¾ç‰‡ä¸Šä¼ çš„æµç¨‹ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ³¨æ„ï¼š

- å¯¹å›¾ç‰‡å¤§å°ã€æ ¼å¼è¿›è¡Œæ ¡éªŒï¼Œ**æ³¨æ„æ ¼å¼æ ¡éªŒä»¥è¯»å–æ–‡ä»¶å†…å®¹è¿›è¡Œåˆ¤æ–­**ï¼Œå‚è€ƒ[validateFileType](https://github.com/YaYaPao/docscripts/blob/main/go/utils/validateFileType.go)
- å­˜å‚¨å›¾ç‰‡çš„é•¿/å®½ï¼Œä»¥ä¿è¯å›¾ç‰‡çš„å®é™… ratioï¼Œå‚è€ƒ[GetImageFileSize](https://github.com/YaYaPao/docscripts/blob/main/go/utils/GetImageFileSize.go)
- **å¤šæ¬¡è¯»å–æ–‡ä»¶åï¼Œéœ€è¦å¤ä½ä¹‹ååœ¨è¿›è¡Œæ“ä½œ**

#### å›¾ç‰‡ä¸å¤±çœŸ

1. ğŸ‘ é€šè¿‡ CSS [`aspect-ratio`](https://developer.mozilla.org/en-US/docs/Web/CSS/aspect-ratio) å±æ€§æ¥è®¾ç½®çˆ¶å®¹å™¨æˆ–è€…å›¾ç‰‡æœ¬èº«ï¼›

2. ä»…è®¾ç½® img çš„ height æˆ–è€… width å±æ€§ï¼Œè®©å…¶æŒ‰æ¯”ä¾‹è‡ªåŠ¨è®¾ç½®ï¼›

3. è®¡ç®— ratio åï¼Œé€šè¿‡ js è¿›è¡Œè®¾ç½®ï¼›

## Coding Skills

### èšåˆæŸ¥è¯¢ç»“æœ

å‡å®šè¿™æ ·ä¸€ä¸ªæŸ¥è¯¢åœºæ™¯ï¼šæ ¹æ® N ä¸ª Person æŸ¥è¯¢å…¶å¯¹åº”çš„é“¶è¡Œå¡ä¿¡æ¯ã€‚ç°åœ¨å­˜åœ¨ä¸¤ç§å¤„ç†æ–¹å¼ï¼š

1. è½®è¯¢ Person åˆ—è¡¨ï¼Œæ¯ä¸ª Person å‘æ•°æ®åº“å‘èµ·ä¸€æ¬¡æŸ¥è¯¢é“¶è¡Œå¡ä¿¡æ¯çš„è¯·æ±‚ï¼›
2. é€šè¿‡ `IN` è·å–ä¸€æ‰¹ Person çš„é“¶è¡Œå¡ä¿¡æ¯åï¼Œå†åœ¨åº”ç”¨å±‚è¿›è¡Œåˆ†ç±»ï¼›

æˆ‘ä»¬é€‰æ‹©ç¬¬äºŒç§æ–¹å¼æ¥è§£å†³ï¼Œå› ä¸ºæ•°æ®åº“æœ¬èº«æ˜¯å¾ˆè„†å¼±çš„ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦èšåˆæŸ¥è¯¢ç»“æ„ã€‚

```go

type Card struct {
  ID     uint
  Number uint
}

type Person struct {
  ID   uint
  Name string
}

type QueryResponse struct {
  Person
  Cards []Card
}


func FindPersonBindingCards(data []string) ([]QueryResponse, error) {
  // æ ¹æ®å§“åæŸ¥è¯¢ Person åˆ—è¡¨ï¼Œå³ []Person
	people, _ := models.QueryPeopleFromName(data)
	var personID []uint
  // mappings ç”¨æ¥è¡¨ç¤º personID å’Œ QueryResponse çš„å¯¹åº”å…³ç³»
	mappings := make(map[uint]*QueryResponse)
  // å£°æ˜ resï¼Œä½œä¸ºæœ€ç»ˆè¿”å›ç»“æœï¼Œéå† mappings å°† value å†™å…¥ res
	var res []QueryResponse

	for _, p := range people {
		personID = append(personID, p.ID)
		mappings[p.ID] = &QueryResponse{
			ID:        p.ID,
			Name:      p.Name,
			Cards:     []Card{},
		}
	}
  // æ ¹æ® personID æŸ¥è¯¢ä¸å…¶å…³è”çš„æ‰€æœ‰ Card ä¿¡æ¯ï¼Œè¿”å›ç»“æœæ˜¯åŒ…å« PersonID å’Œ Card ä¿¡æ¯çš„åˆ‡ç‰‡
	cards, _ := models.QueryCardByPersonIDSlice(personID)

  // éå† cards æ ¹æ® card.PersonID å‘ mappings.Cards å†…è¿›è¡Œå¡«å……
	for _, card := range cards {
		if _, ok := mappings[card.PersonID]; ok {
			mappings[card.PersonID].Cards = append(mappings[card.PersonID].Cards, Card{
				ID:       card.ID,
				Number:   card.Number,
			})
		}
	}

  // éå† mappings ç”Ÿæˆæœ€ç»ˆ result è¿›è¡Œè¿”å›
	for _, value := range mappings {
		res = append(res, *value)
	}
	return res, nil
}

```

åœ¨å®ç°è¿‡ç¨‹ä¸­éœ€è¦æ³¨æ„ï¼š

- å£°æ˜ map å¯¹è±¡æ—¶éœ€è¦å°†å…¶å®ä¾‹åŒ–ï¼Œæ¯”å¦‚ `var mappings map[uint]string` å¹¶ç›´æ¥ä¸ºå…¶èµ‹å€¼ä¼šäº§ç”Ÿé”™è¯¯ï¼Œéœ€è¦ `mappings := make(map[uint]string)` æˆ–è€… `mappings := map[uint]string{}` å°†å…¶è¿›è¡Œå®ä¾‹åŒ–
- åœ¨ç»™ `mappings[card.PersonID].Cards` è¿›è¡Œèµ‹å€¼è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°è¿‡ [can't assign to xxx é”™è¯¯](https://stackoverflow.com/questions/32751537/why-do-i-get-a-cannot-assign-error-when-setting-value-to-a-struct-as-a-value-i)ï¼Œé€šè¿‡å–å€/å–å€¼æ“ä½œç¬¦è¿›è¡Œè§£å†³ã€‚åŸå› åœ¨äº map å¯¹è±¡å·¦ä¾§æ“ä½œå¿…é¡»æ˜¯ **addressable**ï¼Œè€Œ `mappings[card.PersonID]` å¹¶ä¸èƒ½ä¿è¯ã€‚
