---
id: feature
title: ''
sidebar_label: Feature
slug: feature
---

import { DocsHeader } from '/src/components/Layout/DocsHeader'

<DocsHeader
  title="Browser Feature"
  description="æµè§ˆå™¨ç‰¹æ€§åŠå…¶ä½¿ç”¨"
  tags={['Browser']}
  links={[
    {
      label: 'Complete guide to file download in browsers',
      link: 'https://cybercafe.dev/complete-guide-to-file-download-in-browsers/',
    },
  ]}
/>{' '}

## æ–‡ä»¶ä¸‹è½½ â¬

åœ¨æµè§ˆå™¨ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œä¼šå‘ç°å…¶å¯¹äºä¸åŒæ–‡ä»¶æœ‰ä¸åŒçš„å¤„ç†æ–¹å¼ï¼šå®ƒæ—¢å¯ä»¥é¢„è§ˆæ–‡ä»¶å†…å®¹ï¼Œæ¯”å¦‚æŸ¥çœ‹å›¾ç‰‡æˆ–è€… PDF æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä¸‹è½½ .zip åŒ…ã€‚

é€šå¸¸è€Œè¨€ï¼Œ**æµè§ˆå™¨ä¼šæ ¹æ®æ–‡ä»¶å†…å®¹è‡ªåŠ¨è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœä¸èƒ½ç›´æ¥æ‰“å¼€ï¼Œåˆ™ä¼šå°†å…¶ä¸‹è½½**ã€‚ä½†æ˜¯åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦ä¸»åŠ¨å»ä¸‹è½½ image/PDF æ–‡ä»¶ã€‚

æˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸Šèƒ½å¤Ÿå®ç°ä¸¤ç§ä¸‹è½½æ–‡ä»¶çš„æ–¹å¼ï¼Œè¿™é‡Œæˆ‘ä»¬å°†é‡ç‚¹è®¨è®ºç¬¬äºŒç§æ–¹å¼ã€‚

1. å³é”®â€œå¦å­˜ä¸ºâ€ï¼›
2. ç‚¹å‡»æŒ‰é’®ç›´æ¥ä¸‹è½½ï¼Œæ¯”å¦‚åœ¨ unsplash ä¸Šä¸‹è½½å›¾ç‰‡ï¼›

![browser-download.png](https://img.joyjoy.cc/html5/browser-download.png)

é€šè¿‡å®¡æŸ¥å…ƒç´ ï¼Œæˆ‘å‘ç° unsplash åœ¨å¤„ç†æ–‡ä»¶ä¸‹è½½æ—¶ï¼š

- é€šè¿‡ `<a>` æ ‡ç­¾çš„ download å±æ€§æ¥è¡¨æ˜è¯¥å›¾ç‰‡éœ€è¦ä¸‹è½½ï¼›
- å›¾ç‰‡åœ°å€å’Œå½“å‰é¡µé¢åœ°å€åŒæºï¼›

`download` å±æ€§ä¸å¿…å¤šè¯´ï¼Œç”¨æ¥å‘æµè§ˆå™¨è¡¨æ˜è¢«ä¸‹è½½çš„è¶…é“¾æ¥ç›®æ ‡ï¼Œé€šå¸¸è¡¨ç¤ºä¸‹è½½æ–‡ä»¶çš„åç§°ã€‚**åœ¨å®é™…åœºæ™¯ä¸‹ï¼Œå¦‚æœå›¾ç‰‡åœ°å€å’Œé¡µé¢ä¸åŒæºï¼Œå³ä½¿å·²ç»è®¾ç½®äº† download å±æ€§ï¼Œæ–‡ä»¶ä»ç„¶æ˜¯ç›´æ¥æ‰“å¼€ï¼Œè€Œä¸æ˜¯ä¸‹è½½ã€‚**

**ğŸ‘† æ˜¯ç”±äº HTTP Header `Content-disposition` å±æ€§ä¸å…¶ä¼˜å…ˆçº§å†³å®šçš„ã€‚**

1. `content-disposition` ä¸ºæœåŠ¡ç«¯è¿”å›çš„è¯·æ±‚æŠ¥æ–‡å¤´éƒ¨å­—æ®µï¼Œå…¶å€¼ä¸¾ä¾‹ï¼š`Content-Disposition: Attachment; filename=image.png`ï¼›
2. `content-disposition` å’Œ `download` å±æ€§éƒ½èƒ½å¤Ÿä½œç”¨äºä¸‹è½½æ–‡ä»¶çš„åç§°ï¼›
3. å¦‚æœ HTTP response å†…ï¼ŒHeader åŒ…å« `content-disposition` å­—æ®µï¼Œå¹¶ä¸”å€¼ä¸º `attachment`ï¼Œåˆ™å…¶æ‹¥æœ‰æœ€é«˜ä¼˜å…ˆçº§ï¼›ä¸”æ— è®ºæ–‡ä»¶ç±»å‹å¦‚ä½•ï¼Œå®ƒéƒ½å°†è¢«ä¸‹è½½ï¼›
4. å¦‚æœ `content-disposition` è¢«è®¾ç½®ä¸º `inline`ï¼Œä¸åŒæµè§ˆå™¨ä¼šå­˜åœ¨å·®å¼‚ï¼ŒFireFox æµè§ˆå™¨ä¼šä»¥å®ƒä¼˜å…ˆï¼Œä½†æ˜¯ Chrome åˆ™ä¼šä»¥ download ä¼˜å…ˆï¼›

:::caution Exceptions

ä¸Šé¢è®¨è®ºçš„æ˜¯å›¾ç‰‡åœ°å€ä¸º http çš„å½¢å¼ï¼Œå¦‚æœå›¾ç‰‡åœ°å€ä¸º `blob` æˆ–è€… `base64` çš„å½¢å¼ï¼Œåˆ™ä¸å­˜åœ¨è·¨åŸŸé—®é¢˜ï¼Œå¯ä»¥ç›´æ¥ä¸‹è½½ã€‚

:::

## è·¨åŸŸ

å‡ºäºæµè§ˆå™¨çš„åŒæºç­–ç•¥é™åˆ¶ï¼Œåè®®ï¼Œä¸»æœºåï¼Œç«¯å£ä»»ä¸€ä¸åŒåˆ™å½¢æˆè·¨åŸŸ

è§£å†³è·¨åŸŸçš„åŠæ³•ï¼š

- é€šè¿‡ Nginx åå‘ä»£ç†
- ç»“åˆ src å±æ€§ï¼Œé€šè¿‡ jsonp æ¥å¤„ç†è·¨åŸŸ
- iframe é€šè¿‡ postMessage å’Œ addEventListener('message')
- é€šè¿‡ websocket è¿›è¡Œé€šä¿¡

jsonp ç¼ºç‚¹ï¼š

- åªèƒ½ä½¿ç”¨ get è¯·æ±‚
- å®‰å…¨é—®é¢˜
- ä¸èƒ½è¿”å›å„ç§ http çŠ¶æ€ç 

```js
// postMessage
// å‘èµ·æ–¹
var traget = document.getElementById('#test').postMessage('hello');
// æ¥æ”¶æ–¹é€šè¿‡äº‹ä»¶ç›‘å¬
window.addEventListener('message', function (e) {});

// jsonp
// å‘æœåŠ¡å™¨test.comå‘å‡ºè¯·æ±‚ï¼Œè¯¥è¯·æ±‚çš„æŸ¥è¯¢å­—ç¬¦ä¸²æœ‰ä¸€ä¸ªcallbackå‚æ•°ï¼Œç”¨æ¥æŒ‡å®šå›è°ƒå‡½æ•°çš„åå­—
<script src="http://test.com/service?callback=dosomething"></script>

// å¤„ç†æœåŠ¡å™¨è¿”å›å›è°ƒå‡½æ•°
<script type="text/javascript">
    function dosomething(res){
        // å¤„ç†è·å¾—çš„æ•°æ®
        console.log(res.data)
    }
</script>

// æœåŠ¡å™¨å›ä¼ æ•°æ®
dosomething({data: data});


// websocket
// å»ºç«‹ä¸€ä¸ª websocket å®ä¾‹å¯¹è±¡
var socket = new WebSocket("ws://www.test.com/service/data.do");
// åªèƒ½å¤Ÿå‘é€å°‘é‡ string ç±»å‹çš„æ•°æ®
socket.send('hello');
// å®¢æˆ·ç«¯æ¥å—æœåŠ¡ç«¯ä¿¡æ¯ï¼Œé€šè¿‡ç›‘å¬ message
socket.on('message', function(event) {
    var data = event.data;
})
// å…³é—­ socket åè®®
socket.close();
```

### iframe è·¨åŸŸé—®é¢˜

è¿™é‡Œè®°å½•ä¸€ä¸‹é¡¹ç›®å†…ç¢°åˆ°çš„è·¨åŸŸé—®é¢˜ä»¥åŠè§£å†³åŠæ³•

iframe ç›¸å…³è·¨åŸŸé—®é¢˜

- [CSP: frame-ancestors](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors)

iframe srcdoc å±æ€§å°è¯•å’Œæ‹‰å–æŒ‡å®š url çš„ documentï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼š

- é€šè¿‡ http è¯·æ±‚è·å–æŒ‡å®š url çš„æ–‡æ¡£æ¨¡å‹
- é€šè¿‡ http è¯·æ±‚è·å–ä»ç„¶å­˜åœ¨è·¨åŸŸé—®é¢˜ï¼Œé€šè¿‡æ›¿æ¢æˆå…¶ä»– urlï¼Œå‘ç°å¯ä»¥è·å–åˆ° html å…ƒç´ ï¼Œä½†æ˜¯å…¶ä¸­çš„å¼•ç”¨èµ„æºï¼Œå¦‚æœæœ¬èº«æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œåˆ™ä¼šåœ¨æœ¬åŸŸåŠ è½½ä¸åˆ°
- åœ¨è¯·æ±‚è¿‡ç¨‹ä¸­æœåŠ¡å™¨åšäº†ä¸€æ¬¡è½¬å‘ï¼Œå› æ­¤ä¼šå‡ºç° 302 çŠ¶æ€ç ï¼Œç›´æ¥è¢« onerror æ•è·é”™è¯¯

```js
// è·å–æŒ‡å®šurlçš„document
getUrl () {
  var request = this.makeHttpObject()
  request.open("GET", targetUrl, true)
  request.send(null)
  request.addEventListener("loadend", function (e) {
    console.log(e.target.responseText)
    self.$refs.iframe.srcdoc = e.target.responseText
  })
  request.addEventListener("error", function (e) {
    const headers = request.getResponseHeader("location")
    console.log({ e, headers })
  })
},
```

## åœ¨æµè§ˆå™¨è¾“å…¥ URL çš„æ‰§è¡Œè¿‡ç¨‹

URL ç»“æ„ï¼š

- scheme: é€šä¿¡åè®®ï¼Œæ¯”å¦‚ https ç­‰
- host: ä¸»æœºåœ°å€
- port: ç«¯å£å·ï¼Œç”¨æ¥æ ‡å¿—è¿›ç¨‹
- path: è™šæ‹Ÿæ–‡ä»¶è·¯å¾„ï¼Œè¯´æ˜èµ„æºä½äºæœåŠ¡å™¨ä»€ä¹ˆåœ°æ–¹
- query: æŸ¥è¯¢å‚æ•°
- hash: ä¿¡æ¯ç‰‡æ®µå­—ç¬¦ä¸²ï¼Œé”šç‚¹éƒ¨åˆ†

æ˜ç¡®ä¸€ä¸ªæ¦‚å¿µï¼Œä¸€ä¸ª URL å°±æ˜¯ä¸€ä¸ªç‰¹å®šèµ„æºï¼Œè¯¥èµ„æºå¯èƒ½éœ€è¦å¼•ç”¨å¤šä¸ªå…¶ä»–èµ„æºä½œä¸ºæ”¯æ’‘

æœåŠ¡ç«¯äº¤äº’è·å–æ¸²æŸ“å¯¹è±¡

- DNS è§£æ
- HTTP è¯·æ±‚ï¼ˆ TCP ä¸‰æ¬¡æ¡æ‰‹ï¼Œå››æ¬¡åˆ†æ‰‹ï¼Œè¯·æ±‚/å“åº”æŠ¥æ–‡ç»“æ„ï¼ŒCookieï¼Œä»£ç†æœåŠ¡å™¨ï¼‰

é€šè¿‡æµè§ˆå™¨æ¸²æŸ“æŒ‡å®šçš„èµ„æºæ–‡ä»¶

- æ¸²æŸ“å…³é”®è·¯å¾„
- é‡ç»˜å’Œå›æµ
