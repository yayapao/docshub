---
id: jsx
title: 'JSX & createElement'
sidebar_label: jsx
---

import { DocsHeader } from '/src/components/Layout/DocsHeader'
import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

## JSX && createElement

**为什么 React 使用 JSX 来组织代码，而不是传统的 CSS + HTML + JS?**

    “Web 的交互性越来越强，逻辑越来越决定页面中的内容”

参考 [createElement – React](https://react.dev/reference/react/createElement)，我们不难看出，**JSX 可以看作是 createElement 的语法糖，因为 JSX 在编译阶段会被转换为 createElement 函数调用。** 因此，我理解 JSX 是一种约定的语法规范，可以在编译阶段通过 `@babel/plugin-transform-react-jsx` 将其转换为 `React.createElement` 方法调用。

:::warning

JSX 并不是一定只能转换成 **createElement** 方法，你可以修改 @babel/plugin-transform-react-jsx 方法将其转换成其他函数，比如在 preact 内会将 JSX 转换为 **h** 方法

:::

<Tabs>
  <TabItem value="jsx" label="JSX" default>
    <code>
      {`
    export function App() {
      return <div className="app">Hello, React</div>
    }
    `}
    </code>
  </TabItem>
  <TabItem value="createElement" label="createElement">
    <code>
      {`
    export function App() {
      return React.createElement('div', { className: 'app' }, 'Hello, React')
    }
    `}
    </code>
  </TabItem>
</Tabs>

从源码 [React \* createElement 实现](https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react/src/ReactElement.js#L348) 可以看出，**createElement 最终输出一个 ReactElement 对象，除了其他属性回传之外，会增加 `$$typeof: REACT_ELEMENT_TYPE` 来标记当前元素为 React 元素。**

```jsx title="/packages/react/src/ReactElement.js"
export function createElement(type, config, children) {
  let propName

  // Reserved names are extracted
  const props = {}

  let key = null
  let ref = null
  let self = null
  let source = null

  // ...分别从 config 内提取 ref 和 key 并赋值给当前变量...
  // ...遍历 config 将其key和value赋值给 props
  // ...处理 children，如果传多个，则将其写入数组内，最终赋值给 props.children
  // ...处理 defaultProps

  return ReactElement(
    type,
    key,
    ref,
    self,
    source,
    ReactCurrentOwner.current,
    props
  )
}
```

ReactElement 重点关注，返回值多了个 `$$typeof` 用来标记当前元素为 React 元素。

```js title="/packages/react/src/ReactElement.js"
function ReactElement(type, key, ref, self, source, owner, props) {
  const element = {
    // This tag allows us to uniquely identify this as a React Element
    $$typeof: REACT_ELEMENT_TYPE,

    // Built-in properties that belong on the element
    type: type,
    key: key,
    ref: ref,
    props: props,

    // Record the component responsible for creating this element.
    _owner: owner,
  }

  return element
}
```
