---
id: husky
title: Husky
sidebar_label: Husky
---

import { HighlightWithCode } from '/src/components/Highlights'

:::info Husky - Modern native git hooks made easy!

[Husky](https://typicode.github.io/husky/#/?) èƒ½å¤Ÿè®©æˆ‘ä»¬åœ¨é¡¹ç›®å†…è½»æ¾ä½¿ç”¨ [githooks](https://git-scm.com/docs/githooks)!

:::

åœ¨ä»‹å…¥ git ç”Ÿå‘½å‘¨æœŸï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ§åˆ¶å›¢é˜Ÿå†…æäº¤ä»£ç çš„æµç¨‹ï¼Œæ¯”å¦‚**æ ¼å¼åŒ–ä»£ç ã€ç»Ÿä¸€æäº¤ä¿¡æ¯ã€æ‰§è¡Œæµ‹è¯•è„šæœ¬ã€æ£€æµ‹æ•æ„Ÿä¿¡æ¯**ç­‰ç­‰

è¿™é‡Œè®°å½• husky çš„å¸¸ç”¨æ“ä½œï¼š

```shell
# 1. å¼•å…¥ husky
npm install husky --save-dev

# 2. å¯ç”¨ githooks
npx husky install

# 3. åˆ›å»º githooksï¼Œä¸‹é¢ä»£ç ç›¸å½“äºåˆ›å»ºä¸€ä¸ªæŒ‡å®šæ‰§è¡Œè„šæœ¬çš„ commit-msg é’©å­ï¼Œ åç»­å¯ä»¥è‡ªå·±åœ¨ .husky å†…è¿›è¡Œä¿®æ”¹
npx husky add .husky/commit-msg 'node scripts/verify_commit.mjs'
```

## Commit Message

ä¸€ä¸ªå¥½çš„ Commit Message éœ€è¦è¶³å¤Ÿç®€æ´ï¼Œä½†æ˜¯åˆä¸å¤±å¯è¯»æ€§ï¼Œå¹¶ä¸”èƒ½å¤Ÿè®©å¼€å‘è€…å¿«é€Ÿå›æº¯æäº¤å†å²è®°å½•ã€‚

### éªŒè¯ Commit Message æµç¨‹ï¼Ÿ

1. åœ¨ commit-msg.sh å†…ï¼Œé€šè¿‡è¯»å– `$1` ä¼ å‚å¯ä»¥è·å–æäº¤ä¿¡æ¯çš„ä¿å­˜è·¯å¾„ï¼Œä¹‹åé€šè¿‡è¯»å–è¯¥è·¯å¾„çš„æ–‡ä»¶ä¿¡æ¯ï¼Œè·å–æäº¤ä¿¡æ¯ï¼Œé€šå¸¸ä¿å­˜åœ¨ `./.git/COMMIT_EDITMSG`

2. é€šè¿‡å¤„ç† Commit Message å†…å®¹ï¼Œé€šè¿‡æ­£åˆ™åŒ¹é…ç­‰æ‰‹æ®µï¼Œå°†é¢„åˆ¶å®šçš„è§„åˆ™è¿›è¡ŒéªŒè¯ï¼ŒéªŒè¯ä¸é€šè¿‡åˆ™ç»™å‡ºé”™è¯¯æç¤ºï¼›

3. å¯¹äºè§„åˆ™ï¼Œèƒ½å¤Ÿç®€æ˜æ‰¼è¦åœ°è¾“å‡ºç»™ç”¨æˆ·ï¼›

### åˆ¶å®š Commit Message è§„åˆ™

é¦–å…ˆéœ€è¦æ˜ç¡®ï¼Œæ¯æ¬¡ Commit Message éƒ½åº”è¯¥æ˜¯å•ä¸€èŒè´£å’Œç¨³å®šçš„æ”¹å˜ã€‚è¿™é‡Œæˆ‘å°†è®°å½• Commit Message çš„éªŒè¯è§„åˆ™ï¼Œè‡³äºå¦‚ä½•å®æ–½å’ŒåŒ¹é…ï¼Œè¿™é‡Œä¸å±•å¼€è§£é‡Šã€‚

**General Rules** å‚è€ƒ [sentry commit message](https://develop.sentry.dev/commit-messages/)

![commit-message.png](https://img.joyjoy.cc/software/commit-message.png)

ğŸ‘† å±•ç¤ºä¸€ä¸ªç»å…¸çš„ Commit Messageï¼Œå®ƒéœ€è¦æ»¡è¶³ï¼š

- ä¸»æ—¨å¥ç”¨æ¥æ€»ç»“å†…å®¹ï¼Œbody å†…å®¹ç”¨æ¥è¡¨è¾¾åŸå› ã€è§£å†³æ–¹æ¡ˆæˆ–è€…è¿›ä¸€æ­¥è¯´æ˜
- ä¸»æ—¨è¡Œå°äº 70 ä¸ªå­—ç¬¦
- å¦‚æœæœ‰ body å†…å®¹ï¼Œéœ€è¦ä»¥æ¢è¡Œç¬¦å’Œä¸»æ—¨è¡Œéš”å¼€
- **body å†…å®¹éƒ½éœ€è¦é¦–å­—æ¯å¤§å†™ï¼Œä¸»æ—¨è¡Œä¸éœ€è¦**
- body å†…ç”¨è¦ä»¥è‹±æ–‡å¥å·ç»“æŸï¼Œä¸»æ—¨è¡Œåˆ™ä¸éœ€è¦
- ä¸»æ—¨è¡Œä½¿ç”¨ç¥ˆä½¿å¥ï¼Œå³é€šå¸¸ä»¥åŠ¨è¯å¼€å§‹

å¯¹äº keywordï¼Œå¯ä»¥å‚è€ƒ [angular conventional commits](https://www.conventionalcommits.org/en/v1.0.0-beta.4/#summary)ï¼ŒåŒæ—¶éœ€è¦æ”¯æŒ [gitemoji](https://gitmoji.dev/)

```
<type>(<scope>): <short summary>
  â”‚       â”‚             â”‚
  â”‚       â”‚             â””â”€â«¸ Summary in present tense. Not capitalized. No period at the end.
  â”‚       â”‚
  â”‚       â””â”€â«¸ Commit Scope: Effected module
  â”‚
  â”‚
  â””â”€â«¸ Commit Type: build|ci|docs|feat|fix|perf|refactor|test... | Or gitemoji
```

## ç»“åˆ lint-staged ä½¿ç”¨

[lint-staged](https://github.com/okonet/lint-staged) æ˜¯ä¸€ä¸ªèƒ½å¤Ÿå¯¹ git æš‚å­˜åŒºæ–‡ä»¶æ‰§è¡Œ shell ä»»åŠ¡çš„å·¥å…·ï¼Œé€šå¸¸æˆ‘ä»¬ç»“åˆ lint å·¥å…·å’Œ `pre-commmit` é’©å­æ¥ä½¿ç”¨ã€‚

æˆ‘ä»¬åœ¨æäº¤ä»£ç ä¹‹å‰ï¼Œè¿›è¡Œ lint æ£€æµ‹å’Œä¿®æ­£ï¼Œèƒ½å¤Ÿé˜»æ­¢ä¸è§„èŒƒçš„ä»£ç æäº¤åˆ°ä»“åº“ä¸­ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬æ¯æ¬¡éƒ½å¯¹é¡¹ç›®å†…æ‰€æœ‰æ–‡ä»¶è¿›è¡Œ lintï¼Œæ•´ä¸ªæµç¨‹ä¼šå˜å¾—æ— æ¯”ç¼“æ…¢ã€‚è€Œ lint-staged é€šè¿‡å¯¹æ¯æ¬¡æäº¤çš„å¢é‡æ–‡ä»¶è¿›è¡Œæ‰«æå’Œä¿®æ­£ï¼Œèƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬è§£å†³ä¸Šè¿°é—®é¢˜ã€‚

:::caution
`lint-staged` æ˜¯æœ¬èº«ä¸å…·å¤‡ format çš„èƒ½åŠ›ï¼Œä½ ä»ç„¶éœ€è¦å®‰è£… ESLintã€Prettier ç­‰ä»£ç æ ¼å¼åŒ–å·¥å…·ã€‚
:::

é¦–å…ˆï¼Œæˆ‘ä»¬é€šè¿‡ husky æš´éœ² pre-commitï¼Œå¹¶ä¸ºå…¶é’©å­é…ç½®æ‰§è¡Œè„šæœ¬ï¼š

```bash
npx husky add .husky/pre-commit 'npm run lint-staged'
```

åœ¨ `package.json` å†…é…ç½®å¯åŠ¨è„šæœ¬ï¼ˆèƒ½å¤Ÿæ”¯æŒæ‰‹åŠ¨æ‰§è¡Œï¼‰ï¼š

```json
{
  "scripts": {
    "lint-staged": "lint-staged -c ./.husky/lintstagedrc.cjs"
  }
}
```

åœ¨ `./husky` å†…åˆ›å»º lint-staged çš„æ‰§è¡Œé…ç½®ï¼Œå®é™…ä¸Šå°±æ˜¯**ç­›é€‰æ–‡ä»¶è§„åˆ™ï¼šforamt å‘½ä»¤**ï¼Œè¿™é‡Œæä¾›ä¸€ä¸ªå‚è€ƒï¼š

```js
module.exports = {
  '*.{js,jsx,ts,tsx}': ['eslint --fix', 'prettier --write'],
  '{!(package)*.json,*.code-snippets,.!(browserslist)*rc}': [
    'prettier --write--parser json',
  ],
  'package.json': ['prettier --write'],
  '*.vue': ['eslint --fix', 'prettier --write', 'stylelint --fix'],
  '*.{scss,less,styl,html}': ['stylelint --fix', 'prettier --write'],
  '*.md': ['prettier --write'],
}
```

## Q&A

### æäº¤åçš„æ–‡ä»¶åº”ç”¨é»˜è®¤æ ¼å¼åŒ–é…ç½®ï¼Œè€Œä¸æ˜¯è‡ªå®šä¹‰çš„é…ç½®ï¼Ÿ

æˆ‘ä»¬åœ¨ husky å†…ç»“åˆ lint-staged å¯¹ä¿®æ”¹æ–‡ä»¶åº”ç”¨ eslintã€prettierã€stylelint ç­‰æ ¼å¼åŒ–å·¥ä½œä»¥ä¿è¯æœ€ç»ˆæäº¤çš„å†…å®¹ç»Ÿä¸€æ ¼å¼ã€‚

ä½†æ˜¯å‘ç°ï¼Œæ–‡ä»¶æ ¼å¼åŒ–åº”ç”¨çš„æ˜¯é»˜è®¤é…ç½®ï¼Œ**å³æˆ‘ä»¬è‡ªå®šä¹‰é…ç½®å†…å®¹åœ¨ lint-staged è¿™ä¸ªæµç¨‹æ²¡æœ‰ç”Ÿæ•ˆï¼ˆæ¯”å¦‚ .eslintrc ç­‰ï¼‰**

è§£å†³æ–¹æ¡ˆï¼š

- é…ç½®æ–‡ä»¶çš„åç¼€ä¸ç¬¦åˆè§„èŒƒï¼Œæ¯”å¦‚ç›®å‰å¹¶ä¸æ”¯æŒ `.prettierrc.mjs`ï¼Œå‚è€ƒ[Configuration File](https://prettier.io/docs/en/configuration.html)ï¼Œæ›¿æ¢æ–‡ä»¶åç¼€è§£å†³
