---
id: ECharts
title: Joyutils of ECharts
sidebar_label: ECharts
---

## genPieMockData

安装参考 [获取 ECharts - 入门篇 - 使用手册 - Apache ECharts](https://echarts.apache.org/handbook/zh/basics/download)，这里我们主要介绍 React 中使用 ECharts 的方案。

## 如何实现多个 chart 联动？

:::warning
联动是指，当一个图表展示 tooltips 时，其他图表也展示相同位置的 tooltips。
:::

直接通过设置 `chartInstance.group` 属性，即可实现多个 chart 联动。

```tsx
const chartInstance = echarts.init(dom)
chartInstance.group = 'group' // 设置为 null 则不参与联动
```

### 如何根据 Line 数量来动态设置/取消联动？

联动意味着更大的内存开销，在极端情况下，会导致页面崩溃。因此我们通常需要根据 Line 数量来动态设置/取消联动。

这个问题的难点在于，在什么时机来设置 `group` 属性。我们需要在真实数据加载完成后，再设置 `group` 属性。以避免在初始化时，chart 实例已经创建，而 group 属性无法更改的问题。

```tsx
const YaPolyline: React.FC<YaPolylineEchartsProps> = (props) => {
  const { series = {} } = props
  const chartRef = useRef<any>(null)
  const valueRef = useRef<Record<string, any>>()
  // Set initial value avoid xAxis[0] is undefined bug
  const [chartOptions, setChartOptions] = useState<any>({
    xAxis: { data: [] },
    yAxis: { data: [] },
    series: [],
  })
  let ins: any

  useEffect(() => {
    if (typeof series === 'object') {
      setChartOptions(initOptions)
      valueRef.current = crtOptions
    }
  }, [series, opts])

  useEffect(() => {
    if (typeof maxConnect === 'number') {
      if (series && Array.isArray(series) && series.length > 10) {
        ins.group = null
      } else {
        ins.group = 'monitor'
      }
    }
  }, [series])

  return (
    <ReactEChartsCore
      ref={chartRef}
      echarts={echarts}
      option={chartOptions}
      notMerge={true}
      lazyUpdate={true}
      onChartReady={(instance) => {
        ins = instance
        if (onChartReady) {
          onChartReady(instance, chartOptions)
        }
      }}
    />
  )
}
```

如上，在 `onChartReady` 内，我们通过 `instance` 获取到的配置，时初始化的配置，即空数据。此时真实数据还没有加载，因此我们需要在 `useEffect` 内，根据真实数据来动态设置 `group` 属性。
