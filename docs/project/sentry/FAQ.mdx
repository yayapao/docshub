---
id: faq
title: FAQ
sidebar_label: FAQ
---

import {
  HighlightWithText,
  HighlightWithCode,
} from '/src/components/Highlights'

## Issues

### ä¿¡æ¯è¢« `[Filtered]` å ä½

åœ¨æŸ¥çœ‹é”™è¯¯å­—æ®µæ—¶ï¼Œå‘ç°ä¿¡æ¯è¢« `[Filtered]` å ä½ï¼Œå¹¶å±•ç¤º `Replaced because PII rule "@xxxxxx:filter"`

æ˜¯ç”±äº sentry åŒ¹é…åˆ°æ•æ„Ÿä¿¡æ¯ï¼Œå¹¶å¯¹å…¶è¿›è¡Œå¤„ç†ã€‚**è¯·ç¡®è®¤è¯¥ä¿¡æ¯æ˜¯å¦æœ‰èƒ½å¤Ÿå±•ç¤ºï¼**

ç”¨æˆ·å¯ä»¥é…ç½® `setting > Security & Privacy > Safe Feilds` æ¥æ”¾å¼€æŒ‡å®šæ•æ„Ÿå­—æ®µ

### åœ¨ Issues å†…æ— æ³•é€šè¿‡ SourceMap å®šä½åˆ°æºç 

å‡ºç°è¿™ç§é—®é¢˜ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä»ä¸¤ä¸ªæ–¹å‘è¿›è¡Œæ’æŸ¥ï¼š

1. ä¸Šä¼ å‰ç½®å·¥ä½œæ˜¯å¦æ­£ç¡®
2. SourceMap æ–‡ä»¶è·¯å¾„èƒ½å¦åŒ¹é…

é’ˆå¯¹ä»¥ä¸Šä¸¤ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦ä»ä»¥ä¸‹æ–¹é¢æ¥è¿›è¡Œæ’æŸ¥ï¼š

- SDK å†…æ˜¯å¦é…ç½® `release`ï¼Œå¹¶é…ç½®å¯¹åº”ç‰ˆæœ¬ï¼Œå¯ä»¥åœ¨å¹³å°å†…è¿›è¡ŒéªŒè¯
- æ˜¯å¦ä¸Šä¼  SourceMap æ–‡ä»¶åˆ°æŒ‡å®šçš„ release ç‰ˆæœ¬å†…ï¼Œå¯ä»¥åœ¨å¹³å°å†… `Setting > Source Maps` æ¨¡å—è¿›è¡ŒéªŒè¯ï¼Œå¯ä»¥æŸ¥çœ‹æ˜¯å¦æœ‰ä¸Šä¼  Artifactsï¼Œèƒ½å¤Ÿåœ¨æŒ‡å®š release å†…æ‰¾åˆ°æŒ‡å®š .map æ–‡ä»¶
- æŸ¥çœ‹æºæ–‡ä»¶å†…ï¼Œ`sourceMappingURL` æ˜¯å¦è¢«æ”¹å†™ï¼ˆç³»ç»Ÿä¼šé€šè¿‡è¯¥å­—æ®µæ¥åŒ¹é… source map æ–‡ä»¶ï¼‰ï¼Œä¸€äº› CNDs ä¼šæ›´åŠ ä¼˜åŒ–è€Œå¯¹é™æ€æ–‡ä»¶è¿›è¡Œå¤„ç†ï¼Œæ¯”å¦‚å»æ‰æ–‡ä»¶å†…æ³¨é‡Šç­‰
- ç¡®ä¿ SDK å†… `dist` é…ç½®ä¸ä¸Šä¼  SourceMap æ—¶é…ç½®ä¸€è‡´ã€‚å¯ä»¥åœ¨ Issues å†…æ£€æŸ¥æ˜¯å¦å­˜åœ¨ `dist` æ ‡ç­¾æ¥éªŒè¯æ˜¯å¦åœ¨ SDK é…ç½®äº†è¯¥å­—æ®µï¼Œè€Œåœ¨ SourceMap å†…å¯ä»¥æ£€æŸ¥å³ä¸‹è§’æ˜¯å¦æœ‰ä¸€ä¸ªå°æ¤­åœ†æ¥éªŒè¯
- æ£€æŸ¥è·¯å¾„ï¼ˆæ–‡ä»¶åï¼‰æ˜¯å¦åŒ¹é…ï¼Œå¦‚æœè·¯å¾„ä¸­å­˜åœ¨åŠ¨æ€å€¼ï¼Œå¯ä»¥ä½¿ç”¨ `rewriteFrames` æ¥è¿›è¡Œå¤„ç†
- ç¡®ä¿ `artifacts` åœ¨é”™è¯¯å‘ç”Ÿä¹‹å‰ä¸‹è½½å®Œæˆ

## Relay response 400

éƒ¨ç½²ä¸Šçº¿ä¹‹åï¼Œå‘ç° sentry æœåŠ¡çš„åŸŸåäº§ç”Ÿå¤§é‡çš„ 400 é”™è¯¯ï¼Œé€šè¿‡æŸ¥çœ‹ `relay` æ—¥å¿—ï¼Œæˆ‘ä»¬å‘ç°äº†ä¸€äº›å¼‚å¸¸ï¼Œè¿™é‡Œæˆ‘ä»¬é€šè¿‡é˜…è¯»æºç å¯¹å…¶è¡¨ç°å’Œè§£å†³æ–¹æ¡ˆè¿›è¡Œè®°å½•

Relay è¿”å›400çš„åœºæ™¯

- ğŸ› Too many envelopes (event_buffer_size reached)
- ğŸ› invalid security report type
- ä¸€äº›æµè§ˆå™¨è¯·æ±‚ä»£ç†æ’ä»¶/æ‰©å±•ï¼Œä¼šå…ˆè§¦å‘ä¸€ä¸ª `Type=ping` çš„è¯·æ±‚ï¼Œå†å‘èµ·çœŸå®è¯·æ±‚ï¼Œæ­¤æ—¶ ping è¯·æ±‚ä¼šè¿”å› 400
- åœ¨ relay çš„ envelope æ¥å£å†…ä¸ŠæŠ¥äº†è‡ªå®šä¹‰çš„å­—æ®µï¼Œå¯¼è‡´ relay æ— æ³•è§£æï¼Œè¯¦è§[fix(server): Accept and forward unknown envelope items](https://github.com/getsentry/relay/pull/1246)

### Too many envelopes (event_buffer_size reached)

å¦‚æœæˆ‘ä»¬åœ¨æœåŠ¡ä¸Šå‘ç°äº†å¤§é‡çš„ 400 çŠ¶æ€ç ï¼Œé€šå¸¸æ˜¯ç”±è¯¥åŸå› å¯¼è‡´

```rust
[relay_server::endpoints::common] ERROR: error handling request: failed to queue envelope
caused by: Too many envelopes (event_buffer_size reached)
```

é€šè¿‡åˆ†æ relay æºç ï¼Œæˆ‘ä»¬å‘ç°ä¸€äº›ç«¯å€ªï¼š

`relay-server/src/actors/envelopes.rs`

```rust
// å¦‚æœç¼“å†²åŒºå†…å †ç§¯å€¼è¶…è¿‡è®¾ç½®é˜ˆå€¼ï¼Œè¿”å›é”™è¯¯å’Œè¯¦æƒ…
if self.config.envelope_buffer_size() <= self.active_envelopes {
  return Err(QueueEnvelopeError::TooManyEnvelopes);
}

#[derive(Debug, Fail)]
pub enum QueueEnvelopeError {
  #[fail(display = "Too many envelopes (event_buffer_size reached)")]
  TooManyEnvelopes,
}
```

`relay-server/src/endpoints/common.rs`

```rs
// å®šä¹‰é”™è¯¯ä¿¡æ¯
#[derive(Fail, Debug)]
pub enum BadStoreRequest {
  #[fail(display = "failed to queue envelope")]
  QueueFailed(#[cause] QueueEnvelopeError)
}

impl BadStoreRequest {
  fn to_outcome(&self) -> Option<Outcome> {
    Some(match self {
      BadStoreRequest::QueueFailed(event_error) => match event_error {
        QueueEnvelopeError::TooManyEnvelopes => Outcome::Invalid(DiscardReason::Internal),
      },
    })
  }
}
```

<HighlightWithText text="é”™è¯¯åŸå› " />{' '}

å½“ `envelope` å¤„ç†å¯¹åˆ—å †ç§¯è¶…è¿‡ [Config::event_buffer_size](https://docs.sentry.io/product/relay/options/)(é»˜è®¤ä¸º 1000) æ—¶ï¼Œä¼šè¿”å› 400 é”™è¯¯ã€‚è¯·æ±‚åŒ…å«æ‰€æœ‰ç±»å‹çš„ eventsã€attachments å’Œ sessionsrelayã€‚

### invalid security report type

æŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ï¼š

```
[relay_server::actors::envelopes] ERROR: failed to extract security report: invalid security report type
```

è¯¥é—®é¢˜ç›¸å…³ issues:
- [Rejected CSP reports from Firefox latest due to missing effective-directive payload](https://github.com/getsentry/sentry/issues/31433)

æˆ‘ä»¬å¯¹å…¶æºç è¿›è¡Œåˆ†æåå‘ç°ï¼š

`relay-server/src/actors/envelopes.rs`

```rs
// æŒ‰ç…§å¦‚ä¸‹é¡ºåºä» envelope å†…æå–äº‹ä»¶çš„ payloadï¼Œäº‹ä»¶ä»…ä»ä¸€ä¸ªæºå†…è·å–ï¼š
// 1. æ˜¾å¼äº‹ä»¶ï¼Œç†è§£ä¸ºé€šè¿‡ SDK æ­£å¸¸ä¸ŠæŠ¥çš„äº‹ä»¶ï¼›
// 2. å®‰å…¨ä¸ŠæŠ¥é¡¹ï¼Œç”±æµè§ˆå™¨æ ¹æ®å®‰å…¨ç­–ç•¥ä¸ŠæŠ¥ï¼›
// 3. Attachments `__sentry-event` and `__sentry-breadcrumb1/2`
// 4. è¡¨å•æ•°æ®
fn extract_event(&self, state: &mut ProcessEnvelopeState) -> Result<(), ProcessingError> {
  if let Some(mut item) = raw_security_item {
      relay_log::trace!("processing security report");
      state.sample_rates = item.take_sample_rates();
      self.event_from_security_report(item).map_err(|error| {
          relay_log::error!("failed to extract security report: {}", LogError(&error));
          error
      })?
  }
}

// å®šä¹‰é”™è¯¯ä¿¡æ¯
#[derive(Debug, Fail)]
enum ProcessingError {
  #[fail(display = "invalid security report type")]
  InvalidSecurityType
}

fn event_from_security_report(&self, item: Item) -> Result<ExtractedEvent, ProcessingError> {
    let len = item.len();
    let mut event = Event::default();

    let data = &item.payload();
    // æœªèƒ½é€šè¿‡ payload æ¨æ–­å‡ºå…¶å®‰å…¨ç­–ç•¥ï¼Œç›´æ¥è¿”å›é”™è¯¯
    let report_type = SecurityReportType::from_json(data)
        .map_err(ProcessingError::InvalidJson)?
        .ok_or(ProcessingError::InvalidSecurityType)?;

    let apply_result = match report_type {
        SecurityReportType::Csp => Csp::apply_to_event(data, &mut event),
        SecurityReportType::ExpectCt => ExpectCt::apply_to_event(data, &mut event),
        SecurityReportType::ExpectStaple => ExpectStaple::apply_to_event(data, &mut event),
        SecurityReportType::Hpkp => Hpkp::apply_to_event(data, &mut event),
    };

    if let Err(json_error) = apply_result {
        // logged in extract_event
        relay_log::configure_scope(|scope| {
            scope.set_extra("payload", String::from_utf8_lossy(data).into());
        });

        return Err(ProcessingError::InvalidSecurityReport(json_error));
    }
}
```

`relay-general/src/protocol/security_report.rs`

```rs
// æ ¹æ® paylod æ¥æ¨æ–­å½“å‰å®‰å…¨ç­–ç•¥ç±»å‹ï¼Œå¦‚æœæ²¡æœ‰åŒ¹é…ä¸Šï¼Œä¼šç›´æ¥è¿”å›é”™è¯¯
impl SecurityReportType {
  pub fn from_json(data: &[u8]) -> Result<Option<Self>, serde_json::Error> {
      #[derive(Deserialize)]
      #[serde(rename_all = "kebab-case")]
      struct SecurityReport {
          csp_report: Option<IgnoredAny>,
          known_pins: Option<IgnoredAny>,
          expect_staple_report: Option<IgnoredAny>,
          expect_ct_report: Option<IgnoredAny>,
      }

      let helper: SecurityReport = serde_json::from_slice(data)?;

      Ok(if helper.csp_report.is_some() {
          Some(SecurityReportType::Csp)
      } else if helper.known_pins.is_some() {
          Some(SecurityReportType::Hpkp)
      } else if helper.expect_staple_report.is_some() {
          Some(SecurityReportType::ExpectStaple)
      } else if helper.expect_ct_report.is_some() {
          Some(SecurityReportType::ExpectCt)
      } else {
          None
      })
  }
}
```

<HighlightWithText text="é”™è¯¯åŸå› " />{' '}

æµè§ˆå™¨é€šè¿‡å®‰å…¨ç­–ç•¥ä¸ŠæŠ¥çš„æ•°æ®æœªèƒ½è¢« sentry è¯†åˆ«ã€‚

## Development

### æ‰¾ä¸åˆ° `performance` å…¥å£

åœ¨æœ¬åœ°éƒ¨ç½² Sentry åï¼Œå‘ç°æ‰¾ä¸åˆ° performance æ¨¡å—çš„å…¥å£

- åŸå› ï¼šSentry v21.6.3 é»˜è®¤ä¸æ”¯æŒ performance ç‰¹æ€§ï¼Œéœ€è¦æ‰‹åŠ¨é…ç½®è¿›è¡Œå¼€å¯
- è§£å†³ï¼šåœ¨ `~/.sentry/sentry.config.py` å†…è¿›è¡Œé…ç½®

å‚è€ƒ[sentry.config.js](https://github.com/getsentry/self-hosted/blob/master/sentry/sentry.conf.example.py)

```python
############
# Features #
############

SENTRY_FEATURES["organizations:performance-view"] = True
```

### invaild platform

åœ¨æœ¬åœ°åˆ›å»ºé¡¹ç›®åï¼Œå‘ç° `POST /api/0/teams/sentry/sentry/projects/` æŠ¥é”™ `400 invaild platform`

- æŸ¥çœ‹æºç å‘ç°ç¨‹åºéœ€è¦è¯»å– `integration-docs` ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œè¿”å›é™æ€é¡µé¢
- é€šè¿‡æ‰§è¡Œ `sentry repair --with-docs` æ‹‰å–æœ€æ–°çš„é›†æˆåˆ—è¡¨ï¼Œå®‰è£…åœ¨æœ¬åœ°çš„ sentry å†…
