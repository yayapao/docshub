---
id: faq
title: Troubleshooting
sidebar_label: Troubleshooting
---

import {
  HighlightWithText,
  HighlightWithCode,
} from '/src/components/Highlights'

import { DocsHeader } from '/src/components/Layout/DocsHeader'

<DocsHeader
  title="Sentry Troubleshooting"
  description="Sentry è¿ç»´é—®é¢˜åŠè§£å†³æ–¹æ¡ˆè®°å½•ã€‚"
  github="https://github.com/getsentry/sentry"
  tags={['Troubleshooting']}
  links={[
    {
      label: 'memcached client',
      link: 'https://www.sinacloud.com/doc/_static/memcache.html#Client',
    },
    {
      label: 'memcahed',
      link: 'https://memcached.org/',
    },
  ]}
/>

<!-- -->

## In Production

### ä¿¡æ¯è¢« `[Filtered]` å ä½

åœ¨æŸ¥çœ‹é”™è¯¯å­—æ®µæ—¶ï¼Œå‘ç°ä¿¡æ¯è¢« `[Filtered]` å ä½ï¼Œå¹¶å±•ç¤º `Replaced because PII rule "@xxxxxx:filter"`

æ˜¯ç”±äº sentry åŒ¹é…åˆ°æ•æ„Ÿä¿¡æ¯ï¼Œå¹¶å¯¹å…¶è¿›è¡Œå¤„ç†ã€‚**è¯·ç¡®è®¤è¯¥ä¿¡æ¯æ˜¯å¦æœ‰èƒ½å¤Ÿå±•ç¤ºï¼**

ç”¨æˆ·å¯ä»¥é…ç½® `setting > Security & Privacy > Safe Feilds` æ¥æ”¾å¼€æŒ‡å®šæ•æ„Ÿå­—æ®µ

## æ— æ³•å®šä½åˆ°æºç (ç»“åˆ sourceMap)

:::note

é¦–å…ˆé€šè¿‡ `sentry-cli sourcemaps explain <event_id>` æ¥æ’æŸ¥ sourcemaps æ–‡ä»¶åŒ¹é…åŸå› 

:::

å½“å‡ºç°æ— æ³•å®šä½ sourceMap çš„é—®é¢˜æ—¶ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦ç¡®è®¤ç”¨æˆ·çš„åŒ¹é…è·¯å¾„ï¼Œå³ï¼š

1. å°†æºæ–‡ä»¶å’Œ sourceMap æ–‡ä»¶ä¸Šä¼ è‡³å¹³å°ï¼Œåœ¨æ–‡ä»¶ç³»ç»Ÿå†…å¯»æ‰¾ sourceMap æ–‡ä»¶è¿›è¡ŒåŒ¹é…ï¼›
2. å¼€å¯ `Allow JavaScript Source Fetching` å¼€å…³ï¼Œç”± Sentry å»çº¿ä¸Šå¯»æ‰¾ sourceMap æ–‡ä»¶è¿›è¡ŒåŒ¹é…ï¼›

é’ˆå¯¹ä»¥ä¸Šä¸¤ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦ä»ä»¥ä¸‹æ–¹é¢æ¥è¿›è¡Œæ’æŸ¥ï¼š

- SDK å†…æ˜¯å¦é…ç½® `release`ï¼Œå¹¶é…ç½®å¯¹åº”ç‰ˆæœ¬ï¼Œå¯ä»¥åœ¨å¹³å°å†…è¿›è¡ŒéªŒè¯
- æ˜¯å¦ä¸Šä¼  SourceMap æ–‡ä»¶åˆ°æŒ‡å®šçš„ release ç‰ˆæœ¬å†…ï¼Œå¯ä»¥åœ¨å¹³å°å†… `Setting > Source Maps` æ¨¡å—è¿›è¡ŒéªŒè¯ï¼Œå¯ä»¥æŸ¥çœ‹æ˜¯å¦æœ‰ä¸Šä¼  Artifactsï¼Œèƒ½å¤Ÿåœ¨æŒ‡å®š release å†…æ‰¾åˆ°æŒ‡å®š .map æ–‡ä»¶
- æŸ¥çœ‹æºæ–‡ä»¶å†…ï¼Œ`sourceMappingURL` æ˜¯å¦è¢«æ”¹å†™ï¼ˆç³»ç»Ÿä¼šé€šè¿‡è¯¥å­—æ®µæ¥åŒ¹é… source map æ–‡ä»¶ï¼‰ï¼Œä¸€äº› CNDs ä¼šæ›´åŠ ä¼˜åŒ–è€Œå¯¹é™æ€æ–‡ä»¶è¿›è¡Œå¤„ç†ï¼Œæ¯”å¦‚å»æ‰æ–‡ä»¶å†…æ³¨é‡Šç­‰
- ç¡®ä¿ SDK å†… `dist` é…ç½®ä¸ä¸Šä¼  SourceMap æ—¶é…ç½®ä¸€è‡´ã€‚å¯ä»¥åœ¨ Issues å†…æ£€æŸ¥æ˜¯å¦å­˜åœ¨ `dist` æ ‡ç­¾æ¥éªŒè¯æ˜¯å¦åœ¨ SDK é…ç½®äº†è¯¥å­—æ®µï¼Œè€Œåœ¨ SourceMap å†…å¯ä»¥æ£€æŸ¥å³ä¸‹è§’æ˜¯å¦æœ‰ä¸€ä¸ªå°æ¤­åœ†æ¥éªŒè¯
- æ£€æŸ¥è·¯å¾„ï¼ˆæ–‡ä»¶åï¼‰æ˜¯å¦åŒ¹é…ï¼Œå¦‚æœè·¯å¾„ä¸­å­˜åœ¨åŠ¨æ€å€¼ï¼Œå¯ä»¥ä½¿ç”¨ `rewriteFrames` æ¥è¿›è¡Œå¤„ç†
- ç¡®ä¿ `artifacts` åœ¨é”™è¯¯å‘ç”Ÿä¹‹å‰ä¸‹è½½å®Œæˆ
- æ–‡ä»¶æ˜¯å¦å¤ªå¤§/æˆ–è€…è¯·æ±‚æ–‡ä»¶è¶…æ—¶ï¼Œå¯¼è‡´æ— æ³•å†™åˆ°ç¼“å­˜

## Remote file too large for caching

é’ˆå¯¹æ­¤é—®é¢˜ï¼Œé‡ç‚¹ç ”ç©¶ Sentry çš„ç¼“å­˜ç­–ç•¥ï¼Œç›¸å…³é…ç½®å¦‚ä¸‹ï¼š

1. è¯·æ±‚æ–‡ä»¶è¶…æ—¶æˆ–è€…æ–‡ä»¶å¤§å°è¶…è¿‡ `settings.SENTRY_SOURCE_FETCH_MAX_SIZE` é™åˆ¶
2. `setting.SENTRY_CACHE_MAX_VALUE_SIZE` è¢«é‡æ–°è®¾ç½®å¯¼è‡´ç¼“å­˜å—é™
3. memcached æœåŠ¡çš„ `item_size_max` é™åˆ¶
4. memcached client çš„é…ç½® `SERVER_MAX_VALUE_LENGTH` é™åˆ¶

Sentry åœ¨æ‹‰å–å›æ–‡ä»¶ä¹‹åï¼Œä¼šé€šè¿‡ [memcached client](https://www.sinacloud.com/doc/_static/memcache.html#Client) ç«‹å³ç¼“å­˜åˆ° [memcached](https://memcached.org/) å†…ï¼Œä¹‹åä¼šé€šè¿‡ `cache.get` å°è¯•è·å–åˆšåˆšçš„ç¼“å­˜å€¼ï¼Œå¦‚æœæ²¡æœ‰è·å–åˆ°ï¼Œåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ `EventError.TOO_LARGE_FOR_CACHE`ã€‚

å› æ­¤å½“å‡ºç° `Remote file too large for caching` çš„é—®é¢˜æ—¶ï¼Œæˆ‘ä»¬æ’éšœæ€è·¯æ˜¯ç¡®è®¤**æ‹‰å–æ–‡ä»¶è¿‡ç¨‹**å’Œ**å„ä¸ªç¯èŠ‚çš„ç¼“å­˜é˜ˆå€¼**æ˜¯å¦å¥åº·ã€‚

### æ‹‰å–æ–‡ä»¶

<HighlightWithText text="processor.py fetch_file()" />{' '}

```python
#...snippet
with metrics.timer("sourcemaps.fetch"):
    result = http.fetch_file(url, headers=headers, verify_ssl=verify_ssl)
    z_body = zlib.compress(result.body)
    cache.set(
        cache_key,
        (url, result.headers, z_body, result.status, result.encoding),
        get_max_age(result.headers),
    )

    if cache.get(cache_key) is None:
        error = {
            "type": EventError.TOO_LARGE_FOR_CACHE,
            "url": http.expose_url(url),
        }
        http.lock_domain(url, error=error)
        raise http.CannotFetch(error)
#...snippet
```

Sentry è®¤ä¸ºå¯¼è‡´ `cache.set` å¤±è´¥çš„å”¯ä¸€çš„åŸå› å°±æ˜¯æ–‡ä»¶å¤ªå¤§ï¼Œå› æ­¤ç›´æ¥æŠ›å‡º `TOO_LARGE_FOR_CACHE` çš„å¼‚å¸¸ã€‚

åœ¨æ‹‰å–æ–‡ä»¶æ—¶ï¼ŒSentry è°ƒç”¨ `http.fetch_file()` æ–¹æ³•ï¼Œæˆ‘ä»¬ä¸€æ¢ç«¯å€ªã€‚

<HighlightWithText text="http.py fetch_file()" />{' '}

```python
#...snippet
cl = 0
if response.status_code == 200:
    for chunk in response.iter_content(16 * 1024):
        if time.time() - start > settings.SENTRY_SOURCE_FETCH_TIMEOUT:
            raise Timeout()
        outfile.write(chunk)
        cl += len(chunk)
        if cl > settings.SENTRY_SOURCE_FETCH_MAX_SIZE:
            raise OverflowError()

except Exception as exc:
  #...
  elif isinstance(exc, OverflowError):
      error = {
          "type": EventError.FETCH_TOO_LARGE,
          # We want size in megabytes to format nicely
          "max_size": float(settings.SENTRY_SOURCE_FETCH_MAX_SIZE) / 1024 / 1024,
      }
#...snippet
```

Sentry åœ¨ç¡®è®¤ response status code ä¸º 200 ä¹‹åï¼Œä¼šå°è¯•å»ä»¥ chunk çš„å½¢å¼è¯»å–è¿”å›å†…å®¹ã€‚æ­¤æ—¶ï¼Œä¼šè®¡ç®—è¿”å›å€¼ sizeï¼Œå½“å…¶æ€»å’Œå¤§äº `setting.SENTRY_SOURCE_FETCH_MAX_SIZE` æ—¶ï¼ŒæŠ›å‡ºå¼‚å¸¸ã€‚

åœ¨ `server.py` é…ç½®ä¸­ï¼Œè§‚å¯Ÿå…¶é»˜è®¤é…ç½®å‘ç°è¶…è¿‡ 40M æ‰ä¼šå¯¼è‡´é”™è¯¯ï¼Œè€Œçº¿ä¸Šçš„å®é™…è¡¨ç°æ˜¯å½“æ–‡ä»¶è¶…è¿‡ 1M æ—¶å°±å·²ç»æŠ›å‡ºå¼‚å¸¸äº†ï¼š

```python
# Timeout (in seconds) for fetching remote source files (e.g. JS)
SENTRY_SOURCE_FETCH_TIMEOUT = 5

# Timeout (in seconds) for socket operations when fetching remote source files
SENTRY_SOURCE_FETCH_SOCKET_TIMEOUT = 2

# Maximum content length for source files before we abort fetching
SENTRY_SOURCE_FETCH_MAX_SIZE = 40 * 1024 * 1024
```

ç»“åˆå®é™…æƒ…å†µï¼Œæˆ‘ä»¬æ’é™¤ç”±äº `SENTRY_SOURCE_FETCH_MAX_SIZE` é™åˆ¶å¯¼è‡´çš„è¯·æ±‚æ–‡ä»¶å¤±è´¥é—®é¢˜ã€‚

### ä¿®æ”¹ SENTRY_CACHE_MAX_VALUE_SIZE

åœ¨ `server.py` å†…è¿˜å­˜åœ¨ `SENTRY_CACHE_MAX_VALUE_SIZE` æ¥æ§åˆ¶ç¼“å­˜çš„æœ€å¤§å€¼ï¼Œåœ¨æŸ¥çœ‹ä¹‹åï¼Œæˆ‘ä»¬åŒæ ·æ’é™¤äº†è¯¥é€‰é¡¹ã€‚

```python
# Maximum content length for cache value.  Currently used only to avoid
# pointless compression of sourcemaps and other release files because we
# silently fail to cache the compressed result anyway.  Defaults to None which
# disables the check and allows different backends for unlimited payload.
# e.g. memcached defaults to 1MB  = 1024 * 1024
SENTRY_CACHE_MAX_VALUE_SIZE = None
```

è¿™é‡Œ `SENTRY_CACHE_MAX_VALUE_SIZE` è¢«è®¾ç½®ä¸º None ä»¥ä¸é™åˆ¶å…¶ä»–ç¼“å­˜çš„é˜ˆå€¼ï¼Œå³ä»¥å„ä¸ªç¼“å­˜è‡ªèº«çš„é…ç½®ä¸ºå‡†ã€‚æ³¨æ„ï¼Œè¿™é‡Œ**ç‰¹åˆ«æåˆ°äº† memcached çš„é»˜è®¤å€¼ä¸º 1MB.**

### memcached and memcache client

åœ¨å‰é¢æˆ‘ä»¬æåˆ°ï¼ŒSentry ä¼šå°†æ‹‰å–åˆ°çš„æ–‡ä»¶å†™å…¥ memcached å†…è¿›è¡Œç¼“å­˜ï¼Œä½†æ˜¯ memcached æ¯ä¸ª item é»˜è®¤ä¸º 1MBï¼Œè¿™ä¼¼ä¹å°±æ˜¯é—®é¢˜çš„ç—‡ç»“æ‰€åœ¨ã€‚

åœ¨å®¹å™¨å†…æˆ‘ä»¬å¯¹ memcached æœåŠ¡é…ç½®è¿›è¡ŒæŸ¥çœ‹ï¼Œå‘ç°å…¶ `item_size_max` ä¸º 1048576ï¼ˆ1MBï¼‰

```bash
$ memcached -h
memcached 1.6.10
-m, --memory-limit=<num>  item memory in megabytes (default: 64)
-I, --max-item-size=<num> adjusts max item size (default: 1m, min: 1k, max: 1024m)

$ echo 'stats settings' | nc localhost 11211 | grep 'max'
STAT maxbytes 67108864
STAT maxconns 1024
STAT item_size_max 1048576
```

è¿™é‡Œæˆ‘ä»¬å°†å…¶é»˜è®¤å€¼æ‰©å¤§ä¸º 10Mï¼Œç”±äº memcached ä¸æ”¯æŒé€šè¿‡é…ç½®æ–‡ä»¶å¯åŠ¨ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åœ¨å¯åŠ¨å‘½ä»¤å†…æ·»åŠ é…ç½®ï¼Œå³ï¼š

```bash
memcached -I 10m
```

ä¹‹åé€šè¿‡ `ps -ef | grep memcached` æ¥æŸ¥çœ‹æœåŠ¡å¯åŠ¨æƒ…å†µï¼š

```bash
memcache      1      0  0 Aug03 pts/0    00:00:07 memcached -I 10m
```

æ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­å¯¹ memcached-client çš„é…ç½®è¿›è¡Œå‡çº§ï¼Œå…¶å‚æ•°é…ç½®ä¸º `SERVER_MAX_VALUE_LENGTH`ï¼Œé€šè¿‡æŸ¥çœ‹æºç ï¼Œè·å–å…¶é»˜è®¤å€¼å’Œä¿®æ”¹é…ç½®çš„æ–¹æ³•ã€‚

```python
# python3.6/site-packages
# Storing values larger than 1MB requires starting memcached with -I <size> for
# memcached >= 1.4.2 or recompiling for < 1.4.2. If you do, this value can be
# changed by doing "memcache.SERVER_MAX_VALUE_LENGTH = N" after importing this
# module.
SERVER_MAX_VALUE_LENGTH = 1024 * 1024
```

è¯¥é…ç½®å€¼ä¹Ÿæ²¡æœ‰æš´éœ²åœ¨é…ç½®æ–‡ä»¶å†…ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åœ¨ä»£ç ä¸­ä¿®æ”¹ï¼Œå¹¶é‡æ–°æ‰“åŒ…ã€å‘å¸ƒã€‚

```python
# server.py snippet
import memcache
memcache.SERVER_MAX_VALUE_LENGTH = 10 * 1024 * 1024
```

## Relay response 400

éƒ¨ç½²ä¸Šçº¿ä¹‹åï¼Œå‘ç° sentry æœåŠ¡çš„åŸŸåäº§ç”Ÿå¤§é‡çš„ 400 é”™è¯¯ï¼Œé€šè¿‡æŸ¥çœ‹ `relay` æ—¥å¿—ï¼Œæˆ‘ä»¬å‘ç°äº†ä¸€äº›å¼‚å¸¸ï¼Œè¿™é‡Œæˆ‘ä»¬é€šè¿‡é˜…è¯»æºç å¯¹å…¶è¡¨ç°å’Œè§£å†³æ–¹æ¡ˆè¿›è¡Œè®°å½•

Relay è¿”å› 400 çš„åœºæ™¯

- ğŸ› Too many envelopes (event_buffer_size reached)
- ğŸ› invalid security report type
- ä¸€äº›æµè§ˆå™¨è¯·æ±‚ä»£ç†æ’ä»¶/æ‰©å±•ï¼Œä¼šå…ˆè§¦å‘ä¸€ä¸ª `Type=ping` çš„è¯·æ±‚ï¼Œå†å‘èµ·çœŸå®è¯·æ±‚ï¼Œæ­¤æ—¶ ping è¯·æ±‚ä¼šè¿”å› 400
- åœ¨ relay çš„ envelope æ¥å£å†…ä¸ŠæŠ¥äº†è‡ªå®šä¹‰çš„å­—æ®µï¼Œå¯¼è‡´ relay æ— æ³•è§£æï¼Œè¯¦è§[fix(server): Accept and forward unknown envelope items](https://github.com/getsentry/relay/pull/1246)

### Too many envelopes (event_buffer_size reached)

å¦‚æœæˆ‘ä»¬åœ¨æœåŠ¡ä¸Šå‘ç°äº†å¤§é‡çš„ 400 çŠ¶æ€ç ï¼Œé€šå¸¸æ˜¯ç”±è¯¥åŸå› å¯¼è‡´

```rust
[relay_server::endpoints::common] ERROR: error handling request: failed to queue envelope
caused by: Too many envelopes (event_buffer_size reached)
```

<HighlightWithText text="é”™è¯¯åŸå› " />{' '}

å½“ `envelope` å¤„ç†å¯¹åˆ—å †ç§¯è¶…è¿‡ [Config::event_buffer_size](https://docs.sentry.io/product/relay/options/)(é»˜è®¤ä¸º 1000) æ—¶ï¼Œä¼šè¿”å› 400 é”™è¯¯ã€‚è¯·æ±‚åŒ…å«æ‰€æœ‰ç±»å‹çš„ eventsã€attachments å’Œ sessionsrelayã€‚

#### æºç åˆ†æ

é€šè¿‡åˆ†æ relay æºç ï¼Œæˆ‘ä»¬å‘ç°ä¸€äº›ç«¯å€ªï¼š

`relay-server/src/actors/envelopes.rs`

```rust
// å¦‚æœç¼“å†²åŒºå†…å †ç§¯å€¼è¶…è¿‡è®¾ç½®é˜ˆå€¼ï¼Œè¿”å›é”™è¯¯å’Œè¯¦æƒ…
if self.config.envelope_buffer_size() <= self.active_envelopes {
  return Err(QueueEnvelopeError::TooManyEnvelopes);
}

#[derive(Debug, Fail)]
pub enum QueueEnvelopeError {
  #[fail(display = "Too many envelopes (event_buffer_size reached)")]
  TooManyEnvelopes,
}
```

`relay-server/src/endpoints/common.rs`

```rs
// å®šä¹‰é”™è¯¯ä¿¡æ¯
#[derive(Fail, Debug)]
pub enum BadStoreRequest {
  #[fail(display = "failed to queue envelope")]
  QueueFailed(#[cause] QueueEnvelopeError)
}

impl BadStoreRequest {
  fn to_outcome(&self) -> Option<Outcome> {
    Some(match self {
      BadStoreRequest::QueueFailed(event_error) => match event_error {
        QueueEnvelopeError::TooManyEnvelopes => Outcome::Invalid(DiscardReason::Internal),
      },
    })
  }
}
```

### invalid security report type

æŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ï¼š

```
[relay_server::actors::envelopes] ERROR: failed to extract security report: invalid security report type
```

è¯¥é—®é¢˜ç›¸å…³ issues:

- [Rejected CSP reports from Firefox latest due to missing effective-directive payload](https://github.com/getsentry/sentry/issues/31433)
- [Too many 400 Bad Request](https://github.com/getsentry/relay/issues/1336)

<HighlightWithText text="é”™è¯¯åŸå› " />{' '}

æµè§ˆå™¨ä¸ŠæŠ¥çš„æ•°æ®ç±»å‹æœªèƒ½è¢« sentry è¯†åˆ«ï¼Œé€šå¸¸ç”± `session` é€šé“ä¸ŠæŠ¥ï¼Œå› ä¸ºä½¿ç”¨çš„ **relay** ç‰ˆæœ¬è¾ƒä½ï¼Œåœ¨ 22.7 ä¹‹åçš„ç‰ˆæœ¬å·²ç»å¯¹å…¶è¿›è¡Œä¿®å¤ã€‚

#### æºç åˆ†æ

`relay-server/src/actors/envelopes.rs`

```rs
// æŒ‰ç…§å¦‚ä¸‹é¡ºåºä» envelope å†…æå–äº‹ä»¶çš„ payloadï¼Œäº‹ä»¶ä»…ä»ä¸€ä¸ªæºå†…è·å–ï¼š
// 1. æ˜¾å¼äº‹ä»¶ï¼Œç†è§£ä¸ºé€šè¿‡ SDK æ­£å¸¸ä¸ŠæŠ¥çš„äº‹ä»¶ï¼›
// 2. å®‰å…¨ä¸ŠæŠ¥é¡¹ï¼Œç”±æµè§ˆå™¨æ ¹æ®å®‰å…¨ç­–ç•¥ä¸ŠæŠ¥ï¼›
// 3. Attachments `__sentry-event` and `__sentry-breadcrumb1/2`
// 4. è¡¨å•æ•°æ®
fn extract_event(&self, state: &mut ProcessEnvelopeState) -> Result<(), ProcessingError> {
  if let Some(mut item) = raw_security_item {
      relay_log::trace!("processing security report");
      state.sample_rates = item.take_sample_rates();
      self.event_from_security_report(item).map_err(|error| {
          relay_log::error!("failed to extract security report: {}", LogError(&error));
          error
      })?
  }
}

// å®šä¹‰é”™è¯¯ä¿¡æ¯
#[derive(Debug, Fail)]
enum ProcessingError {
  #[fail(display = "invalid security report type")]
  InvalidSecurityType
}

fn event_from_security_report(&self, item: Item) -> Result<ExtractedEvent, ProcessingError> {
    let len = item.len();
    let mut event = Event::default();

    let data = &item.payload();
    // æœªèƒ½é€šè¿‡ payload æ¨æ–­å‡ºå…¶å®‰å…¨ç­–ç•¥ï¼Œç›´æ¥è¿”å›é”™è¯¯
    let report_type = SecurityReportType::from_json(data)
        .map_err(ProcessingError::InvalidJson)?
        .ok_or(ProcessingError::InvalidSecurityType)?;

    let apply_result = match report_type {
        SecurityReportType::Csp => Csp::apply_to_event(data, &mut event),
        SecurityReportType::ExpectCt => ExpectCt::apply_to_event(data, &mut event),
        SecurityReportType::ExpectStaple => ExpectStaple::apply_to_event(data, &mut event),
        SecurityReportType::Hpkp => Hpkp::apply_to_event(data, &mut event),
    };

    if let Err(json_error) = apply_result {
        // logged in extract_event
        relay_log::configure_scope(|scope| {
            scope.set_extra("payload", String::from_utf8_lossy(data).into());
        });

        return Err(ProcessingError::InvalidSecurityReport(json_error));
    }
}
```

`relay-general/src/protocol/security_report.rs`

```rs
// æ ¹æ® paylod æ¥æ¨æ–­å½“å‰å®‰å…¨ç­–ç•¥ç±»å‹ï¼Œå¦‚æœæ²¡æœ‰åŒ¹é…ä¸Šï¼Œä¼šç›´æ¥è¿”å›é”™è¯¯
impl SecurityReportType {
  pub fn from_json(data: &[u8]) -> Result<Option<Self>, serde_json::Error> {
      #[derive(Deserialize)]
      #[serde(rename_all = "kebab-case")]
      struct SecurityReport {
          csp_report: Option<IgnoredAny>,
          known_pins: Option<IgnoredAny>,
          expect_staple_report: Option<IgnoredAny>,
          expect_ct_report: Option<IgnoredAny>,
      }

      let helper: SecurityReport = serde_json::from_slice(data)?;

      Ok(if helper.csp_report.is_some() {
          Some(SecurityReportType::Csp)
      } else if helper.known_pins.is_some() {
          Some(SecurityReportType::Hpkp)
      } else if helper.expect_staple_report.is_some() {
          Some(SecurityReportType::ExpectStaple)
      } else if helper.expect_ct_report.is_some() {
          Some(SecurityReportType::ExpectCt)
      } else {
          None
      })
  }
}
```

## Development

### æ‰¾ä¸åˆ° `performance` å…¥å£

åœ¨æœ¬åœ°éƒ¨ç½² Sentry åï¼Œå‘ç°æ‰¾ä¸åˆ° performance æ¨¡å—çš„å…¥å£

- åŸå› ï¼šSentry v21.6.3 é»˜è®¤ä¸æ”¯æŒ performance ç‰¹æ€§ï¼Œéœ€è¦æ‰‹åŠ¨é…ç½®è¿›è¡Œå¼€å¯
- è§£å†³ï¼šåœ¨ `~/.sentry/sentry.config.py` å†…è¿›è¡Œé…ç½®

å‚è€ƒ[sentry.config.js](https://github.com/getsentry/self-hosted/blob/master/sentry/sentry.conf.example.py)

```python
SENTRY_FEATURES["organizations:performance-view"] = True
```

### invaild platform

åœ¨æœ¬åœ°åˆ›å»ºé¡¹ç›®åï¼Œå‘ç° `POST /api/0/teams/sentry/sentry/projects/` æŠ¥é”™ `400 invaild platform`

- æŸ¥çœ‹æºç å‘ç°ç¨‹åºéœ€è¦è¯»å– `integration-docs` ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œè¿”å›é™æ€é¡µé¢
- é€šè¿‡æ‰§è¡Œ `sentry repair --with-docs` æ‹‰å–æœ€æ–°çš„é›†æˆåˆ—è¡¨ï¼Œå®‰è£…åœ¨æœ¬åœ°çš„ sentry å†…
