---
id: features
title: ''
sidebar_label: Features
---

import { DocsHeader } from '/src/components/Layout/DocsHeader'
import {
  HighlightWithBadge,
  HighlightWithCode,
} from '/src/components/Highlights'

<DocsHeader
  title="Sentry Features"
  description="åŸºäº Sentry å¹³å°åšè´´è¿‘ä¸šåŠ¡çš„åŠŸèƒ½å®ç°ã€‚"
  tags={['features']}
  links={[
    {
      label: 'Customize Your Sentry Workflow: A Sample Internal Integration',
      link: 'https://blog.sentry.io/2019/11/21/customize-your-sentry-workflow-a-sample-internal-integration/',
    },
  ]}
/>{' '}

## ä½¿ç”¨ SDK

è¿™é‡Œæˆ‘ä»¬ä»¥æµè§ˆå™¨ç«¯æ¥å…¥ä¸ºä¾‹ï¼ˆå…¶ä»–å¹³å°æ¥å…¥é…ç½®å¯ä»¥å‚è€ƒ[docs-platform](https://docs.sentry.io/platforms/javascript/)ï¼‰å…¶é…ç½®å¦‚ä¸‹ï¼š

```javascript
import * as Sentry from '@sentry/browser'
import { Integrations } from '@sentry/tracing'

Sentry.init({
  dsn: 'https://examplePublicKey@o0.ingest.sentry.io/0',
  release: 'my-project-name@2.3.12',
  // store é€šé“çš„é‡‡æ ·ç‡
  smapleRate: 1
  integrations: [new Integrations.BrowserTracing()],
  // envelope é€šé“çš„é‡‡æ ·ç‡
  tracesSampleRate: 1,
  beforeSend(event, hint) {
    return event
    // return null ä¼šå°†æ­¤æ¬¡ä¸ŠæŠ¥ä¸¢å¼ƒ
  }
})
```

`beforeSend(event, hint)` å†…çš„ hint å‚æ•°ä¼šæºå¸¦åŸå§‹å¼‚å¸¸å †æ ˆä¿¡æ¯ï¼Œå¯ä»¥åœ¨æ­¤æ›´æ”¹æŒ‡çº¹æ¥å½±å“ Sentry å¯¹ issues çš„èšåˆæ–¹å¼

```js
beforeSend(event, hint) {
  const error = hint.originalException;
  if (
    error &&
    error.message &&
    error.message.match(/database unavailable/i)
  ) {
    event.fingerprint = ["database-unavailable"];
  }
  return event;
}
```

## Sampling

### ä¸ºä»€ä¹ˆè¦é‡‡æ ·ï¼Ÿ

æœ€ç†æƒ³çš„æƒ…å†µæ˜¯ï¼Œæˆ‘ä»¬å¸Œæœ›å°†å®¢æˆ·ç«¯ä¸ŠæŠ¥çš„æ‰€æœ‰æ•°æ®è¿›è¡Œå¤„ç†å¹¶å­˜å‚¨ï¼Œè¿™å°†ä¸ºæˆ‘ä»¬åœ¨æ•°æ®åˆ†ææ—¶æå‡å‡†ç¡®ç‡ã€‚

ä½†æ˜¯ï¼Œå½“<strong>æµ·é‡æ•°æ®(enormous volume of data)</strong>ç”±å®¢æˆ·ç«¯è¿›è¡Œä¸ŠæŠ¥åï¼ŒæœåŠ¡å™¨çš„è®¡ç®—æˆæœ¬å’Œæ•°æ®å­˜å‚¨æˆæœ¬å°†æ˜¯æˆ‘ä»¬ä¸å¾—ä¸è€ƒè™‘çš„é—®é¢˜ã€‚

åœ¨ Sentry ä¸­çš„å…·ä½“è¡¨ç°æ˜¯ï¼Œæ€§èƒ½æ•°æ®æ˜¯é”™è¯¯æ•°æ®çš„åƒå€è®¡ï¼ŒåŒæ—¶ä¸¤è€…çš„ context size å‡ ä¹ç›¸åŒã€‚

### è®¾è®¡é‡‡æ ·ç­–ç•¥çš„éš¾ç‚¹ï¼Ÿ

**é‡‡æ ·çš„éš¾ç‚¹ä¸åœ¨äºå®ç°é‡‡æ ·æœ¬èº«ï¼Œè€Œåœ¨äºå¦‚ä½•å¦‚ä½•æœ€å¤§åŒ–åˆ©ç”¨ä¸ŠæŠ¥æ•°æ®çš„ä»·å€¼å’Œé‡‡æ ·è§„åˆ™çš„åˆ¶å®šã€‚**

åœ¨å®é™…ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œå¦‚æœé‡‡æ ·ç‡è®¾ç½®è¿‡é«˜ï¼Œä¼šæœ‰æˆæœ¬å‹åŠ›ï¼›è®¾ç½®è¿‡ä½åˆä¼šå¤±å»åˆ†ææ•°æ®çš„å‡†ç¡®æ€§ã€‚å› æ­¤è¿™ä¸ªé—®é¢˜çš„æŒ‘æˆ˜åœ¨äºï¼šå¦‚ä½•åœ¨ä¿è¯æ•°æ®å‡†ç¡®æ€§çš„åŸºç¡€ä¸Šå°½åŠ›é™ä½æˆæœ¬ã€‚

### Sentry å¦‚ä½•è®¾è®¡é‡‡æ ·æ–¹æ¡ˆï¼Ÿ

Sentry çš„é‡‡æ ·æ–¹æ¡ˆç»è¿‡ 3 æ¬¡è¿›åŒ–ã€‚

![ds](/img/fte/sentry/sentry_dynamic_sampling.png)

**1.ç®€å•çš„é‡‡æ ·å¯å‘å¼**

:::note

æ‰€è°“é‡‡æ ·å¯å‘å¼ï¼ˆsampling heuristicsï¼‰å°±æ˜¯åº”ç”¨ä¸€ç³»åˆ—é™æ€è§„åˆ™ã€‚

:::

è¯¥æ–¹æ¡ˆæ˜¯ Sentry æœ€æ—©é‡‡ç”¨çš„é‡‡æ ·æ–¹æ¡ˆï¼Œå®ƒä¼šå¤„ç†å®¢æˆ·ç«¯ä¸ŠæŠ¥çš„æ‰€æœ‰æ•°æ®ï¼Œå¤„ç†åä¸¢å¼ƒ 99% çš„æ•°æ®ã€‚

å­˜å‚¨è§„åˆ™æ˜¯å­˜å‚¨æ¯ä¸€ä¸ªå”¯ä¸€é”™è¯¯ï¼Œå¹¶å­˜å‚¨å‰ 100 ä¸ªæ ·æœ¬ï¼Œä¹‹åçš„æ ·æœ¬ä¼šéšæœºå­˜å‚¨ã€‚

è¯¥ç­–ç•¥æ²¡æœ‰å°†æ‰€æœ‰äº‹ä»¶è½åº“ç´¢å¼•ï¼Œè€Œæ˜¯ Sentry é€šè¿‡ tags å’Œå…¶ä»–å…³é”®ä¿¡æ¯ï¼ˆæ¯”å¦‚æ“ä½œç³»ç»Ÿç­‰ï¼‰æ¥ä½œä¸ºèšåˆå› å­ï¼Œèšåˆåè¿›è¡Œé«˜ç»´åˆ†æã€‚

**2. å…¨éƒ¨å­˜å‚¨æ¨¡å‹**

ç¬¬ä¸€ç§ç­–ç•¥çºµç„¶èƒ½å¤Ÿæ»¡è¶³å¤§éƒ¨åˆ†ç”¨æˆ·éœ€æ±‚ï¼Œä½†æ˜¯ç”±äºç”¨æˆ·éœ€æ±‚å’Œç»´æŠ¤å›°éš¾ã€‚Sentry æ”¾å¼ƒäº†è¯¥æ–¹æ¡ˆï¼Œè½¬è€Œæ”¾å¼ƒè¿›è¡Œé‡‡æ ·ï¼Œè€Œæ˜¯å°†å…¨éƒ¨äº‹ä»¶è¿›è¡Œå­˜å‚¨ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå¼€å‘äººå‘˜è‡´åŠ›äºæœ€å°åŒ–æˆæœ¬ã€‚

è¿™ä¸ªç­–ç•¥åœ¨æ²¡æœ‰å¼•å…¥æ€§èƒ½æ•°æ®ä¸ŠæŠ¥é€šé“ä¹‹åï¼Œä¾¿ä¸å†å¥æ•ˆï¼ŒåŸå› ä¹Ÿå¾ˆç›´æ¥ï¼šé‡å¤§ï¼æ€§èƒ½æ•°æ®æ˜¯é”™è¯¯äº‹ä»¶çš„åƒå€è®¡ï¼Œå¹¶ä¸”æºå¸¦çš„å†…å®¹ç›¸å·®æ— å‡ ã€‚

æœ€ç»ˆè¿˜æ˜¯éœ€è¦é‡‡æ ·æ¥è¿›è¡Œè§£å†³ï¼Œä¸è¿‡è¿™æ¬¡ Sentry å¼€æ”¾ `sampleRate` ç­‰é…ç½®ç»™åˆ°ç”¨æˆ·æ¥è‡ªå®šä¹‰é‡‡æ ·ç‡ã€‚

è¿™ä¹ˆåšè¿˜æ˜¯å­˜åœ¨é—®é¢˜ï¼Œå³ï¼š

- ç”¨æˆ·å¾ˆéš¾å‡†ç¡®åœ°é…ç½®å½“å‰é‡‡æ ·ç‡ï¼Œè¿‡é«˜è¿‡ä½éƒ½ä¸åˆé€‚
- ä¿®æ”¹é‡‡æ ·ç‡éœ€è¦é‡æ–°å‘ç‰ˆä¸Šçº¿

**3. Dynamic Sampling åŠ¨æ€é‡‡æ ·**

DS çš„å®—æ—¨æ˜¯ï¼šæœ€å¤§åŒ–æ•°æ®ä»·å€¼ã€‚è¿™å¥è¯çš„æ·±å±‚å«ä¹‰æ˜¯ï¼ŒSentry ä¸ä»…ä¼šå¤„ç†æœ€ç»ˆè½åº“çš„æ•°æ®ï¼ŒåŒæ—¶ä¹Ÿä¼šå¤„ç†è¢«ä¸¢å¼ƒçš„æ•°æ®ï¼Œä»¥ç¡®ä¿èšåˆç­‰åœºæ™¯çš„æ•°æ®å‡†ç¡®æ€§ã€‚ï¼ˆæ²¡æœ‰è®°å½•ä¸ä»£è¡¨æ²¡æœ‰å‘ç”Ÿï¼ï¼‰

DS å­˜åœ¨ä¸¤ä¸ªå…³é”®ç‚¹ï¼š

1. é€šè¿‡é¢„è®¡ç®—çš„æ–¹æ³•ï¼Œæä¾›æ›´å¤šé«˜ç»´è§†è§’çš„æ ¸å¿ƒæŒ‡æ ‡è§†å›¾ã€‚è¿™å°†ä¿è¯ä½ å§‹ç»ˆèƒ½å¤Ÿåœ¨é«˜ç»´è§†è§’å‘ç°é—®é¢˜ï¼Œå¹¶æ·±å…¥ç ”ç©¶ç›¸å…³æ ·æœ¬
2. æ— éœ€ä¿®æ”¹å®¢æˆ·ç«¯ï¼Œå³å¯å¿«é€Ÿæ›´æ”¹é‡‡æ ·ç‡æ¥æ§åˆ¶å¯¹æ ·æœ¬æ•°æ®çš„é‡‡é›†

Sentry é€šè¿‡åœ¨å¹³å°å†…é…ç½®åï¼Œå°†é‡‡æ ·çš„ç­–ç•¥é€šè¿‡ Realy æ¨é€åˆ°å„ä¸ªè¾¹ç¼˜èŠ‚ç‚¹ï¼Œå…è®¸å…¶åŠå®æ—¶åœ°æ‰§è¡Œé‡‡æ ·å¯å‘å¼ã€‚

æˆ‘ä»¬å‚è€ƒå®˜æ–¹æ–‡æ¡£çš„ä¾‹å­è¿›è¡Œè¯´æ˜ï¼š

![sampling](https://docs.sentry.io/static/3b586576c596282422ed295cfe3a80f1/2a333/server-side-sampling-a.png)

å‡è®¾æˆ‘ä»¬åœ¨å®¢æˆ·ç«¯ SDK è®¾ç½®äº† 50% çš„é‡‡æ ·ç‡ï¼Œåœ¨æœåŠ¡ç«¯è®¾ç½®äº† 25% çš„é‡‡æ ·ç‡

é‚£ä¹ˆæœ€ç»ˆè½åº“ï¼ˆè¢«å¤„ç†å’Œç´¢å¼•ï¼‰çš„æ ·æœ¬å **æ€» transaction volumn** çš„ 25%ï¼Œè¢«å¤„ç†ä½†æ˜¯ä¸è¢«ç´¢å¼•å’Œè½åº“çš„æ ·æœ¬æ•°å **æ€» transaction volumn** çš„ 50%ã€‚

## Grouping Issues

:::note

é”™è¯¯äº‹ä»¶çš„èšåˆ

:::

åœ¨æœ¬ç« ï¼Œæˆ‘ä»¬å°†ä¼šåœ¨[Issue Grouping](https://docs.sentry.io/product/data-management-settings/event-grouping/#grouping-by-stack-trace)çš„åŸºç¡€ä¸Šä»‹ç» Sentry å†…ç½®èšåˆè§„åˆ™ä»¥åŠå¦‚ä½•è‡ªå®šä¹‰èšåˆè§„åˆ™ã€‚

å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦æ˜æ™°ï¼šSentry å†…åŒæ—¶å­˜åœ¨ Issues å’Œ Event çš„æ¦‚å¿µã€‚Issue æ˜¯ Error event æŒ‰ç…§ä¸€å®šè§„åˆ™èšåˆåçš„äº§ç‰©ã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬ä¸å¦¨æ€è€ƒä¸€ä¸‹ï¼š

- æ•°äº¿çš„é”™è¯¯äº‹ä»¶æ˜¯å¦‚ä½•è¢«åˆ†é—¨åˆ«ç±»æ”¾åˆ°ä¸åŒçš„ issue å†…ï¼Ÿ
- å¦‚ä½•è®¾è®¡æ ¸å¿ƒæ–¹æ¡ˆä»¥æ”¯æŒç”¨æˆ·è‡ªå®šä¹‰èƒ½åŠ›ï¼Ÿ

### How to group error events?

Sentry å†…èšåˆé€»è¾‘çš„æ ¸å¿ƒåœ¨äº <HighlightWithCode bgcolor="#ef613e">fingerprint</HighlightWithCode>ã€‚

æ¯ä¸ªé”™è¯¯éƒ½ä¼šæœ‰æŒ‰ç…§æŒ‡å®šèšåˆç®—æ³•ç”Ÿæˆå¯¹åº”çš„ fingerprintï¼ŒSentry æ ¹æ® fingerprint ç”Ÿæˆå¯¹åº”çš„ `Group Hash Code`ï¼Œå¹¶ä»¥æ­¤æ¥å¯¹é”™è¯¯äº‹ä»¶è¿›è¡Œå½’ç±»ã€‚å³ç›¸åŒçš„ `Group Hash Code` è¢«å½’ä¸ºåŒä¸€ä¸ª `issue`ã€‚

æˆ‘ä»¬å¯ä»¥åœ¨ `Error details > JSON link > fingerprint property` å†…æŸ¥çœ‹ç½®é¡¶é”™è¯¯äº‹ä»¶çš„æŒ‡çº¹ã€‚

**æ³¨æ„ï¼Œå¦‚æœä½¿ç”¨å†…å»ºçš„èšåˆè§„åˆ™ä¼šå±•ç¤º `fingerprint: "{{ default }}"`ï¼Œå¦åˆ™ä¼šå±•ç¤ºå±•ç¤ºçš„ fingerprint å€¼ã€‚**

### Built-in Grouping Algorithms

ç›¸ä¿¡ä¸å°‘ç”¨æˆ·éƒ½æœ‰åŒæ ·çš„å›°æ‰°ï¼Œæ˜æ˜åœ¨é¡µé¢ä¸Šå±•ç¤ºçš„é”™è¯¯ä¿¡æ¯å€¼ä¸ä¸€æ ·ï¼Œä¸ºä»€ä¹ˆä¼šè¢«å½’çº³åˆ°åŒä¸€ä¸ª issue å‘¢ï¼Ÿ

ç­”æ¡ˆæ˜¯ï¼šSentry å†…ç½®çš„èšåˆç®—æ³•**ä¼šæ ¹æ®é”™è¯¯çš„å †æ ˆè¿½è¸ªä¿¡æ¯æ¥ç”Ÿäº§ fingerprint**ã€‚å³é”™è¯¯äº‹ä»¶çš„å †æ ˆä¿¡æ¯ç›¸åŒï¼Œåˆ™æ­¤ç±»é”™è¯¯äº‹ä»¶å±äºåŒä¸€ä¸ª issueã€‚

:::warning

- æ‰€æœ‰çš„èšåˆç­–ç•¥ï¼Œå‡éµå¾ª `stack trace -> exception -> message` çš„æ¬¡åºè¿›è¡Œå¤„ç†ï¼Œä¸€æ—¦ group hash code ç”Ÿæˆï¼Œä¸ä¼šç»§ç»­æ‰§è¡Œå‰©ä¸‹çš„é€»è¾‘
- ä»…æœ‰ `stack trace` ç”Ÿæˆçš„ group hash code æ˜¯å¯é çš„

:::

#### Grouping by stack trace

å½“é”™è¯¯äº‹ä»¶åˆ°è¾¾æ—¶ï¼ŒSentry ä¼šä»æå–å…¶ stack trace æ•°æ®ã€‚**å¹¶ä¸” sentry ä»…ä¼šå¤„ç†ç”± SDK ä¸ŠæŠ¥å¹¶ä¸åº”ç”¨å…³è”çš„ stack trace framesã€‚**

åŸå› åœ¨äºï¼š

1. æœ‰ä¸€äº›å¹³å°çš„ SDK ä¸ä¼šä¸ŠæŠ¥å †æ ˆè¿½è¸ªä¿¡æ¯ï¼›
2. å¦‚æœä»…ä»…æ˜¯ä¸é¡¹ç›®æ— å…³çš„å †æ ˆä¿¡æ¯ä¸ä¸€è‡´ï¼Œé”™è¯¯äº‹ä»¶ä»ç„¶ä¼šè¢«å½’ä¸ºåŒä¸€ç±»ï¼›

Sentry åœ¨å †æ ˆè¿½è¸ªä¿¡æ¯å†…ä¼šæå–ï¼š

- æ¨¡å—åï¼›
- æ ‡å‡†åŒ–çš„æ–‡ä»¶åï¼Œæ¯”å¦‚ä¿®è®¢åçš„ hash å€¼ä¼šè¢«åˆ é™¤æ‰ï¼›
- æ ‡å‡†åŒ–çš„ä¸Šä¸‹æ–‡ï¼Œå³å—å½±å“çš„ä»£ç ï¼ˆæºç ï¼Œå¦‚æœèƒ½å¤ŸåŒ¹é… sourcemapï¼‰

è¿™é‡Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–¹æ³•ï¼Œåœ¨ç›¸åŒçš„æ–¹æ³•å†…ï¼ŒæŠ›å‡ºä¸åŒçš„é”™è¯¯ä¿¡æ¯ï¼š

```js
// æŠ›å‡ºä¸€ä¸ªError, value ä¸ºå½“å‰æ—¶é—´
function sendSentry() {
  throw new Error(new Date().toLocaleString())
}
```

åœ¨ Sentry è¿”å›ç»“æœï¼š

![group_diff](/img/fte/sentry/sentry_group_diff.png)

æ ¹æ®ä¸Šå›¾ç»“æœæˆ‘ä»¬å¯ä»¥å¾—å‡ºï¼š**ä½¿ç”¨é»˜è®¤çš„å†…å»ºèšåˆè§„åˆ™ï¼Œåœ¨ stack trace ç›¸åŒçš„æƒ…å†µä¸‹ä¼šè¢«èšåˆåˆ°åŒä¸€ä¸ª issueï¼Œå³ä½¿ä»–ä»¬çš„ exception/message å¹¶ä¸ç›¸åŒã€‚**

æˆ‘ä»¬ç»§ç»­åœ¨ issue details é¡µé¢å±•å¼€ `EVENT GROUPING INFORMATION` æ¥å¯¹æ¯”åŒä¸€ä¸ª issue å†…ä¸åŒ event çš„èšåˆç»†èŠ‚ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

![group_info](/img/fte/sentry/group_information.png)

æˆ‘ä»¬ä¸éš¾å‘ç°ï¼š**åœ¨è¯¥ issue å†…çš„é”™è¯¯æ‹¥æœ‰ç›¸åŒçš„ `group hash code`ï¼Œå®é™…ä¸Š Sentry æœ€ç»ˆä¹Ÿæ˜¯æ ¹æ®å®ƒæ¥ç¡®å®š event å½’å±ï¼**

#### Grouping by exception

å½“ stack trace æ— æ³•æ‰¾åˆ°æ—¶ï¼ŒSentry ä¼šä½¿ç”¨ exception çš„ `type` å’Œ `value` å­—æ®µè¿›è¡Œå…œåº•ï¼Œæ­¤æ—¶èšåˆä¸å¯é ï¼

å¼‚å¸¸ä¿¡æ¯å¦‚ä¸‹æ‰€ç¤ºï¼š

```
Error: 2022/4/21 18:04:06
  at Error: 2022(/4/21 18:4:6)
  at sendSentry(/main.d1f2e7dbd07e024bf014.hot-update.js:27:11)
  at dispatchDiscreteEvent(/static/js/bundle.js:27074:7)
```

å¦‚ä¸Šæ‰€ç¤ºï¼Œtype ä¹Ÿå°±æ˜¯ exception nameï¼Œå³ Errorï¼›value åˆ™ä¸ºäººç±»å¯è¯»çš„æè¿°ï¼Œå³ 2022/4/21 18:04:06

#### Fallback Grouping

å¦‚æœä»¥ä¸Šéƒ½ä¸èƒ½å¥æ•ˆæ—¶ï¼ŒSentry å°†å°è¯•ä½¿ç”¨ä¸å¸¦ä»»ä½•å‚æ•°çš„ messageã€‚å¦‚æœè¿™ä¸å¯ç”¨ï¼Œå°†ä½¿ç”¨å®Œæ•´çš„ message å±æ€§æ¥è¿›è¡Œèšåˆã€‚

### How to customized Grouping?

å®é™…ä¸Šï¼ŒSentry å†…å»ºçš„èšåˆè§„åˆ™èƒ½å¤Ÿæ»¡è¶³æˆ‘ä»¬ 80% ä»¥ä¸Šçš„ä½¿ç”¨åœºæ™¯ï¼Œä½†æ˜¯å¯¹äºæˆ–å¤šæˆ–å°‘çš„é”™è¯¯äº‹ä»¶æˆ‘ä»¬éœ€è¦æ‹†åˆ†æˆ–è€…èšåˆæ¥æ›´æ­£ç¡®åœ°åˆ†ææ•°æ®ï¼Œå› æ­¤æˆ‘ä»¬ä¹Ÿè¿«åˆ‡éœ€è¦è‡ªå®šä¹‰èšåˆè§„åˆ™çš„èƒ½åŠ›ã€‚æ‰€å¹¸ï¼ŒSentry æä¾›äº†ä¸åŒçš„æ–¹æ¡ˆï¼Œæ¥å¸®åŠ©ç”¨æˆ·æ›´ç§‘å­¦åœ°å½’çº³é”™è¯¯äº‹ä»¶ã€‚

- `Merge Issues` åˆå¹¶å·²å­˜åœ¨ issue
- `Fingerprint Rules` åº”ç”¨æ‰€æœ‰æ–°å…¥çš„é”™è¯¯äº‹ä»¶ï¼Œå†³å®šç”Ÿæˆ `group hash code` çš„è§„åˆ™
- `Stack Trace Rules` åº”ç”¨æ‰€æœ‰æ–°å…¥çš„é”™è¯¯äº‹ä»¶ï¼Œå†³å®šç”Ÿæˆ `group hash code` çš„ stack trace

å¯¹äº `Fingerprint Rules` å’Œ `Stack Trace Rules` éƒ½éµå¾ªç»Ÿä¸€çš„åŒ¹é…è§„åˆ™ï¼Œå³ï¼š

- ä¸åŒè¡Œå½¢æˆ**æˆ–**çš„å…³ç³»
- ç»Ÿä¸€è¡Œä¸åŒè§„åˆ™å½¢æˆ**ä¸**çš„å…³ç³»

#### Merge Issues

merge issues æ˜¯ Sentry æä¾›æœ€æ˜“æ“ä½œçš„è‡ªå®šä¹‰èšåˆèƒ½åŠ›ï¼Œå®ƒç”¨æ¥å¤„ç†ï¼š

1. å¤šä¸ª issues ç±»ä¼¼ï¼›
2. ç”¨æˆ·å¸Œæœ›å‡å°‘ issue noiseï¼Œä½¿ issues é¢æ¿æ›´åŠ æ•´æ´ï¼Œæ–¹ä¾¿ä¸“æ³¨äºæŸä¸€ç±» issueï¼›

`merge issues` å±äºäº‹åçš„äººå·¥å¹²é¢„ï¼Œä»…ä¼šå½±å“å·²å¤„ç†çš„é”™è¯¯äº‹ä»¶ä»¥åŠå°†æ¥ä¸ŠæŠ¥çš„ç›¸åŒçš„é”™è¯¯äº‹ä»¶ã€‚å…¶æ“ä½œæ–¹æ³•å¾ˆç®€å•ï¼Œåœ¨ issues é¢æ¿é€‰æ‹©ä¸åŒçš„ issue è¿›è¡Œåˆå¹¶å³å¯ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚

:::warning

**Sentry ä¸ä¼šæ ¹æ® merge issues æ¥æ¨æ–­æ–°çš„èšåˆè§„åˆ™ï¼Œä»…å½“æ–°çš„é”™è¯¯äº‹ä»¶æ‹¥æœ‰å’Œå½“å‰ merged issues ç›¸åŒçš„ fingerprint å¹¶ç”Ÿäº§åŒæ ·çš„ group hash code æ‰ä¼šè¢«è‡ªåŠ¨èšåˆ**

:::

#### Fingerprint Rules

Sentry æ”¯æŒé€šè¿‡é…ç½® `[Project] > Settings > Issue Grouping > FINGERPRINT RULES` åœ¨æœåŠ¡ç«¯æ ¹æ®è‡ªå®šä¹‰èšåˆè§„åˆ™ã€‚

**æ³¨æ„ï¼Œé…ç½® fingerprint rules ä¼šè¦†ç›–é»˜è®¤çš„èšåˆè§„åˆ™**

finterprint rules éµå¾ªå¦‚ä¸‹æ¨¡å¼ï¼š

```
# partten
matcher:glob -> fingerprint, values title=""
```

æ¯”å¦‚ï¼Œæˆ‘ä»¬é…ç½®äº†ä¸€æ¡è§„åˆ™ `error.type:ReferenceError -> Not-found-error, {{transaction}}`ï¼Œå®ƒè¡¨ç¤ºåŒ¹é…æ‰€æœ‰ type ä¸º ReferenceError çš„é”™è¯¯äº‹ä»¶ï¼Œå¯¹å…¶èšåˆå¹¶èµ‹å€¼ fingerprint ä¸º Not-found-errorï¼ŒåŒæ—¶ï¼Œä½¿ç”¨ `{{ transaction }}` è¿›è¡Œé€šé…ï¼Œè¾¾åˆ°æŒ‰ç…§ä¸åŒ transaction è¿›è¡Œèšåˆçš„ç›®çš„

åœ¨äº†è§£åŸºæœ¬è§„åˆ™ä¹‹åï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨å¯¹ä¸Šæ–‡çš„ä¾‹å­è¿›è¡Œæ‹†åˆ†ï¼Œå³æŒ‰ç…§ä¸åŒçš„ exception å€¼æ¥å¯¹é”™è¯¯äº‹ä»¶è¿›è¡Œèšåˆï¼Œå¹¶åœ¨ issue ä¸Šè‡ªå®šä¹‰æ ‡é¢˜å±•ç¤ºã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨é¡¹ç›®å†…é…ç½®äº†ä¸€æ¡ fingerprint ruleï¼Œå¦‚ä¸‹ï¼š

```
error.type:Error -> error, {{ error.value }} title="Error from value={{ error.value }}"
```

å½“æˆ‘ä»¬åœ¨å®¢æˆ·ç«¯å†æ¬¡è§¦å‘é”™è¯¯æ—¶ï¼Œæˆ‘ä»¬è§‚å¯Ÿåˆ°ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š

![fingerprint-rules](/img/fte/sentry/fingerprint_rules.png)

æ®æ­¤æˆ‘ä»¬å¯ä»¥åˆ†æï¼š

1. æ ¹æ®å†…å»ºç®—æ³•å¯¹é”™è¯¯äº‹ä»¶è¿›è¡Œèšåˆï¼Œè¿™äº›é”™è¯¯æ‹¥æœ‰ç›¸åŒçš„å †æ ˆä¿¡æ¯å’Œ `group hash code`
2. å½“é…ç½®å¦‚ä¸Š `FINGERPRINT RULES` ä¹‹åï¼Œä¼šå¯¹æ‰€æœ‰ `error.type=Error` çš„é”™è¯¯æŒ‰ç…§ `error.value` è¿›è¡Œåˆ†ç±»ï¼Œä¸”æ ‡é¢˜å±•ç¤º `Error from value={{ error.value }}`
3. æ ¹æ®è‡ªå®šä¹‰è§„åˆ™ï¼Œå…¶ `fingerprint values` æ ¹æ® exception çš„å€¼è€Œå‘ç”Ÿå˜åŒ–ï¼Œå¯¼è‡´å…¶ `group hash code` ä¸å°½ç›¸åŒï¼Œæœ€ç»ˆè¢«èšåˆåˆ°ä¸åŒçš„ issue

#### Stack Trace Rules

åŸºäº `stack trace` ç¬¬ä¸€å¯é çš„åŸåˆ™ï¼ŒSentry ä¸ºæˆ‘ä»¬æä¾›åœ¨ç”Ÿæˆ `group hash code` ä¹‹å‰å¤„ç† `stack trace` çš„èƒ½åŠ›ï¼Œå®ƒè¢«çœ‹ä½œæ˜¯èšåˆè§„åˆ™çš„å¢å¼ºæªæ–½ã€‚

æ€è·¯å°±æ˜¯åœ¨èšåˆä¹‹å‰ï¼Œå…è®¸æˆ‘ä»¬æŒ‰ç…§è§„åˆ™ä¿®æ”¹ `stack trace` æ¥å½±å“æœ€ç»ˆèšåˆç»“æœã€‚

åŒæ ·ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ `[Project] > Settings > Issue Grouping > Stack Trace Rules` å†…é…ç½®ç›¸åº”è§„åˆ™ã€‚å…¶ pattern å¦‚ä¸‹ï¼š

```
# Enhancement Rules
matcher-name:expression other-matcher:expression ... action1 action2 ...
```

å®šä¹‰è§„åˆ™æ”¯æŒçš„æ ‡å¿—ç¬¦ï¼š

- `+`: è®¾ç½®æ ‡è®°
- `-`: æ¸…é™¤æ ‡è®°
- `^`: åº”ç”¨å½“å‰ frame åˆ°æ ˆé¡¶çš„æ‰€æœ‰ frame
- `v`: åº”å½“å½“å‰ frame åˆ°æ ˆåº•æ‰€æœ‰çš„ frame
- `app`: åœ¨åº”ç”¨å†…æ ‡è®°/æ¸…é™¤æ ‡è®°æŒ‡å®š frame
- `group`: èšåˆæ—¶æ·»åŠ /æ¸…é™¤æŒ‡å®š frame

æˆ‘ä»¬é€šè¿‡ä½¿ç”¨æ ‡å¿—ç¬¦çš„ç»„åˆæ¥è¾¾åˆ°ä¸åŒçš„æ•ˆæœï¼Œå¦‚ä¸‹æˆ‘ä»¬åˆ—ä¸¾äº†ä¸€ç»„ä¾‹å­å¸®åŠ©ç†è§£ï¼š

```
# frame å†…ç»å¯¹è·¯å¾„å‘½ä¸­ **/node_modules/** è§„åˆ™çš„ï¼Œèšåˆæ—¶éƒ½ä¸ä¼šå‚ä¸è®¡ç®—
stack.abs_path:**/node_modules/** -group

# æ ‡è®°æ‰€æœ‰ node_modules ç›®å½•ä¸‹çš„æ‰€æœ‰ä»£ç ä¸ºä¸å†åº”ç”¨ä¸­
stack.abs_path:**/node_modules/** -app

# native å¹³å°å…è®¸çš„æœ€å¤§å¸§ä¸º 3ï¼ˆä»æ ˆé¡¶å‘ä¸‹æ•°ï¼‰
family:native max-frames=3

# å‘½ä¸­ function ä¸º fetchSavedSearches çš„ä¸‹é¢æ‰€æœ‰å¸§éƒ½ä¸ä¼šè¢«çº³å…¥èšåˆè®¡ç®—
stack.function:fetchSavedSearches v-group
```

## Integration

:::note
[Integation](https://docs.sentry.io/product/integrations/integration-platform/) æ˜¯æˆ‘ä»¬èƒ½å¤Ÿä»‹å…¥ Sentry çš„å¤„ç†æµç¨‹ï¼Œå¹¶æ ¹æ®è‡ªå·±çš„éœ€æ±‚è¿›è¡Œå¼€å‘ã€‚
:::

åœ¨æœ¬ç« ï¼Œæˆ‘ä»¬ä¼šä»‹ç»å¦‚ä½•åœ¨ Sentry å†…åˆ›å»ºä¸€ä¸ªå†…éƒ¨é›†æˆï¼Œæ¥è‡ªå®šä¹‰å·¥ä½œæµã€‚Sentry å°†é›†æˆåˆ†ä¸ºï¼š`internal` å’Œ `public`ã€‚

- `internal integation` ä»…èƒ½è¢«ç”¨åœ¨ä½ çš„ç»„ç»‡å†…ï¼Œåˆ›å»ºåä¼šè‡ªåŠ¨åº”ç”¨åœ¨ç»„ç»‡å†…æ‰€æœ‰é¡¹ç›®ï¼ŒéªŒè¯è¿‡ç¨‹ç›¸å¯¹ç®€å•
- `public integation` èƒ½è¢«å‘å¸ƒï¼Œä¾›æ‰€æœ‰ Sentry ç”¨æˆ·ä½¿ç”¨ï¼ŒéªŒè¯è¿‡ç¨‹ç›¸å¯¹å¤æ‚

åœ¨ `/settings/[org]/developer-settings/` æŒ‰ç…§å®é™…éœ€æ±‚é€‰æ‹© integation å¹¶å†™å…¥åŸºæœ¬ä¿¡æ¯åè¿›è¡Œåˆ›å»ºï¼ˆåæœŸä¹Ÿå¯ä»¥æ ¹æ®éœ€æ±‚è¿›è¡Œä¿®æ”¹ï¼‰ã€‚

### åˆ›å»ºä¸€ä¸ª Internal Integation

ç”¨ä¸€å¥è¯æ¦‚æ‹¬æ•´ä¸ªæµç¨‹ï¼š**Sentry å°† Issus/Event å‘é€è‡³æœåŠ¡ï¼Œç”±æœåŠ¡è¿›è¡ŒéªŒè¯åæ‰§è¡Œç›¸åº”åŠ¨ä½œ**

å‚è€ƒ [Internal Integation](https://docs.sentry.io/product/integrations/integration-platform/internal-integration/) å’Œ [Round Robin Assignment](https://blog.sentry.io/2019/11/21/customize-your-sentry-workflow-a-sample-internal-integration) è¿›è¡Œå¿«é€Ÿæ­å»ºä¸€ä¸ªå†…éƒ¨é›†æˆã€‚

è¿™é‡Œæˆ‘ä»¬æŠ½ç¦»éƒ¨åˆ†æ ¸å¿ƒä»£ç ï¼š

```js
// éªŒè¯æ–¹æ³•ï¼Œæ³¨æ„ createHmac çš„å¼•å…¥æ–¹å¼
export const verifySignature: (
  request: any,
  secret: string
) => Promise<boolean> = async (request, secret) => {
  const { createHmac } = await import('node:crypto')
  const hmac = createHmac('sha256', secret)
  hmac.update(JSON.stringify(request.body), 'utf8')
  const digest = hmac.digest('hex')
  return digest === request.headers['sentry-hook-signature']
}

// webhook API
// ç”±äº internal integation å¯¹ç»„ç»‡å†…æ‰€æœ‰åº”ç”¨ç”Ÿæ•ˆï¼Œå› æ­¤æœ€å¥½è®¾ç½®ä¸€ä¸ªç™½åå•æ¥è¿‡æ»¤
@Post()
async doAssigned(
  @Body() body: any,
  @Headers() headers: Record<string, string>,
  @Request() req,
) {
  if (!verifySignature(req, round_robin_assigned_secret)) {
    return failed('bad signature')
  }
  const resource = headers['sentry-hook-resource']
  const { action } = body

  if (resource === 'issue' && action === 'created') {
    const { id: newIssueProjectID } = body.data.issue.project
    // ä»…å¯¹ç™½åå•å†…åº”ç”¨è¿›è¡Œå¤„ç†
    if (
      Array.isArray(this.whiteProjectIDs) &&
      this.whiteProjectIDs.includes(+newIssueProjectID)
    ) {
      const { id: issueID } = body.data.issue
      // éªŒè¯å®Œæˆä¹‹åï¼Œå¼€å§‹æ‰§è¡Œä¸šåŠ¡é€»è¾‘
    }
  }
  return successed({
    body,
    headers,
  })
}
```

### éªŒè¯æµç¨‹

**å¦‚æœé‡åˆ°å†æ¬¡å¯åŠ¨ï¼Œintegration ä¸ä¼šä¸»åŠ¨è§¦å‘çš„æƒ…å†µï¼Œå°è¯•ä¿®æ”¹ integation é…ç½®å¹¶é‡æ–°ä¿å­˜**

- å¯åŠ¨æ¥å— Sentry Post çš„åç«¯æœåŠ¡
- æœ¬åœ°å¯åŠ¨ Sentryï¼Œå¹¶ä¸”ä¸º workers æ¨¡å¼
- é€šè¿‡ sentry-cli å‘æœ¬åœ°é¡¹ç›®å‘é€ event

## Source Maps

:::note Source Maps

Source Maps æ˜¯æ„å»ºæ—¶çš„äº§ç‰©ï¼Œç”¨æ¥æ˜ å°„æºæ–‡ä»¶ï¼Œå®šä½æºç ä½ç½®ã€‚åœ¨ Sentry å†…èƒ½å¤Ÿå±•ç¤ºæ›´å…·å¯è¯»æ€§çš„é”™è¯¯å †æ ˆä¿¡æ¯ã€‚

:::

åœ¨ Sentry å†…éƒ¨æ”¯æŒé€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼æ¥åŒ¹é… Source Maps:

1. **å°†æºæ–‡ä»¶å’Œ Source Maps æ–‡ä»¶ä¸Šä¼ è‡³å¹³å°**ï¼Œprocess-worker åœ¨æ–‡ä»¶ç³»ç»Ÿå†…å¯»æ‰¾ Source Maps æ–‡ä»¶è¿›è¡ŒåŒ¹é…ã€æ›¿æ¢ï¼›
2. process-worker è§£æé”™è¯¯å †æ ˆæ–‡ä»¶å -> ä»çº¿ä¸Šæ‹‰å–ç›®æ ‡æ–‡ä»¶ -> è§£æ sourceMappingURL -> æ‹‰å– Source Maps -> æ‰§è¡ŒåŒ¹é…ã€æ›¿æ¢ï¼ˆæ­¤è¿‡ç¨‹éœ€è¦å¼€å¯ `Allow JavaScript Source Fetching`ï¼‰ï¼›

é’ˆå¯¹ç¬¬ä¸€ç‚¹ï¼Œæˆ‘ä»¬ä»‹ç»å¤šç§ä¸Šä¼ æ–¹æ¡ˆï¼ŒåŒ…æ‹¬åœ¨å·¥ç¨‹åŒ–é˜¶æ®µã€é€šè¿‡ CLI æˆ–è€…æ¥å£ã€‚å¯¹äºç¬¬äºŒç‚¹ï¼Œæˆ‘ä»¬ä¼šä» Sentry çš„å®ç°æ–¹é¢å¯¹å…¶æ ¸å¿ƒç‚¹è¿›è¡Œé˜è¿°ï¼ŒåŒæ—¶ä¹Ÿä¼šä»‹ç»æå‡è¯·æ±‚å®¹å¿åº¦çš„è§£å†³æ–¹æ¡ˆã€‚

### Upload Source Maps

:::warning Before Upload

1. éœ€è¦ç”³è¯·æŒ‡å®šæƒé™çš„ token
2. éœ€è¦é…ç½® SDK å’Œä¸Šä¼ æ—¶ release ä¸€è‡´
3. å¼€å¯ SourceMapï¼Œå¹¶ä¸”æºæ–‡ä»¶å’Œ Source Maps éƒ½éœ€è¦ä¸Šä¼ 
4. ä¸€èˆ¬ä¸è¦æš´éœ² Source Maps åˆ°çº¿ä¸Šï¼ˆä¸æ‰“åŒ…äº§ç‰©åŒåŸŸï¼‰

:::

Sentry æ”¯æŒä¸‰ç§ä¸Šä¼ æ–¹å¼ï¼š

- åœ¨å·¥ç¨‹æ„å»ºé˜¶æ®µï¼Œé€šè¿‡æ„å»ºå·¥å…·æ’ä»¶ä¸Šä¼ 
- é€šè¿‡ Sentry API ä¸Šä¼ 
- é€šè¿‡ SENTRY-CLI ä¸Šä¼ 

**è¯·è®°ä½ï¼Œæˆ‘ä»¬æ‰§è¡Œä¸Šä¼ åŠ¨ä½œæ—¶ï¼Œåªæ˜¯ä»‹è´¨ä¸åŒï¼Œæœ€ç»ˆéƒ½æ˜¯è°ƒç”¨ä¸Šä¼ æ¥å£ä¸Šä¼ æ–‡ä»¶ã€‚**å› æ­¤ï¼Œé…ç½®é€šå¸¸æ˜¯é€šç”¨çš„ï¼š

```ts
const upload_config = {
  // å¿…ä¼ å‚æ•°
  org: '[organization name]',
  project: '[project name]',
  include: '[output directory]',
  authToken: '[token]',
  url: 'https://sentry.io/',
  release: '[release name]',
  // å¯é€‰ï¼Œä¸Šä¼ å‰æ¸…é™¤ä¹‹å‰çš„ artifacts
  cleanArtifacts: true,
  // é¿å…ä¸ŠæŠ¥é”™è¯¯ä¿¡æ¯åˆ° Sentry
  telemetry: false,
}
```

#### vite-plugin

```bash

yarn add --dev @sentry/vite-plugin

```

é…ç½® `vite.config.ts`

```typescript
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
import path from 'path'
import type { PluginOption } from 'vite'
import sentryVitePlugin from '@sentry/vite-plugin'
import childProcess from 'node:child_process'

export const run = (cmd: string, { unify = false } = {}) => {
  return new Promise((resolve, reject) => {
    childProcess.exec(cmd, {}, (err, stdout, stderr) => {
      let output = ``
      if (unify) {
        output = stdout.toString() + stderr.toString()
      } else {
        output = stdout.toString()
      }
      if (err) {
        reject(err)
      }
      resolve((err ? '' : output).trim())
    })
  })
}

// è¿™é‡Œä¸ºäº†æµ‹è¯•ï¼Œæˆ‘å†™äº†ä¸ªæ’ä»¶ç”¨æ¥åœ¨æ‰“åŒ…å®Œæˆååˆ é™¤æ‰€æœ‰ sourceMap æ–‡ä»¶ï¼Œè¯»è€…å¯ä»¥è‡ªå·±æŒ‰éœ€ä½¿ç”¨æˆ–è€…ä½¿ç”¨ç¤¾åŒºæ–¹æ¡ˆ
// rollup åŒæ ·é€‚ç”¨
function cleanupSourceMaps(): PluginOption {
  return {
    name: 'cleanupSourceMaps',
    apply: 'build',
    closeBundle: async () => {
      await run(`rm -f ./dist/assets/*.js.map`)
    },
  }
}

const plugins = [react()]

if (process.env.NODE_ENV !== 'development') {
  plugins.push(sentryVitePlugin(upload_config))
}

export default defineConfig({
  // other options
  build: {
    sourcemap: true,
  },
  plugins: [...plugins, cleanupSourceMaps()],
})
```

#### rollup-plugin

rollup ä¸ vite é…ç½®ç±»ä¼¼ï¼Œæ³¨æ„å¼€å¯ sourcemap å³å¯ï¼š

```js
import sentryRollupPlugin from '@sentry/rollup-plugin'

export default {
  input: './src/index.js',
  plugins: [
    // Put the Sentry rollup plugin after all other plugins
    sentryRollupPlugin(upload_config),
  ],
  output: {
    sourcemap: true, // Source map generation must be turned on
    dir: './dist',
  },
}
```

#### webpack-plugin

```bash
npm install --save-dev @sentry/webpack-plugin
```

é…ç½® `jsconfig.json` æˆ–è€… `tsconfig.json` å¼€å¯ SourceMap:

```json
{
  "compilerOptions": {
    "inlineSourceMap": true,
    "sourceRoot": "/"
  }
}
// umi å†…
{
  "devtool": "source-map",
}
```

**ä¿®æ”¹ webpack é…ç½®**

è¿™é‡Œæ˜¯ä¸€ä¸ªé…ç½®çš„ä¾‹å­ï¼Œè¯·æ ¹æ®è‡ªèº« webpack é…ç½®æƒ…å†µåˆç†ä¿®æ”¹ï¼š

```javascript
const SentryCliPlugin = require('@sentry/webpack-plugin')

module.exports = {
  // å¼€å¯ source-map
  devtool: 'source-map',
  configureWebpack: (config) => {
    // ç”Ÿäº§ç¯å¢ƒä¸Šä¼ 
    if (process.env.NODE_ENV === 'production') {
      config.plugins = [
        ...config.plugins,
        new SentryCliPlugin(upload_config),
        // ä¸Šä¼ å®Œæ¯•ä¹‹ååˆ é™¤ js.map æ–‡ä»¶
        new CleanWebpackPlugin({
          cleanAfterEveryBuildPatterns: ['**/*.map'],
          protectWebpackAssets: false,
        }),
      ]
    }
  },
}
```

#### é€šè¿‡ API æ¥å£

å‚è€ƒ[Upload a New Project Release File](https://docs.sentry.io/api/releases/upload-a-new-project-release-file/)çš„ä¸Šä¼ æ¥å£ï¼Œå‚è€ƒ [ğŸ”’ ä¸Šä¼ å·¥å…·](https://github.com/YaYaPao/docscripts/blob/main/sentry/scripts/upload_source_file.py)

å¿«é€Ÿä¾‹å­ï¼š

```bash
curl -X POST \
  'https://sentry.io/api/0/projects/[org]/[projectName]/releases/[releaseName]/files/' \
  --header 'Authorization: BearerÂ [token]' \
  --form '[filePath].map'
```

#### åˆ©ç”¨ sentry-cli ä¸Šä¼ 

ä½¿ç”¨ `sentry-cli` ä¸Šä¼ ä¹‹å‰ï¼Œä½ éœ€è¦ä¸ºä½ çš„é¡¹ç›®çš„æ­¤æ¬¡å‘å¸ƒè®¾ç½®ä¸€ä¸ªå¹³å°å†…ç‹¬ä¸€æ— äºŒçš„ **release name**ï¼Œfems ä¼šç”¨ release æ¥åŒ¹é…çº¿ä¸Šé”™è¯¯å’Œ sourcemap æ–‡ä»¶ã€‚

ä¸‹é¢æ˜¯å…·ä½“æ“ä½œæ­¥éª¤ï¼š

1. åˆ›å»ºä¸€ä¸ª releaseï¼Œæ³¨æ„ `release_name` éœ€è¦å’Œ SDK é…ç½®çš„ release å­—æ®µå€¼ä¸€è‡´ï¼Œä¸”å…¨å¹³å°å”¯ä¸€ã€‚

```bash
sentry-cli releases new <release_name>
```

2. ä¸Šä¼  Source Mapsï¼Œå¦‚ä¸‹ä¼šæŠŠæŒ‡å®šç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ä¸Šä¼ åˆ° Sentryï¼Œå¹¶æŒ‡å®šä¸ºå½“å‰ release_nameï¼Œæ³¨æ„è¯¥æ–‡ä»¶å¤¹ä¸‹éœ€è¦åŒæ—¶åŒ…å«**éƒ¨ç½²æ–‡ä»¶**å’Œ**sourceMap æ–‡ä»¶**ï¼Œå¤„ç†å®Œæˆåï¼Œä¸Šä¼ æ–‡ä»¶ä¼šè¢«æš‚å­˜èµ·æ¥ï¼Œæˆ‘ä»¬ç»§ç»­æ‰§è¡Œæœ€åä¸€æ­¥æ¥å®Œæˆå‘å¸ƒï¼

```bash
sentry-cli releases files <release_name> upload-sourcemaps /path/to/files
```

3. å®Œæˆå‘å¸ƒ

```bash
sentry-cli releases finalize <release_name>
```

### Fetch Source Maps Online

é™¤äº†å°†æ–‡ä»¶ä¸Šä¼ åˆ° Sentry å¹³å°å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡å¼€å¯ `Allow JavaScript Source Fetching` æ¥è®© Sentry ç›´æ¥ä»çº¿ä¸Šå»æ‹‰å–æ–‡ä»¶ã€‚å¤§å®¶å¯ä»¥æ€è€ƒä¸€ä¸‹ï¼Œ**ä¸ºä»€ä¹ˆ Sentry ä¸å»ºè®®è¿™ä¹ˆåšï¼Ÿ**

:::warning Why notï¼Ÿ

1. å­˜åœ¨å®‰å…¨é£é™©
2. é˜»å¡ Sentry å¤„ç†è¿›ç¨‹

:::

å¯¹äº**å®‰å…¨é£é™©**ï¼Œæˆ‘ä»¬ä»ä¸¤æ–¹é¢è¿›è¡Œè§£å†³ï¼š

- å¯¹äºå¼€å‘è€…æ¥è¯´ï¼Œæˆ‘ä»¬å¿…é¡»å°† Source Maps æ–‡ä»¶æ”¾åœ¨çº¿ä¸ŠæŒ‡å®šä½ç½®ï¼ˆå¯ä»¥é€šè¿‡ rewriteFrame æ¥æ”¹å˜ä½ç½®ï¼‰ï¼Œè¿™æ ·å­˜åœ¨æºç æš´éœ²çš„é£é™©
- æ›´é‡è¦çš„æ˜¯å­˜åœ¨ CSRF å®‰å…¨é—®é¢˜ï¼Œä¼šå°†å†…ç½‘ç¯å¢ƒæš´éœ²ï¼Œæ¯”å¦‚ Stack Trace æ–‡ä»¶åæ›¿æ¢æˆä¸€ä¸ªè„šæœ¬åœ°å€ç­‰

å¯¹äº CSRFï¼Œæˆ‘é€šè¿‡è‡ªå»ºçš„ç™½åå•æœºåˆ¶å¯¹å…¶è¿›è¡Œè§£å†³ã€‚

åŒæ—¶ï¼ŒSentry ä¼šå¯åŠ¨ worker æ¥å¤„ç† eventsï¼Œå½“éœ€è¦è¯·æ±‚çº¿ä¸Šæ–‡ä»¶æ—¶ï¼Œä¼šé˜»å¡å½“å‰çš„å¤„ç†ç¨‹åºï¼Œç­‰å¾…æ‹‰å–æ–‡ä»¶å®Œæ¯•å¹¶å†™å…¥ç¼“å­˜åï¼Œæ‰ä¼šç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡ã€‚è¿™é‡Œæˆ‘ä»¬å¯¹ Sentry æ‹‰å– Source Maps å†…å®¹è¿›è¡Œæ·±åº¦è§£è¯»ã€‚

#### Process Source Maps

Sentry åœ¨å¤„ç† events æ—¶ï¼Œä¼šæ ¹æ® Stack Trace ä¿¡æ¯å»è§£æå¹¶è¯·æ±‚æºæ–‡ä»¶ï¼Œåœ¨æ‹‰å–å›æºæ–‡ä»¶ä¹‹åï¼Œä¼šè§£ææ–‡ä»¶å†…å®¹ï¼Œè·å–çº¿ä¸Š Source Maps çš„è·¯ç”±åœ°å€ï¼Œ<HighlightWithBadge label='æ‹‰å–æ–‡ä»¶å†…å®¹å¹¶è¿›è¡Œç¼“å­˜' />

Sentry æœ¬èº«å­˜åœ¨ä¸¤ç§ç¼“å­˜æœºåˆ¶ï¼š

- ä¸€ç§æ˜¯ Setrny è‡ªå·±çš„å®ç°ï¼Œå³ç»“åˆ Redis è¿›è¡Œç¼“å­˜ï¼›
- ä¸€ç§æ˜¯ Django æœ¬èº«çš„ç¼“å­˜æœºåˆ¶ï¼Œå³é€šè¿‡ memcached è¿›è¡Œç¼“å­˜ï¼Œæ–‡ä»¶å†…å®¹é€šå¸¸ä¼šæ”¾åœ¨ memcached æœåŠ¡å†…è¿›è¡Œå­˜å‚¨

å› æ­¤å½“æˆ‘ä»¬å‘ç°**æ–‡ä»¶å†…å®¹è¿‡å¤§å¯¼è‡´ä¸èƒ½å­˜å‚¨**çš„é”™è¯¯æ—¶ï¼Œå¯ä»¥ä» memcached é…ç½®å…¥æ‰‹è¿›è¡Œæ”¹å–„ã€‚
