---
id: features
title: Sentry Features
sidebar_label: Features
---

## ä½¿ç”¨ SDK

è¿™é‡Œæˆ‘ä»¬ä»¥æµè§ˆå™¨ç«¯æ¥å…¥ä¸ºä¾‹ï¼ˆå…¶ä»–å¹³å°æ¥å…¥é…ç½®å¯ä»¥å‚è€ƒ[docs-platform](https://docs.sentry.io/platforms/javascript/)ï¼‰å…¶é…ç½®å¦‚ä¸‹ï¼š

```javascript
import * as Sentry from '@sentry/browser'
import { Integrations } from '@sentry/tracing'

Sentry.init({
  dsn: 'https://examplePublicKey@o0.ingest.sentry.io/0',
  release: 'my-project-name@2.3.12',
  // store é€šé“çš„é‡‡æ ·ç‡
  smapleRate: 1
  integrations: [new Integrations.BrowserTracing()],
  // envelope é€šé“çš„é‡‡æ ·ç‡
  tracesSampleRate: 1,
  beforeSend(event, hint) {
    return event
    // return null ä¼šå°†æ­¤æ¬¡ä¸ŠæŠ¥ä¸¢å¼ƒ
  }
})
```

`beforeSend(event, hint)` å†…çš„ hint å‚æ•°ä¼šæºå¸¦åŸå§‹å¼‚å¸¸å †æ ˆä¿¡æ¯ï¼Œå¯ä»¥åœ¨æ­¤æ›´æ”¹æŒ‡çº¹æ¥å½±å“ Sentry å¯¹ issues çš„èšåˆæ–¹å¼

```js
beforeSend(event, hint) {
  const error = hint.originalException;
  if (
    error &&
    error.message &&
    error.message.match(/database unavailable/i)
  ) {
    event.fingerprint = ["database-unavailable"];
  }
  return event;
}
```

## Sampling

### ä¸ºä»€ä¹ˆè¦é‡‡æ ·ï¼Ÿ

æœ€ç†æƒ³çš„æƒ…å†µæ˜¯ï¼Œæˆ‘ä»¬å¸Œæœ›å°†å®¢æˆ·ç«¯ä¸ŠæŠ¥çš„æ‰€æœ‰æ•°æ®è¿›è¡Œå¤„ç†å¹¶å­˜å‚¨ï¼Œè¿™å°†ä¸ºæˆ‘ä»¬åœ¨æ•°æ®åˆ†ææ—¶æå‡å‡†ç¡®ç‡ã€‚

ä½†æ˜¯ï¼Œå½“**æµ·é‡æ•°æ®ï¼ˆenormous volume of dataï¼‰**ç”±å®¢æˆ·ç«¯è¿›è¡Œä¸ŠæŠ¥åï¼ŒæœåŠ¡å™¨çš„è®¡ç®—æˆæœ¬å’Œæ•°æ®å­˜å‚¨æˆæœ¬å°†æ˜¯æˆ‘ä»¬ä¸å¾—ä¸è€ƒè™‘çš„é—®é¢˜ã€‚

### è®¾è®¡é‡‡æ ·ç­–ç•¥çš„éš¾ç‚¹ï¼Ÿ

Sentry å¦‚ä½•è®¾è®¡é‡‡æ ·æ–¹æ¡ˆï¼Ÿ

## Grouping Issues

:::note
é”™è¯¯äº‹ä»¶çš„èšåˆ
:::

åœ¨æœ¬ç« ï¼Œæˆ‘ä»¬å°†ä¼šåœ¨[Issue Grouping](https://docs.sentry.io/product/data-management-settings/event-grouping/#grouping-by-stack-trace)çš„åŸºç¡€ä¸Šä»‹ç» Sentry å†…ç½®èšåˆè§„åˆ™ä»¥åŠå¦‚ä½•è‡ªå®šä¹‰èšåˆè§„åˆ™ã€‚

å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦æ˜æ™°ï¼šSentry å†…åŒæ—¶å­˜åœ¨ Issues å’Œ Event çš„æ¦‚å¿µã€‚Issue æ˜¯ Error event æŒ‰ç…§ä¸€å®šè§„åˆ™èšåˆåçš„äº§ç‰©ã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬ä¸å¦¨æ€è€ƒä¸€ä¸‹ï¼š

- æ•°äº¿çš„é”™è¯¯äº‹ä»¶æ˜¯å¦‚ä½•è¢«åˆ†é—¨åˆ«ç±»æ”¾åˆ°ä¸åŒçš„ issue å†…ï¼Ÿ
- å¦‚ä½•è®¾è®¡æ ¸å¿ƒæ–¹æ¡ˆä»¥æ”¯æŒç”¨æˆ·è‡ªå®šä¹‰èƒ½åŠ›ï¼Ÿ

### How to group error events?

Sentry å†…èšåˆé€»è¾‘çš„æ ¸å¿ƒåœ¨äº <HighlightWithCode bgcolor="#ef613e">fingerprint</HighlightWithCode>ã€‚

æ¯ä¸ªé”™è¯¯éƒ½ä¼šæœ‰æŒ‰ç…§æŒ‡å®šèšåˆç®—æ³•ç”Ÿæˆå¯¹åº”çš„ fingerprintï¼ŒSentry æ ¹æ® fingerprint ç”Ÿæˆå¯¹åº”çš„ `Group Hash Code`ï¼Œå¹¶ä»¥æ­¤æ¥å¯¹é”™è¯¯äº‹ä»¶è¿›è¡Œå½’ç±»ã€‚å³ç›¸åŒçš„ `Group Hash Code` è¢«å½’ä¸ºåŒä¸€ä¸ª `issue`ã€‚

æˆ‘ä»¬å¯ä»¥åœ¨ `Error details > JSON link > fingerprint property` å†…æŸ¥çœ‹ç½®é¡¶é”™è¯¯äº‹ä»¶çš„æŒ‡çº¹ã€‚

**æ³¨æ„ï¼Œå¦‚æœä½¿ç”¨å†…å»ºçš„èšåˆè§„åˆ™ä¼šå±•ç¤º `fingerprint: "{{ default }}"`ï¼Œå¦åˆ™ä¼šå±•ç¤ºå±•ç¤ºçš„ fingerprint å€¼ã€‚**

### Built-in Grouping Algorithms

ç›¸ä¿¡ä¸å°‘ç”¨æˆ·éƒ½æœ‰åŒæ ·çš„å›°æ‰°ï¼Œæ˜æ˜åœ¨é¡µé¢ä¸Šå±•ç¤ºçš„é”™è¯¯ä¿¡æ¯å€¼ä¸ä¸€æ ·ï¼Œä¸ºä»€ä¹ˆä¼šè¢«å½’çº³åˆ°åŒä¸€ä¸ª issue å‘¢ï¼Ÿ

ç­”æ¡ˆæ˜¯ï¼šSentry å†…ç½®çš„èšåˆç®—æ³•**ä¼šæ ¹æ®é”™è¯¯çš„å †æ ˆè¿½è¸ªä¿¡æ¯æ¥ç”Ÿäº§ fingerprint**ã€‚å³é”™è¯¯äº‹ä»¶çš„å †æ ˆä¿¡æ¯ç›¸åŒï¼Œåˆ™æ­¤ç±»é”™è¯¯äº‹ä»¶å±äºåŒä¸€ä¸ª issueã€‚

:::caution

- æ‰€æœ‰çš„èšåˆç­–ç•¥ï¼Œå‡éµå¾ª `stack trace -> exception -> message` çš„æ¬¡åºè¿›è¡Œå¤„ç†ï¼Œä¸€æ—¦ group hash code ç”Ÿæˆï¼Œä¸ä¼šç»§ç»­æ‰§è¡Œå‰©ä¸‹çš„é€»è¾‘
- ä»…æœ‰ `stack trace` ç”Ÿæˆçš„ group hash code æ˜¯å¯é çš„

:::

#### Grouping by stack trace

å½“é”™è¯¯äº‹ä»¶åˆ°è¾¾æ—¶ï¼ŒSentry ä¼šä»æå–å…¶ stack trace æ•°æ®ã€‚**å¹¶ä¸” sentry ä»…ä¼šå¤„ç†ç”± SDK ä¸ŠæŠ¥å¹¶ä¸åº”ç”¨å…³è”çš„ stack trace framesã€‚**

åŸå› åœ¨äºï¼š

1. æœ‰ä¸€äº›å¹³å°çš„ SDK ä¸ä¼šä¸ŠæŠ¥å †æ ˆè¿½è¸ªä¿¡æ¯ï¼›
2. å¦‚æœä»…ä»…æ˜¯ä¸é¡¹ç›®æ— å…³çš„å †æ ˆä¿¡æ¯ä¸ä¸€è‡´ï¼Œé”™è¯¯äº‹ä»¶ä»ç„¶ä¼šè¢«å½’ä¸ºåŒä¸€ç±»ï¼›

Sentry åœ¨å †æ ˆè¿½è¸ªä¿¡æ¯å†…ä¼šæå–ï¼š

- æ¨¡å—åï¼›
- æ ‡å‡†åŒ–çš„æ–‡ä»¶åï¼Œæ¯”å¦‚ä¿®è®¢åçš„ hash å€¼ä¼šè¢«åˆ é™¤æ‰ï¼›
- æ ‡å‡†åŒ–çš„ä¸Šä¸‹æ–‡ï¼Œå³å—å½±å“çš„ä»£ç ï¼ˆæºç ï¼Œå¦‚æœèƒ½å¤ŸåŒ¹é… sourcemapï¼‰

è¿™é‡Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–¹æ³•ï¼Œåœ¨ç›¸åŒçš„æ–¹æ³•å†…ï¼ŒæŠ›å‡ºä¸åŒçš„é”™è¯¯ä¿¡æ¯ï¼š

```js
// æŠ›å‡ºä¸€ä¸ªError, value ä¸ºå½“å‰æ—¶é—´
function sendSentry() {
  throw new Error(new Date().toLocaleString())
}
```

åœ¨ Sentry è¿”å›ç»“æœï¼š

![group_diff](/img/fte/sentry/sentry_group_diff.png)

æ ¹æ®ä¸Šå›¾ç»“æœæˆ‘ä»¬å¯ä»¥å¾—å‡ºï¼š**ä½¿ç”¨é»˜è®¤çš„å†…å»ºèšåˆè§„åˆ™ï¼Œåœ¨ stack trace ç›¸åŒçš„æƒ…å†µä¸‹ä¼šè¢«èšåˆåˆ°åŒä¸€ä¸ª issueï¼Œå³ä½¿ä»–ä»¬çš„ exception/message å¹¶ä¸ç›¸åŒã€‚**

æˆ‘ä»¬ç»§ç»­åœ¨ issue details é¡µé¢å±•å¼€ `EVENT GROUPING INFORMATION` æ¥å¯¹æ¯”åŒä¸€ä¸ª issue å†…ä¸åŒ event çš„èšåˆç»†èŠ‚ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

![group_info](/img/fte/sentry/group_information.png)

æˆ‘ä»¬ä¸éš¾å‘ç°ï¼š**åœ¨è¯¥ issue å†…çš„é”™è¯¯æ‹¥æœ‰ç›¸åŒçš„ `group hash code`ï¼Œå®é™…ä¸Š Sentry æœ€ç»ˆä¹Ÿæ˜¯æ ¹æ®å®ƒæ¥ç¡®å®š event å½’å±ï¼**

#### Grouping by exception

å½“ stack trace æ— æ³•æ‰¾åˆ°æ—¶ï¼ŒSentry ä¼šä½¿ç”¨ exception çš„ `type` å’Œ `value` å­—æ®µè¿›è¡Œå…œåº•ï¼Œæ­¤æ—¶èšåˆä¸å¯é ï¼

å¼‚å¸¸ä¿¡æ¯å¦‚ä¸‹æ‰€ç¤ºï¼š

```
Error: 2022/4/21 18:04:06
  at Error: 2022(/4/21 18:4:6)
  at sendSentry(/main.d1f2e7dbd07e024bf014.hot-update.js:27:11)
  at dispatchDiscreteEvent(/static/js/bundle.js:27074:7)
```

å¦‚ä¸Šæ‰€ç¤ºï¼Œtype ä¹Ÿå°±æ˜¯ exception nameï¼Œå³ Errorï¼›value åˆ™ä¸ºäººç±»å¯è¯»çš„æè¿°ï¼Œå³ 2022/4/21 18:04:06

#### Fallback Grouping

å¦‚æœä»¥ä¸Šéƒ½ä¸èƒ½å¥æ•ˆæ—¶ï¼ŒSentry å°†å°è¯•ä½¿ç”¨ä¸å¸¦ä»»ä½•å‚æ•°çš„ messageã€‚å¦‚æœè¿™ä¸å¯ç”¨ï¼Œå°†ä½¿ç”¨å®Œæ•´çš„ message å±æ€§æ¥è¿›è¡Œèšåˆã€‚

### How to customized Grouping?

å®é™…ä¸Šï¼ŒSentry å†…å»ºçš„èšåˆè§„åˆ™èƒ½å¤Ÿæ»¡è¶³æˆ‘ä»¬ 80% ä»¥ä¸Šçš„ä½¿ç”¨åœºæ™¯ï¼Œä½†æ˜¯å¯¹äºæˆ–å¤šæˆ–å°‘çš„é”™è¯¯äº‹ä»¶æˆ‘ä»¬éœ€è¦æ‹†åˆ†æˆ–è€…èšåˆæ¥æ›´æ­£ç¡®åœ°åˆ†ææ•°æ®ï¼Œå› æ­¤æˆ‘ä»¬ä¹Ÿè¿«åˆ‡éœ€è¦è‡ªå®šä¹‰èšåˆè§„åˆ™çš„èƒ½åŠ›ã€‚æ‰€å¹¸ï¼ŒSentry æä¾›äº†ä¸åŒçš„æ–¹æ¡ˆï¼Œæ¥å¸®åŠ©ç”¨æˆ·æ›´ç§‘å­¦åœ°å½’çº³é”™è¯¯äº‹ä»¶ã€‚

- `Merge Issues` åˆå¹¶å·²å­˜åœ¨ issue
- `Fingerprint Rules` åº”ç”¨æ‰€æœ‰æ–°å…¥çš„é”™è¯¯äº‹ä»¶ï¼Œå†³å®šç”Ÿæˆ `group hash code` çš„è§„åˆ™
- `Stack Trace Rules` åº”ç”¨æ‰€æœ‰æ–°å…¥çš„é”™è¯¯äº‹ä»¶ï¼Œå†³å®šç”Ÿæˆ `group hash code` çš„ stack trace

å¯¹äº `Fingerprint Rules` å’Œ `Stack Trace Rules` éƒ½éµå¾ªç»Ÿä¸€çš„åŒ¹é…è§„åˆ™ï¼Œå³ï¼š

- ä¸åŒè¡Œå½¢æˆ**æˆ–**çš„å…³ç³»
- ç»Ÿä¸€è¡Œä¸åŒè§„åˆ™å½¢æˆ**ä¸**çš„å…³ç³»

#### Merge Issues

merge issues æ˜¯ Sentry æä¾›æœ€æ˜“æ“ä½œçš„è‡ªå®šä¹‰èšåˆèƒ½åŠ›ï¼Œå®ƒç”¨æ¥å¤„ç†ï¼š

1. å¤šä¸ª issues ç±»ä¼¼ï¼›
2. ç”¨æˆ·å¸Œæœ›å‡å°‘ issue noiseï¼Œä½¿ issues é¢æ¿æ›´åŠ æ•´æ´ï¼Œæ–¹ä¾¿ä¸“æ³¨äºæŸä¸€ç±» issueï¼›

`merge issues` å±äºäº‹åçš„äººå·¥å¹²é¢„ï¼Œä»…ä¼šå½±å“å·²å¤„ç†çš„é”™è¯¯äº‹ä»¶ä»¥åŠå°†æ¥ä¸ŠæŠ¥çš„ç›¸åŒçš„é”™è¯¯äº‹ä»¶ã€‚å…¶æ“ä½œæ–¹æ³•å¾ˆç®€å•ï¼Œåœ¨ issues é¢æ¿é€‰æ‹©ä¸åŒçš„ issue è¿›è¡Œåˆå¹¶å³å¯ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚

:::caution

**Sentry ä¸ä¼šæ ¹æ® merge issues æ¥æ¨æ–­æ–°çš„èšåˆè§„åˆ™ï¼Œä»…å½“æ–°çš„é”™è¯¯äº‹ä»¶æ‹¥æœ‰å’Œå½“å‰ merged issues ç›¸åŒçš„ fingerprint å¹¶ç”Ÿäº§åŒæ ·çš„ group hash code æ‰ä¼šè¢«è‡ªåŠ¨èšåˆ**

:::

#### Fingerprint Rules

Sentry æ”¯æŒé€šè¿‡é…ç½® `[Project] > Settings > Issue Grouping > FINGERPRINT RULES` åœ¨æœåŠ¡ç«¯æ ¹æ®è‡ªå®šä¹‰èšåˆè§„åˆ™ã€‚

**æ³¨æ„ï¼Œé…ç½® fingerprint rules ä¼šè¦†ç›–é»˜è®¤çš„èšåˆè§„åˆ™**

finterprint rules éµå¾ªå¦‚ä¸‹æ¨¡å¼ï¼š

```
# partten
matcher:glob -> fingerprint, values title=""
```

æ¯”å¦‚ï¼Œæˆ‘ä»¬é…ç½®äº†ä¸€æ¡è§„åˆ™ `error.type:ReferenceError -> Not-found-error, {{ transaction }}`ï¼Œå®ƒè¡¨ç¤ºåŒ¹é…æ‰€æœ‰ type ä¸º ReferenceError çš„é”™è¯¯äº‹ä»¶ï¼Œå¯¹å…¶èšåˆå¹¶èµ‹å€¼ fingerprint ä¸º Not-found-errorï¼ŒåŒæ—¶ï¼Œä½¿ç”¨ {{ transaction }} è¿›è¡Œé€šé…ï¼Œè¾¾åˆ°æŒ‰ç…§ä¸åŒ transaction è¿›è¡Œèšåˆçš„ç›®çš„

åœ¨äº†è§£åŸºæœ¬è§„åˆ™ä¹‹åï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨å¯¹ä¸Šæ–‡çš„ä¾‹å­è¿›è¡Œæ‹†åˆ†ï¼Œå³æŒ‰ç…§ä¸åŒçš„ exception å€¼æ¥å¯¹é”™è¯¯äº‹ä»¶è¿›è¡Œèšåˆï¼Œå¹¶åœ¨ issue ä¸Šè‡ªå®šä¹‰æ ‡é¢˜å±•ç¤ºã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨é¡¹ç›®å†…é…ç½®äº†ä¸€æ¡ fingerprint ruleï¼Œå¦‚ä¸‹ï¼š

```
error.type:Error -> error, {{ error.value }} title="Error from value={{ error.value }}"
```

å½“æˆ‘ä»¬åœ¨å®¢æˆ·ç«¯å†æ¬¡è§¦å‘é”™è¯¯æ—¶ï¼Œæˆ‘ä»¬è§‚å¯Ÿåˆ°ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š

![fingerprint-rules](/img/fte/sentry/fingerprint_rules.png)

æ®æ­¤æˆ‘ä»¬å¯ä»¥åˆ†æï¼š

1. æ ¹æ®å†…å»ºç®—æ³•å¯¹é”™è¯¯äº‹ä»¶è¿›è¡Œèšåˆï¼Œè¿™äº›é”™è¯¯æ‹¥æœ‰ç›¸åŒçš„å †æ ˆä¿¡æ¯å’Œ `group hash code`
2. å½“é…ç½®å¦‚ä¸Š `FINGERPRINT RULES` ä¹‹åï¼Œä¼šå¯¹æ‰€æœ‰ `error.type=Error` çš„é”™è¯¯æŒ‰ç…§ `error.value` è¿›è¡Œåˆ†ç±»ï¼Œä¸”æ ‡é¢˜å±•ç¤º `Error from value={{ error.value }}`
3. æ ¹æ®è‡ªå®šä¹‰è§„åˆ™ï¼Œå…¶ `fingerprint values` æ ¹æ® exception çš„å€¼è€Œå‘ç”Ÿå˜åŒ–ï¼Œå¯¼è‡´å…¶ `group hash code` ä¸å°½ç›¸åŒï¼Œæœ€ç»ˆè¢«èšåˆåˆ°ä¸åŒçš„ issue

#### Stack Trace Rules

åŸºäº `stack trace` ç¬¬ä¸€å¯é çš„åŸåˆ™ï¼ŒSentry ä¸ºæˆ‘ä»¬æä¾›åœ¨ç”Ÿæˆ `group hash code` ä¹‹å‰å¤„ç† `stack trace` çš„èƒ½åŠ›ï¼Œå®ƒè¢«çœ‹ä½œæ˜¯èšåˆè§„åˆ™çš„å¢å¼ºæªæ–½ã€‚

æ€è·¯å°±æ˜¯åœ¨èšåˆä¹‹å‰ï¼Œå…è®¸æˆ‘ä»¬æŒ‰ç…§è§„åˆ™ä¿®æ”¹ `stack trace` æ¥å½±å“æœ€ç»ˆèšåˆç»“æœã€‚

åŒæ ·ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ `[Project] > Settings > Issue Grouping > Stack Trace Rules` å†…é…ç½®ç›¸åº”è§„åˆ™ã€‚å…¶ pattern å¦‚ä¸‹ï¼š

```
# Enhancement Rules
matcher-name:expression other-matcher:expression ... action1 action2 ...
```

å®šä¹‰è§„åˆ™æ”¯æŒçš„æ ‡å¿—ç¬¦ï¼š

- `+`: è®¾ç½®æ ‡è®°
- `-`: æ¸…é™¤æ ‡è®°
- `^`: åº”ç”¨å½“å‰ frame åˆ°æ ˆé¡¶çš„æ‰€æœ‰ frame
- `v`: åº”å½“å½“å‰ frame åˆ°æ ˆåº•æ‰€æœ‰çš„ frame
- `app`: åœ¨åº”ç”¨å†…æ ‡è®°/æ¸…é™¤æ ‡è®°æŒ‡å®š frame
- `group`: èšåˆæ—¶æ·»åŠ /æ¸…é™¤æŒ‡å®š frame

æˆ‘ä»¬é€šè¿‡ä½¿ç”¨æ ‡å¿—ç¬¦çš„ç»„åˆæ¥è¾¾åˆ°ä¸åŒçš„æ•ˆæœï¼Œå¦‚ä¸‹æˆ‘ä»¬åˆ—ä¸¾äº†ä¸€ç»„ä¾‹å­å¸®åŠ©ç†è§£ï¼š

```
# frame å†…ç»å¯¹è·¯å¾„å‘½ä¸­ **/node_modules/** è§„åˆ™çš„ï¼Œèšåˆæ—¶éƒ½ä¸ä¼šå‚ä¸è®¡ç®—
stack.abs_path:**/node_modules/** -group

# æ ‡è®°æ‰€æœ‰ node_modules ç›®å½•ä¸‹çš„æ‰€æœ‰ä»£ç ä¸ºä¸å†åº”ç”¨ä¸­
stack.abs_path:**/node_modules/** -app

# native å¹³å°å…è®¸çš„æœ€å¤§å¸§ä¸º 3ï¼ˆä»æ ˆé¡¶å‘ä¸‹æ•°ï¼‰
family:native max-frames=3

# å‘½ä¸­ function ä¸º fetchSavedSearches çš„ä¸‹é¢æ‰€æœ‰å¸§éƒ½ä¸ä¼šè¢«çº³å…¥èšåˆè®¡ç®—
stack.function:fetchSavedSearches v-group
```

## Integration

:::note
[Integation](https://docs.sentry.io/product/integrations/integration-platform/) æ˜¯æˆ‘ä»¬èƒ½å¤Ÿä»‹å…¥ Sentry çš„å¤„ç†æµç¨‹ï¼Œå¹¶æ ¹æ®è‡ªå·±çš„éœ€æ±‚è¿›è¡Œå¼€å‘ã€‚
:::

åœ¨æœ¬ç« ï¼Œæˆ‘ä»¬ä¼šä»‹ç»å¦‚ä½•åœ¨ Sentry å†…åˆ›å»ºä¸€ä¸ªå†…éƒ¨é›†æˆï¼Œæ¥è‡ªå®šä¹‰å·¥ä½œæµã€‚Sentry å°†é›†æˆåˆ†ä¸ºï¼š`internal` å’Œ `public`ã€‚

- `internal integation` ä»…èƒ½è¢«ç”¨åœ¨ä½ çš„ç»„ç»‡å†…ï¼Œåˆ›å»ºåä¼šè‡ªåŠ¨åº”ç”¨åœ¨ç»„ç»‡å†…æ‰€æœ‰é¡¹ç›®ï¼ŒéªŒè¯è¿‡ç¨‹ç›¸å¯¹ç®€å•
- `public integation` èƒ½è¢«å‘å¸ƒï¼Œä¾›æ‰€æœ‰ Sentry ç”¨æˆ·ä½¿ç”¨ï¼ŒéªŒè¯è¿‡ç¨‹ç›¸å¯¹å¤æ‚

åœ¨ `/settings/[org]/developer-settings/` æŒ‰ç…§å®é™…éœ€æ±‚é€‰æ‹© integation å¹¶å†™å…¥åŸºæœ¬ä¿¡æ¯åè¿›è¡Œåˆ›å»ºï¼ˆåæœŸä¹Ÿå¯ä»¥æ ¹æ®éœ€æ±‚è¿›è¡Œä¿®æ”¹ï¼‰ã€‚

### åˆ›å»ºä¸€ä¸ª Internal Integation

ç”¨ä¸€å¥è¯æ¦‚æ‹¬æ•´ä¸ªæµç¨‹ï¼š**Sentry å°† Issus/Event å‘é€è‡³æœåŠ¡ï¼Œç”±æœåŠ¡è¿›è¡ŒéªŒè¯åæ‰§è¡Œç›¸åº”åŠ¨ä½œ**

å‚è€ƒ [Internal Integation](https://docs.sentry.io/product/integrations/integration-platform/internal-integration/) å’Œ [Round Robin Assignment](https://blog.sentry.io/2019/11/21/customize-your-sentry-workflow-a-sample-internal-integration) è¿›è¡Œå¿«é€Ÿæ­å»ºä¸€ä¸ªå†…éƒ¨é›†æˆã€‚

è¿™é‡Œæˆ‘ä»¬æŠ½ç¦»éƒ¨åˆ†æ ¸å¿ƒä»£ç ï¼š

```js
// éªŒè¯æ–¹æ³•ï¼Œæ³¨æ„ createHmac çš„å¼•å…¥æ–¹å¼
export const verifySignature: (
  request: any,
  secret: string
) => Promise<boolean> = async (request, secret) => {
  const { createHmac } = await import('node:crypto')
  const hmac = createHmac('sha256', secret)
  hmac.update(JSON.stringify(request.body), 'utf8')
  const digest = hmac.digest('hex')
  return digest === request.headers['sentry-hook-signature']
}

// webhook API
// ç”±äº internal integation å¯¹ç»„ç»‡å†…æ‰€æœ‰åº”ç”¨ç”Ÿæ•ˆï¼Œå› æ­¤æœ€å¥½è®¾ç½®ä¸€ä¸ªç™½åå•æ¥è¿‡æ»¤
@Post()
async doAssigned(
  @Body() body: any,
  @Headers() headers: Record<string, string>,
  @Request() req,
) {
  if (!verifySignature(req, round_robin_assigned_secret)) {
    return failed('bad signature')
  }
  const resource = headers['sentry-hook-resource']
  const { action } = body

  if (resource === 'issue' && action === 'created') {
    const { id: newIssueProjectID } = body.data.issue.project
    // ä»…å¯¹ç™½åå•å†…åº”ç”¨è¿›è¡Œå¤„ç†
    if (
      Array.isArray(this.whiteProjectIDs) &&
      this.whiteProjectIDs.includes(+newIssueProjectID)
    ) {
      const { id: issueID } = body.data.issue
      // éªŒè¯å®Œæˆä¹‹åï¼Œå¼€å§‹æ‰§è¡Œä¸šåŠ¡é€»è¾‘
    }
  }
  return successed({
    body,
    headers,
  })
}
```

## Source Maps

:::note Source Maps
Source Maps æ˜¯æ„å»ºæ—¶çš„äº§ç‰©ï¼Œç”¨æ¥æ˜ å°„æºæ–‡ä»¶ï¼Œå®šä½æºç ä½ç½®ã€‚
:::

Sentry æ”¯æŒåœ¨æŸ¥çœ‹ issues frames/event details æ—¶é€šè¿‡åŒ¹é… Stack Trace + Source Files + Source Maps æ¥å®šä½æºç ä¿¡æ¯ã€‚

åœ¨ Sentry å†…éƒ¨æ”¯æŒé€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼æ¥ä½¿ç”¨ Source Maps:

1. å°†æºæ–‡ä»¶å’Œ Source Maps æ–‡ä»¶ä¸Šä¼ è‡³å¹³å°ï¼Œåœ¨æ–‡ä»¶ç³»ç»Ÿå†…å¯»æ‰¾ Source Maps æ–‡ä»¶è¿›è¡ŒåŒ¹é…ï¼›
2. å¼€å¯ `Allow JavaScript Source Fetching` å¼€å…³ï¼Œç”± Sentry å»çº¿ä¸Šå¯»æ‰¾æºæ–‡ä»¶åŠå…¶ Source Maps æ–‡ä»¶ï¼Œè¿›è¡ŒåŒ¹é…ï¼›

é’ˆå¯¹ç¬¬ä¸€ç‚¹ï¼Œæˆ‘ä»¬ä»‹ç»ä¸Šä¼ çš„å…³é”®æ­¥éª¤ï¼Œå¯¹äºç¬¬äºŒç‚¹ï¼Œæˆ‘ä»¬ä¼šä» Sentry çš„å®ç°æ–¹é¢å¯¹å…¶æ ¸å¿ƒç‚¹è¿›è¡Œé˜è¿°ï¼ŒåŒæ—¶ä¹Ÿä¼šä»‹ç»å¢å¤§è¯·æ±‚å®¹å¿åº¦çš„è§£å†³æ–¹æ¡ˆã€‚

### Upload Source Maps

ç›®å‰ sentry æ”¯æŒä¸‰ç§ä¸Šä¼ æ–¹å¼ï¼š

- é€šè¿‡ Sentry API ä¸Šä¼ 
- é…ç½® webpack åœ¨æ„å»ºæ—¶ä¸Šä¼ 
- é€šè¿‡ SENTRY-CLI ä¸Šä¼ 

:::caution

1. éœ€è¦ç”³è¯·æŒ‡å®šæƒé™çš„ token
2. éœ€è¦é…ç½® SDK å’Œä¸Šä¼ æ—¶ release ä¸€è‡´
3. æºæ–‡ä»¶å’Œ Source Maps éƒ½éœ€è¦ä¸Šä¼ 

:::

#### é€šè¿‡ API æ¥å£

å‚è€ƒ[Upload a New Project Release File](https://docs.sentry.io/api/releases/upload-a-new-project-release-file/)çš„ä¸Šä¼ æ¥å£ï¼Œå‚è€ƒ [ğŸ”’ ä¸Šä¼ å·¥å…·](https://github.com/YaYaPao/docscripts/blob/main/sentry/scripts/upload_source_file.py)

å¿«é€Ÿä¾‹å­ï¼š

```bash
curl -X POST \
  'https://sentry.io/api/0/projects/[org]/[projectName]/releases/[releaseName]/files/' \
  --header 'Authorization: BearerÂ [token]' \
  --form '[filePath].map'
```

#### é€šè¿‡ webpack æ’ä»¶

```bash
npm install --save-dev @sentry/webpack-plugin
```

é…ç½® `jsconfig.json` æˆ–è€… `tsconfig.json` å¼€å¯ SourceMap:

```json
{
  "compilerOptions": {
    "inlineSourceMap": true,
    "sourceRoot": "/"
  }
}
// umi å†…
{
  "devtool": "source-map",
}
```

**ä¿®æ”¹ webpack é…ç½®**

è¿™é‡Œæ˜¯ä¸€ä¸ªé…ç½®çš„ä¾‹å­ï¼Œè¯·æ ¹æ®è‡ªèº« webpack é…ç½®æƒ…å†µåˆç†ä¿®æ”¹ï¼š

```javascript
const SentryCliPlugin = require('@sentry/webpack-plugin')

module.exports = {
  // å¼€å¯ source-map
  devtool: 'source-map',
  configureWebpack: (config) => {
    // ç”Ÿäº§ç¯å¢ƒä¸Šä¼ 
    if (process.env.NODE_ENV === 'production') {
      config.plugins = [
        ...config.plugins,
        new SentryCliPlugin({
          authToken: 'token',
          include: './dist',
          org: 'organization_slug',
          project: 'project_slug',
          // æ³¨æ„ä¸ SDK é…ç½®çš„ release ä¸€è‡´
          release: 'release version',
          ignore: ['node_modules'],
          // url å¿…é¡»æŒ‡å®šï¼Œä¸ç„¶å°±ä¼šå»æºåœ°å€å¯»æ‰¾
          url: 'https://sentry.io/',
        }),
      ]
    }
  },
}
```

#### åˆ©ç”¨ sentry-cli ä¸Šä¼ 

ä½¿ç”¨ `sentry-cli` ä¸Šä¼ ä¹‹å‰ï¼Œä½ éœ€è¦ä¸ºä½ çš„é¡¹ç›®çš„æ­¤æ¬¡å‘å¸ƒè®¾ç½®ä¸€ä¸ªå¹³å°å†…ç‹¬ä¸€æ— äºŒçš„ **release name**ï¼Œfems ä¼šç”¨ release æ¥åŒ¹é…çº¿ä¸Šé”™è¯¯å’Œ sourcemap æ–‡ä»¶ã€‚

ä¸‹é¢æ˜¯å…·ä½“æ“ä½œæ­¥éª¤ï¼š

1. åˆ›å»ºä¸€ä¸ª releaseï¼Œæ³¨æ„ `release_name` éœ€è¦å’Œ SDK é…ç½®çš„ release å­—æ®µå€¼ä¸€è‡´ï¼Œä¸”å…¨å¹³å°å”¯ä¸€ã€‚

```bash
sentry-cli releases new <release_name>
```

2. ä¸Šä¼  Source Mapsï¼Œå¦‚ä¸‹ä¼šæŠŠæŒ‡å®šç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ä¸Šä¼ åˆ° Sentryï¼Œå¹¶æŒ‡å®šä¸ºå½“å‰ release_nameï¼Œæ³¨æ„è¯¥æ–‡ä»¶å¤¹ä¸‹éœ€è¦åŒæ—¶åŒ…å«**éƒ¨ç½²æ–‡ä»¶**å’Œ**sourceMap æ–‡ä»¶**ï¼Œå¤„ç†å®Œæˆåï¼Œä¸Šä¼ æ–‡ä»¶ä¼šè¢«æš‚å­˜èµ·æ¥ï¼Œæˆ‘ä»¬ç»§ç»­æ‰§è¡Œæœ€åä¸€æ­¥æ¥å®Œæˆå‘å¸ƒï¼

```bash
sentry-cli releases files <release_name> upload-sourcemaps /path/to/files
```

3. å®Œæˆå‘å¸ƒ

```bash
sentry-cli releases finalize <release_name>
```

### Fetch Source Maps Online

é™¤äº†å°†æ–‡ä»¶ä¸Šä¼ åˆ° Sentry å¹³å°å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡å¼€å¯ `Allow JavaScript Source Fetching` æ¥è®© Sentry ç›´æ¥ä»çº¿ä¸Šå»æ‹‰å–æ–‡ä»¶ã€‚å¤§å®¶å¯ä»¥æ€è€ƒä¸€ä¸‹ï¼Œ**ä¸ºä»€ä¹ˆ Sentry ä¸å»ºè®®è¿™ä¹ˆåšï¼Ÿ**

:::caution Why notï¼Ÿ

1. å­˜åœ¨å®‰å…¨é£é™©
2. é˜»å¡ Sentry å¤„ç†è¿›ç¨‹

:::

å¯¹äº**å®‰å…¨é£é™©**ï¼Œæˆ‘ä»¬ä»ä¸¤æ–¹é¢è¿›è¡Œè§£å†³ï¼š

- å¯¹äºå¼€å‘è€…æ¥è¯´ï¼Œæˆ‘ä»¬å¿…é¡»å°† Source Maps æ–‡ä»¶æ”¾åœ¨çº¿ä¸ŠæŒ‡å®šä½ç½®ï¼ˆå¯ä»¥é€šè¿‡ rewriteFrame æ¥æ”¹å˜ä½ç½®ï¼‰ï¼Œè¿™æ ·å­˜åœ¨æºç æš´éœ²çš„é£é™©
- æ›´é‡è¦çš„æ˜¯å­˜åœ¨ CSRF å®‰å…¨é—®é¢˜ï¼Œå¦‚æœå­˜åœ¨æ”»å‡»æœºåœ¨çº¿ä¸Šè„šæœ¬å†…æ¤å…¥æ¶æ„è„šæœ¬ï¼ŒSentry åœ¨å»æ‹‰å–çº¿ä¸Šæ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡Œæ¶æ„è„šæœ¬

åŒæ—¶ï¼ŒSentry ä¼šå¯åŠ¨ worker æ¥å¤„ç† eventsï¼Œå½“éœ€è¦è¯·æ±‚çº¿ä¸Šæ–‡ä»¶æ—¶ï¼Œä¼šé˜»å¡å½“å‰çš„å¤„ç†ç¨‹åºï¼Œç­‰å¾…æ‹‰å–æ–‡ä»¶å®Œæ¯•å¹¶å†™å…¥ç¼“å­˜åï¼Œæ‰ä¼šç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡ã€‚è¿™é‡Œæˆ‘ä»¬å¯¹ Sentry æ‹‰å– Source Maps å†…å®¹è¿›è¡Œæ·±åº¦è§£è¯»ã€‚

#### Process Source Maps

Sentry åœ¨å¤„ç† events æ—¶ï¼Œä¼šæ ¹æ® Stack Trace ä¿¡æ¯å»è§£æå¹¶è¯·æ±‚æºæ–‡ä»¶ï¼Œåœ¨æ‹‰å–å›æºæ–‡ä»¶ä¹‹åï¼Œä¼šè§£ææ–‡ä»¶å†…å®¹ï¼Œè·å–çº¿ä¸Š Source Maps çš„è·¯ç”±åœ°å€ï¼Œ<HighlightWithBadge label='æ‹‰å–æ–‡ä»¶å†…å®¹å¹¶è¿›è¡Œç¼“å­˜' />

- Sentry æœ¬èº«å­˜åœ¨ä¸¤ç§ç¼“å­˜æœºåˆ¶ï¼Œä¸€ç§æ˜¯ Setrny è‡ªå·±çš„å®ç°ï¼Œå³ç»“åˆ Redis è¿›è¡Œç¼“å­˜ï¼›ä¸€ç§æ˜¯ Django æœ¬èº«çš„ç¼“å­˜æœºåˆ¶ï¼Œå³é€šè¿‡ memcached è¿›è¡Œç¼“å­˜
