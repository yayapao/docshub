---
id: wpm
title: Web Performance Measures
sidebar_label: start wpm
slug: wpm
---

**wpm(web performance measures/monitor)** 是我在研究前端可信赖工程的一个重要课题，对于前端性能优化，我始终坚持两个观点：

:::note 观点
1. 脱离上下文谈论优化将变得毫无意义；
2. 没有指标数据，优化无从谈起；
:::

最近几年，页面应用的体验得到更为广泛的关注。在超级“内卷”的互联网浪潮中，应用性能不仅仅是影响用户的操作体验这么简单，它对用户留存、转化、消费，甚至是网站排名都在悄无声息地产生“蝴蝶效应”。

这里摘录了一段 google 关于排名算法更新的介绍(May, 2021)：

> “The page experience signal measures aspects of how users perceive the experience of interacting with a web page. Optimising for these factors makes the web more delightful for users across all web browsers and surfaces, and helps sites evolve towards user expectations on mobile. We believe this will contribute to business success on the web as users grow more engaged and can transact with less friction.”

google 坚信对于应用性能的不断优化会为作者和整个互联网带来有益的影响。那么，接下来我们要解决：

1. 从哪些方面度量页面性能以及哪些指标应该被采集？
2. 如何采集？
3. 如何评价应用？
4. 如何呈现？
5. 我们如何从数据获益？

这里先对上述各个模块进行概述，以帮助读者了解它是怎么一回事，后面在对各个模块进行更加深入的思考和分析。

![wpm overview](/img/wpm/wpm.png)

## What's metrics?

我们沿用 google 定义的 core web vitals 作为核心指标，同时我们需要获取页面在生命周期内关键节点信息：

- navigator timing 描述页面加载过程
- paint timing 描述页面绘制耗时
- resource timing 描述资源加载耗时


## How to collect?

对于采集的问题，采用客户端 SDK 埋点 + 服务端处理，对于服务端通常会需要上报、消费、存储、查询服务，这里主要针对客户端采集上报的 SDK 设计进行研究

- [wpmonit](https://github.com/Y-lonelY/wpmonit)
- [GoogleChrome/web-vitals](https://github.com/GoogleChrome/web-vitals)
- [perfume](https://github.com/Zizzamia/perfume.js)
- [sentry-javascript](https://github.com/getsentry/sentry-javascript)

## Visualability

如何将数据呈现出来是一门学问：同一份数据，在不同的上下文通过不同的条件组合总能发现新的观测视角。

通常我们会设计这样一些核心模块：

概览

最近 N 天性能视图，描述应用每天页面加载的综合情况

core web vitals

页面加载瀑布图

页面性能排行

## How to improve?

在有了运行时分析数据作为支撑之后，随之而来的问题就是如何利用这份数据来改善我们的前端应用？

升级资源和缓存是我们常用的手段，它的效果提升明显，但是成本也会随之升高，因此这是需要权衡的手段。除此之外，我们往往还得深入浏览器运行机制和前端框架来寻找破局之法。
