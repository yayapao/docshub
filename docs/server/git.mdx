---
id: git
title: Git & Github
sidebar_label: Git & Github
---

import { TextWithIndex } from '/src/components/Highlights'

## Git

:::note what's git?
[git](https://git-scm.com/) 是一个分布式的版本管理系统，旨在快速高效地维护项目
:::

### 处理 `.gitignore` 不生效

`.gitignore` 不生效通常发生在 merge 之后，或者之前已经将不希望提交的文件提交到 github 上，此时我们：

- `git stash` 将本地缓存放入缓存区，这里是为了兜底；
- `git rm -r --cache .` 清理当前项目的缓存文件，此时 git 会根据 `.gitignore` 规则来发现哪些文件不需要 trace，将其进行删除
- `git add . && git commit -m "fix: untracked files && git push"` 将清理文件提交

### CHANGELOG

项目内添加 CHANGELOG

- 执行`npm install conventional-changelog-cli --save`
- 通过 `npx conventional-changelog --help` 查看相关命令
- 一般在 package.json 内配置 `"changelog": "conventional-changelog -p angular -i CHANGELOG.md -s -r 0"`，来指定使用 angular 规范，且重新生成 CHANGELOG.md 文件
- 通过 `npm run changelog`来执行

### 添加 SSH keys

rsa(非对称加密)

执行 `ssh-keygen -t ras -C "your_email@example.com"`

- `-t` 表示制定加密类型
- `-C` 表示注释内容

之后到指定目录内复制 `pub` 内容到 github 即可

**如果不希望内次提交都输入密码，在生成 keys 时直接 enter**

#### 切换当前项目 http to ssh

一般而言，当你配置好 SSH 验证方式之后，将之前 https 的连接方式切换成 ssh 是更优的选择

- `git remote -v` 查看当前协议
- `git remote set-url origin git@gitlab.xxxxxxx` 切换当前的连接方式
- `git pull origin master` 验证是否成功

### rebase

#### 合并多个 commit

1. 通过 `git log` 查看提交历史，找到需要合并的 commit 段
   - `git rebase -i HEAD~3` 表示合并最新的三个 commit
   - `git rebase -i xxxxxx` 通过版本号控制合并，注意标识版本号（即 xxxxxx）的 commit 不参与合并
2. 接着，再次确认需要合并的分支，将 `pick` 变更为 `squash`，注意第一行提交信息必须为 `pick`，保存后退出
   - `git rebase --continue` 在当前修改上继续操作
   - `git rebase --abort` 撤销当前的 rebase 操作
3. 再次编辑提交信息后提交

### 查看 log

```powershell
# 展示 commit 历史以及每次 commit 发生变更的文件
git log --stat

# 展示所有提交过的作者以及提交次数
git shortlog -sn
```

### tag

:::warning

在创建 tag/branch 时，要避免使用 `~ ^ : , ? [ * \r \n .. @{` 等特殊字符，否则可能会导致 git 无法识别，直接抛出异常。

:::

[git-tags](https://git-scm.com/book/en/v2/Git-Basics-Tagging) 常用命令，主要用于记录里程碑事件，可以看成是一次特殊的 commit

```shell
# 在本地添加一个带有 message 的 tag 标签
git tag -a v0.1 -m "add a tag named v0.1"

# 将本地 tag 推送到远程分支上
git push origin --tgas

# 查看所有 tag
git tag

# 删除本地 tag
git tag -d v0.1

# 删除远程 tag
git push origin -d v0.1 v0.2

# 切换到指定 tag
git checkout v0.1
```

### branch

```bash
# 查看仓库分支, -a 查看所有分支，-r 查看远程分支
git branch [-a | -r]

# 删除分支
git push origin -d [branch name]

# 批量删除分支，利用管道符找到待删除分支，统一处理后提交
git branch -r | grep 'key_word' | sed 's/origin\///'| xargs git push origin -d
```

### push

如果你在本地 `reset head` 到一个历史 commit，同时在此基础上进行开发，然后不希望再使用 `remote/master` 上的一些提交，跳过他们直接覆盖本地提交，则可以使用 `git push --force` 将本地 commit 强行推送至服务端

这种操作带来的风险点：如果另一个人在该分支上也提交了内容，那么会将他的提交内容也覆盖（清空）

## Github

:::note what's Github?
Github 是一个帮助开发者管理代码的云上服务。
:::

### 如何向开源仓库提交 pr?

<TextWithIndex
  data={[
    { text: `找到开源作品的 github 仓库，fork 其到自己的组织；` },
    { text: `克隆 forked 后的仓库到本地；` },
    {
      text: `新建一个分支(<code>git checkout -b [branch_name]</code>)，同时设置其 upstream 为原开源作品的地址(<code>git remote add upstream [open-source repo's address]</code>)；`,
    },
    {
      text: `通过 <code>git remote -v</code> 来检查 remote 和 upstream
地址，理论上 remote 指向 fork 地址，upstream 指向原仓库地址；`,
    },
    { text: `在当前分支上修改代码，并推送到 origin；` },
    {
      text: `在 github 上可以看到一个 pull&request 的按钮，点击后继续创建一个 pr 即可；`,
    },
  ]}
/>
