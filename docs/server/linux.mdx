---
id: linux
title: ''
sidebar_label: Linux
---

import { DocsHeader } from '/src/components/Layout/DocsHeader'

<DocsHeader
  title="Linux Handbook"
  description="Learning Linux from practice."
  tags={['Linux', 'Bash', 'Shell']}
  links={[]}
/>{' '}

## CommandLine

:::tip

从实战中积累 Linux 业务相关知识。

:::

### `ps` - process status

`ps` 用于查看当前主机内运行的服务状态

```bash
# 展示当前用户，在所有 ternimals 内的进程信息
$ ps

-e, -A # 展示所有的进程信息，不分用户，不分是否由 ternimals 启动
-a # 展示所有 ternimals 内启动的进程（不筛选当前用户）
-x # 展示所有进程信息，包括不是在 ternimals 内启动的
-f # 展示更多系统信息，uid, pid, parent pid, recent CPU usage, process start time, controlling tty, elapsed CPU usage, and the associated command
-u [username] # 指定用户
-m # 按照内存进行排序
```

我们建立一个速查组合：

- 查看所有进程信息执行 `ps -ef`
- 查看与当前用户相关的进行信息 `ps -xf`
- 查看特定用户的进程信息 `ps -u [username] -xf`

### `du` - disk usage

`du` 用于展示文件/目录占用磁盘空间大小。

```shell
# 展示各磁盘用量，容器上不推荐使用， -h 表示 human readable
df -h

# 查看指定目录下每个文件夹的占用（层级为1）
# mac 下为 $`du -d 1 -h ./`
du --max-depth=1 -h ./

# 查看指定目录的磁盘占用
du -sh ./
```

### `date`

`date` 用来设定或者展示系统时间。

```bash
$ date # Wed Oct 12 10:53:47 CST 2022 展示当前系统时间

# 输出当前时间戳
$ date +"%s"
```

### `top`

`top` 查看当前系统进程信息（但是在容器内，该命令并不准确，需要去文件内查看真是内存使用）

- 按照内存占用排序：按下 `M`
- 按照 CPU 占用排序，按下 `P`

### wget

wget 是一个从网络上自动下载文件的自由工具，支持通过 HTTP、HTTPS、FTP 三个最常见的 TCP/IP 协议 下载，并可以使用 HTTP 代理

```bash
# 查看版本
$ wget --version
```

## Shell Programming

### 变量命名规则和使用

规则：

- 命名只能使用英文字母，数字和下划线，首个字符不能以数字开头
- 中间不能有空格，可以使用下划线
- 不能使用标点符号
- 不能使用 bash 里的关键字（可用 help 命令查看保留关键字）

在 Linux 内，变量是一个键值对，直接访问变量名返回的是变量名，通过 `${变量名}` 访问其值

```bash
# 声明变量 name 的值为 “papaya”
name = "yayapa"

# 通过 ${...} 使用变量
echo ${name}

# readonly 设置变量只读
readonly read_name = "cool"

# 删除变量，只读变量不能删除
unset name

# 定义数组，通过换行或者空格进行分隔
array=(value0 value1 value2 value3)

# 获取所有元素
${array[*]}

# 获取元素个数
length=${#array[*]}

# 获取元素值
valuen=${array[n]}
```

### `&` vs `&&`

在 Linux 中，`&` 放在命令末尾表示：**将该命令放到后台执行，** 主进程将继续向下执行，被放入后台命令将与主进程并行执行。

`&&` 与单纯换行的实际效果一致，等待当前命令执行完毕之后，再继续执行后面的命令。

### 大小判断

大于(greater than) `-gt`

小于(less than) `-lt`

大于或等于(greater than or equal) `-ge`

小于或等于(less than or equal) `-le`

不相等(not equal) `-ne`

### if elif 控制

`fi` 用于终止代码块

```sh
if [[ $option_select -eq 1 ]]; then
	# statements...
elif [[ $option_select -eq 1 ]]; then
	# statements...
fi
```

### 类型判断

**数字类型判断**

```sh
# 判读输入值是否为一个数字，如果为0，则证明是一个数字类型
expr $sort "+" 10 &> /dev/null

if [[ $? -eq 0 ]]; then
	# statements...
```

**字符串判断**

```shell
a="abc"
b="cde"

# = / != 判断是否相等
[$a=$b]

# -z 判断字符串长度是否为 0
[-z $a]

# -n 判断字符串是否不为空
[-n $a]

# $ 判断字符串是否为空
[$a]
```

### 定义函数

在 Linux 内通过 `function` 声明函数：

- 函数传参通过空格进行分隔
- 函数内通过 `$` 来获取传递参数，比如 `$1` 用来获取第一个传参，`$?` 获取上一个传值

```Bash
#!/usr/bin/env bash

# declare function
# 3 params 1. title 2. array options 3. array's length
function READ_USER_INPUT() {
  title=$1
  options=$2
  maxValue=$3
  echo "${title}"

  # 遍历数组
  for option in ${options[*]}; do
    echo "${option}"
  done

  read sort
  return ${sort}
}

# call the function
options_value=("1.start" "2.stop" "3.list")
READ_USER_INPUT "this is title" "${options_value[*]}" ${#options_value[*]}

# get the return value
option_select=$?
```
